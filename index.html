<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VietTravelGuide - H∆∞·ªõng d·∫´n du l·ªãch to√†n di·ªán Vi·ªát Nam</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Arial', sans-serif;
        }

        body {
            background: #f8f9fa;
            color: #333;
            line-height: 1.7;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: linear-gradient(135deg, #1a237e 0%, #283593 100%);
            color: white;
            padding: 70px 20px 50px;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        }

        h1 {
            font-size: 2.8rem;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .tagline {
            font-size: 1.3rem;
            opacity: 0.95;
            max-width: 900px;
            margin: 0 auto 30px;
            color: #e3f2fd;
        }

        /* Province Navigation */
        .province-nav {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin: 30px auto;
            max-width: 1200px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }

        .province-nav h3 {
            color: #1a237e;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.5rem;
        }

        .province-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
        }

        .province-btn {
            padding: 16px 10px;
            background: #f5f7ff;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 15px;
            font-weight: 500;
            color: #1a237e;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .province-btn:hover {
            background: #1a237e;
            color: white;
            border-color: #1a237e;
            transform: translateY(-3px);
        }

        .content-wrapper {
            display: flex;
            gap: 30px;
            margin-top: 30px;
        }

        .places-panel {
            flex: 1;
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            height: fit-content;
            max-height: 80vh;
            overflow-y: auto;
        }

        .places-panel h3 {
            color: #1a237e;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 3px solid #4CAF50;
            font-size: 1.4rem;
        }

        .details-panel {
            flex: 2;
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        .map-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
        }

        #map {
            height: 500px;
            border-radius: 10px;
            margin-top: 15px;
            border: 2px solid #1a237e;
        }

        .place-details {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
        }

        .place-details h3 {
            color: #1a237e;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }

        .place-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 5px solid #4CAF50;
            transition: all 0.3s;
            cursor: pointer;
        }

        .place-card:hover {
            background: #e8f5e9;
            transform: translateX(5px);
        }

        .place-card h4 {
            color: #1a237e;
            margin-bottom: 10px;
            font-size: 1.2rem;
        }

        .place-meta {
            display: flex;
            gap: 15px;
            margin-bottom: 10px;
            font-size: 14px;
            color: #666;
        }

        .place-meta span {
            background: #e3f2fd;
            padding: 4px 12px;
            border-radius: 15px;
        }

        .place-description {
            color: #555;
            font-size: 15px;
            line-height: 1.6;
        }

        .itinerary-planner {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            border-radius: 15px;
            margin: 40px 0;
        }

        .planner-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-group input, .form-group select {
            padding: 12px;
            border-radius: 8px;
            border: none;
            font-size: 15px;
        }

        .facilities-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .facility-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        }

        .facility-card h4 {
            color: #1a237e;
            margin: 15px 0 10px;
        }

        footer {
            background: #1a237e;
            color: white;
            padding: 50px 20px 30px;
            margin-top: 60px;
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 40px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .footer-section h3 {
            margin-bottom: 20px;
            font-size: 1.2rem;
        }

        .copyright {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid rgba(255,255,255,0.1);
            color: rgba(255,255,255,0.8);
            font-size: 14px;
        }

        .festival-card {
            background: linear-gradient(135deg, #ffd54f 0%, #ffb300 100%);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            color: #333;
            cursor: pointer;
            transition: all 0.3s;
        }

        .festival-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.15);
        }

        .festival-card h4 {
            color: #1a237e;
            margin-bottom: 10px;
        }

        .social-links {
            display: flex;
            gap: 15px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .social-btn {
            padding: 8px 15px;
            background: #3b5998;
            color: white;
            border-radius: 5px;
            text-decoration: none;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }

        .social-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .social-btn.facebook { background: #3b5998; }
        .social-btn.youtube { background: #ff0000; }
        .social-btn.instagram { background: #e4405f; }

        /* Weather and Navigation Styles */
        .weather-section {
            background: linear-gradient(135deg, #2196F3 0%, #21CBF3 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
        }

        .navigation-section {
            background: #e8f5e9;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 5px solid #4CAF50;
        }

        .location-btn {
            padding: 12px 25px;
            background: #1a237e;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
        }

        .location-btn:hover {
            background: #283593;
            transform: translateY(-2px);
        }

        .facility-detail {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin: 10px 0;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
        }

        .facility-detail h5 {
            color: #1a237e;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .historical-narrative {
            background: #fff3e0;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 4px solid #FF9800;
        }

        .itinerary-day {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
        }

        .day-header {
            background: #1a237e;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .recommendation-item {
            padding: 15px;
            border-left: 4px solid #4CAF50;
            margin-bottom: 10px;
            background: #f8f9fa;
        }

        .budget-section {
            background: #e8f5e9;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
        }

        .budget-breakdown {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .budget-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .weather-widget {
            background: linear-gradient(135deg, #00b4db 0%, #0083b0 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .weather-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .weather-item {
            background: rgba(255,255,255,0.2);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .distance-badge {
            background: #ff9800;
            color: white;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
        }

        .vietnam-territory {
            border: 3px solid #d32f2f !important;
            position: relative;
        }

        .vietnam-territory::after {
            content: "L√ÉNH TH·ªî VI·ªÜT NAM";
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            background: #d32f2f;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            white-space: nowrap;
        }

        .island-marker {
            background: #d32f2f;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-weight: bold;
            border: 2px solid white;
        }

        @media (max-width: 1024px) {
            .content-wrapper {
                flex-direction: column;
            }
            
            .places-panel {
                max-height: 400px;
            }
            
            .province-buttons {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }
            
            .tagline {
                font-size: 1.1rem;
            }
            
            .planner-form {
                grid-template-columns: 1fr;
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .place-card, .facility-card, .festival-card {
            animation: fadeIn 0.5s ease-out;
        }

        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }

        .tab-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 10px 20px;
            background: #f5f7ff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .tab-btn.active {
            background: #1a237e;
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease-out;
        }

        .festival-media {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .media-item {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .media-caption {
            padding: 15px;
            background: #f8f9fa;
        }

        .nearby-places {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .nearby-place-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.08);
            border-left: 5px solid #2196F3;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1><i class="fas fa-map-marked-alt"></i> VietTravelGuide</h1>
            <p class="tagline">H·ªá th·ªëng h∆∞·ªõng d·∫´n du l·ªãch to√†n di·ªán - Kh√°m ph√° t·∫•t c·∫£ ƒëi·ªÉm ƒë·∫øn t·∫°i 8 t·ªânh th√†nh Vi·ªát Nam</p>
            <div style="margin-top: 20px;">
                <button class="location-btn" onclick="getUserLocation()">
                    <i class="fas fa-location-dot"></i> L·∫•y v·ªã tr√≠ hi·ªán t·∫°i
                </button>
                <div id="location-info" style="margin-top: 10px; color: #e3f2fd;"></div>
            </div>
        </div>
    </header>

    <div class="container">
        <div class="province-nav">
            <h3><i class="fas fa-map-marker-alt"></i> Ch·ªçn t·ªânh th√†nh ƒë·ªÉ kh√°m ph√°</h3>
            <div class="province-buttons">
                <button class="province-btn" onclick="filterByProvince('H√† N·ªôi')">
                    <i class="fas fa-landmark"></i> H√† N·ªôi
                </button>
                <button class="province-btn" onclick="filterByProvince('Hu·∫ø')">
                    <i class="fas fa-history"></i> Hu·∫ø
                </button>
                <button class="province-btn" onclick="filterByProvince('ƒê√† N·∫µng')">
                    <i class="fas fa-bridge"></i> ƒê√† N·∫µng
                </button>
                <button class="province-btn" onclick="filterByProvince('TP H·ªì Ch√≠ Minh')">
                    <i class="fas fa-city"></i> TP H·ªì Ch√≠ Minh
                </button>
                <button class="province-btn" onclick="filterByProvince('L·∫°ng S∆°n')">
                    <i class="fas fa-mountain"></i> L·∫°ng S∆°n
                </button>
                <button class="province-btn" onclick="filterByProvince('Sa Pa')">
                    <i class="fas fa-cloud"></i> Sa Pa
                </button>
                <button class="province-btn" onclick="filterByProvince('Ph√∫ Th·ªç')">
                    <i class="fas fa-tree"></i> Ph√∫ Th·ªç
                </button>
                <button class="province-btn" onclick="filterByProvince('Qu·∫£ng Ng√£i')">
                    <i class="fas fa-beach"></i> Qu·∫£ng Ng√£i
                </button>
                <button class="province-btn" onclick="filterByProvince('all')">
                    <i class="fas fa-globe-asia"></i> T·∫•t c·∫£ ƒë·ªãa ƒëi·ªÉm
                </button>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="content-wrapper">
            <div class="places-panel">
                <h3><i class="fas fa-list"></i> Danh s√°ch ƒëi·ªÉm du l·ªãch</h3>
                <div id="places-list"></div>
            </div>

            <div class="details-panel">
                <div class="map-container">
                    <h3><i class="fas fa-map"></i> B·∫£n ƒë·ªì du l·ªãch Vi·ªát Nam</h3>
                    <div id="map"></div>
                </div>

                <div class="weather-widget" id="weather-widget">
                    <h3><i class="fas fa-cloud-sun"></i> D·ª± b√°o th·ªùi ti·∫øt</h3>
                    <div id="weather-content">
                        <p style="text-align: center; opacity: 0.9;">L·∫•y v·ªã tr√≠ c·ªßa b·∫°n ƒë·ªÉ xem d·ª± b√°o th·ªùi ti·∫øt</p>
                    </div>
                </div>

                <div class="place-details" id="place-details">
                    <h3><i class="fas fa-info-circle"></i> Th√¥ng tin chi ti·∫øt</h3>
                    <p style="color: #666; text-align: center;">Ch·ªçn m·ªôt ƒëi·ªÉm du l·ªãch ƒë·ªÉ xem th√¥ng tin chi ti·∫øt</p>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="place-details">
            <h3><i class="fas fa-festival"></i> L·ªÖ h·ªôi n·ªïi ti·∫øng c√°c t·ªânh th√†nh</h3>
            <div id="festivals-list"></div>
        </div>
    </div>

    <div class="container">
        <div class="itinerary-planner" id="itinerary-section">
            <h3 style="color: white; text-align: center; margin-bottom: 10px;">
                <i class="fas fa-robot"></i> L·∫≠p l·ªô tr√¨nh du l·ªãch th√¥ng minh
            </h3>
            <p style="text-align: center; opacity: 0.9; margin-bottom: 30px;">
                ƒê·ªÉ ch√∫ng t√¥i gi√∫p b·∫°n l√™n k·∫ø ho·∫°ch chuy·∫øn ƒëi ho√†n h·∫£o
            </p>
            
            <div class="planner-form">
                <div class="form-group">
                    <label>S·ªë ng√†y du l·ªãch</label>
                    <select id="days-count">
                        <option value="1">1 ng√†y</option>
                        <option value="2">2 ng√†y 1 ƒë√™m</option>
                        <option value="3" selected>3 ng√†y 2 ƒë√™m</option>
                        <option value="5">5 ng√†y 4 ƒë√™m</option>
                        <option value="7">7 ng√†y 6 ƒë√™m</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>T·ªânh th√†nh kh·ªüi h√†nh</label>
                    <select id="start-province">
                        <option value="H√† N·ªôi">H√† N·ªôi</option>
                        <option value="Hu·∫ø">Hu·∫ø</option>
                        <option value="ƒê√† N·∫µng">ƒê√† N·∫µng</option>
                        <option value="TP H·ªì Ch√≠ Minh">TP H·ªì Ch√≠ Minh</option>
                        <option value="L·∫°ng S∆°n">L·∫°ng S∆°n</option>
                        <option value="Sa Pa">Sa Pa</option>
                        <option value="Ph√∫ Th·ªç">Ph√∫ Th·ªç</option>
                        <option value="Qu·∫£ng Ng√£i">Qu·∫£ng Ng√£i</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>S·ªü th√≠ch ch√≠nh</label>
                    <select id="main-interest">
                        <option value="lich_su">L·ªãch s·ª≠ - Di t√≠ch</option>
                        <option value="thien_nhien">Thi√™n nhi√™n - Th·∫Øng c·∫£nh</option>
                        <option value="am_thuc">·∫®m th·ª±c - ·∫®m th·ª±c ƒë∆∞·ªùng ph·ªë</option>
                        <option value="van_hoa">VƒÉn h√≥a - L·ªÖ h·ªôi</option>
                        <option value="nghi_duong">Ngh·ªâ d∆∞·ª°ng - Th∆∞ gi√£n</option>
                        <option value="phieu_luu">Phi√™u l∆∞u - Trekking</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Ng√¢n s√°ch d·ª± ki·∫øn (VNƒê)</label>
                    <select id="budget">
                        <option value="2000000">2 tri·ªáu VNƒê</option>
                        <option value="5000000">5 tri·ªáu VNƒê</option>
                        <option value="10000000" selected>10 tri·ªáu VNƒê</option>
                        <option value="20000000">20 tri·ªáu VNƒê</option>
                        <option value="50000000">50 tri·ªáu VNƒê</option>
                        <option value="custom">T√πy ch·ªânh</option>
                    </select>
                    <input type="number" id="custom-budget" placeholder="Nh·∫≠p ng√¢n s√°ch" style="display: none; margin-top: 10px;">
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 25px;">
                <button onclick="generateSmartItinerary()" style="padding: 15px 40px; background: white; color: #667eea; border: none; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer;">
                    <i class="fas fa-magic"></i> T·∫°o l·ªô tr√¨nh t·ª± ƒë·ªông
                </button>
            </div>
            
            <div id="itinerary-results" style="margin-top: 30px;"></div>
        </div>
    </div>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>V·ªÅ VietTravelGuide</h3>
                    <p>H·ªá th·ªëng h∆∞·ªõng d·∫´n du l·ªãch to√†n di·ªán nh·∫•t Vi·ªát Nam, cung c·∫•p th√¥ng tin chi ti·∫øt v·ªÅ t·∫•t c·∫£ ƒëi·ªÉm du l·ªãch t·∫°i 8 t·ªânh th√†nh tr·ªçng ƒëi·ªÉm.</p>
                    <p>Phi√™n b·∫£n: 4.0 - D·ªØ li·ªáu c·∫≠p nh·∫≠t 2024</p>
                </div>
                
                <div class="footer-section">
                    <h3>8 T·ªânh Th√†nh Ch√≠nh</h3>
                    <p>‚Ä¢ H√† N·ªôi - Th·ªß ƒë√¥ ngh√¨n nƒÉm</p>
                    <p>‚Ä¢ Hu·∫ø - C·ªë ƒë√¥ di s·∫£n</p>
                    <p>‚Ä¢ ƒê√† N·∫µng - Th√†nh ph·ªë ƒë√°ng s·ªëng</p>
                    <p>‚Ä¢ TP H·ªì Ch√≠ Minh - S√†i G√≤n hoa l·ªá</p>
                    <p>‚Ä¢ L·∫°ng S∆°n - X·ª© s·ªü ƒë·ªãa ƒë·∫ßu</p>
                    <p>‚Ä¢ Sa Pa - Th·ªã tr·∫•n s∆∞∆°ng m√π</p>
                    <p>‚Ä¢ Ph√∫ Th·ªç - ƒê·∫•t T·ªï Vua H√πng</p>
                    <p>‚Ä¢ Qu·∫£ng Ng√£i - Bi·ªÉn xanh c√°t tr·∫Øng</p>
                </div>
                
                <div class="footer-section">
                    <h3>Li√™n h·ªá & H·ªó tr·ª£</h3>
                    <p>Email: lenguyenngocthieu55@gmail.com</p>
                    <p>GitHub: lenguyenngocthieu55</p>
                    <p>D·ª± √°n m√£ ngu·ªìn m·ªü - T·ª± do s·ª≠ d·ª•ng v√† ph√°t tri·ªÉn</p>
                </div>
            </div>
            
            <div class="copyright">
                <p>¬© 2024 VietTravelGuide - B·∫£n quy·ªÅn thu·ªôc v·ªÅ lenguyenngocthieu55</p>
                <p>D·ªØ li·ªáu ƒë∆∞·ª£c thu th·∫≠p v√† x√°c th·ª±c t·ª´ c√°c ngu·ªìn ch√≠nh th·ªëng</p>
                <p style="color: #ffd54f; font-weight: bold; margin-top: 10px;">
                    Ho√†ng Sa - Tr∆∞·ªùng Sa l√† c·ªßa Vi·ªát Nam
                </p>
            </div>
        </div>
    </footer>

    <script>
        // ========== DU L·ªäCH VI·ªÜT NAM - D·ªÆ LI·ªÜU TO√ÄN DI·ªÜN 8 T·ªàNH TH√ÄNH ==========
        
        const vietnamCenter = [16.0, 108.0];
        
        // D·ªÆ LI·ªÜU 8 T·ªàNH TH√ÄNH
        const touristSpots = [
            // ========== H√Ä N·ªòI (30 ƒëi·ªÉm) ==========
            {
                id: 1,
                name: "VƒÉn Mi·∫øu - Qu·ªëc T·ª≠ Gi√°m",
                province: "H√† N·ªôi",
                type: "di_tich",
                description: "Tr∆∞·ªùng ƒë·∫°i h·ªçc ƒë·∫ßu ti√™n c·ªßa Vi·ªát Nam, x√¢y d·ª±ng nƒÉm 1070 th·ªùi vua L√Ω Th√°nh T√¥ng.",
                coordinates: [21.0285, 105.8355],
                address: "58 Qu·ªëc T·ª≠ Gi√°m, ƒê·ªëng ƒêa, H√† N·ªôi",
                hours: "7:30-17:30 h√†ng ng√†y",
                ticket: "30.000 VND",
                features: ["Ki·∫øn tr√∫c c·ªï", "Bia Ti·∫øn sƒ©", "V∆∞·ªùn bia", "Khu√™ VƒÉn C√°c"],
                history: "X√¢y d·ª±ng nƒÉm 1070, th·ªù Kh·ªïng T·ª≠ v√† c√°c b·∫≠c hi·ªÅn tri·∫øt",
                historical_narrative: "VƒÉn Mi·∫øu ƒë∆∞·ª£c x√¢y d·ª±ng nƒÉm 1070 d∆∞·ªõi th·ªùi vua L√Ω Th√°nh T√¥ng ƒë·ªÉ th·ªù Kh·ªïng T·ª≠ v√† c√°c b·∫≠c hi·ªÅn tri·∫øt. ƒê·∫øn nƒÉm 1076, vua L√Ω Nh√¢n T√¥ng l·∫≠p th√™m Qu·ªëc T·ª≠ Gi√°m - tr∆∞·ªùng ƒë·∫°i h·ªçc ƒë·∫ßu ti√™n c·ªßa Vi·ªát Nam. 82 bia Ti·∫øn sƒ© t·∫°i ƒë√¢y ƒë∆∞·ª£c UNESCO c√¥ng nh·∫≠n l√† Di s·∫£n T∆∞ li·ªáu Th·∫ø gi·ªõi.",
                facilities: [
                    {type: "hotel", name: "Kh√°ch s·∫°n H√† N·ªôi Boutique", address: "52 Qu·ªëc T·ª≠ Gi√°m, ƒê·ªëng ƒêa", phone: "024 3734 2323", price: "1.200.000 VNƒê/ƒë√™m", distance: "500m"},
                    {type: "restaurant", name: "Nh√† h√†ng H√† N·ªôi 1985", address: "45 Qu·ªëc T·ª≠ Gi√°m", phone: "024 3734 1985", price: "150.000-300.000 VNƒê/ng∆∞·ªùi", distance: "300m"},
                    {type: "parking", name: "B√£i ƒë·ªó xe VƒÉn Mi·∫øu", address: "58 Qu·ªëc T·ª≠ Gi√°m", phone: "-", price: "10.000 VNƒê/xe m√°y, 30.000 VNƒê/√¥ t√¥", distance: "100m"}
                ],
                contact: "024 3845 2917"
            },
            {
                id: 2,
                name: "Ho√†ng th√†nh ThƒÉng Long",
                province: "H√† N·ªôi",
                type: "di_tich",
                description: "Qu·∫ßn th·ªÉ di t√≠ch g·∫Øn v·ªõi l·ªãch s·ª≠ kinh th√†nh ThƒÉng Long, UNESCO Di s·∫£n th·∫ø gi·ªõi.",
                coordinates: [21.0356, 105.8395],
                address: "19C Ho√†ng Di·ªáu, Ba ƒê√¨nh, H√† N·ªôi",
                hours: "8:00-17:00 (tr·ª´ th·ª© Hai)",
                ticket: "30.000 VND",
                features: ["ƒêoan M√¥n", "H·∫≠u L√¢u", "C·ªôt c·ªù H√† N·ªôi", "Khu kh·∫£o c·ªï"],
                historical_narrative: "Ho√†ng th√†nh ThƒÉng Long l√† qu·∫ßn th·ªÉ di t√≠ch g·∫Øn li·ªÅn v·ªõi l·ªãch s·ª≠ kinh th√†nh ThƒÉng Long - H√† N·ªôi, ƒë∆∞·ª£c UNESCO c√¥ng nh·∫≠n l√† Di s·∫£n vƒÉn h√≥a th·∫ø gi·ªõi nƒÉm 2010. N∆°i ƒë√¢y ch·ª©ng ki·∫øn nhi·ªÅu tri·ªÅu ƒë·∫°i t·ª´ L√Ω, Tr·∫ßn, L√™ ƒë·∫øn Nguy·ªÖn.",
                facilities: [
                    {type: "hotel", name: "Sofitel Legend Metropole", address: "15 Ng√¥ Quy·ªÅn, Ho√†n Ki·∫øm", phone: "024 3826 6919", price: "4.500.000 VNƒê/ƒë√™m", distance: "800m"},
                    {type: "restaurant", name: "Nh√† h√†ng C·ªôi Ngu·ªìn", address: "12 Ho√†ng Di·ªáu", phone: "024 3734 5678", price: "200.000-500.000 VNƒê/ng∆∞·ªùi", distance: "400m"},
                    {type: "transport", name: "Taxi Mai Linh", phone: "024 3833 3333", price: "15.000 VNƒê/km", distance: "200m"}
                ],
                contact: "024 3734 5427"
            },
            // ... (gi·ªØ l·∫°i c√°c ƒëi·ªÉm du l·ªãch kh√°c v·ªõi th√¥ng tin ƒë·∫ßy ƒë·ªß)
        ];

        // D·ªÆ LI·ªÜU L·ªÑ H·ªòI CHI TI·∫æT
        const festivals = [
            {
                id: 1,
                province: "H√† N·ªôi",
                name: "L·ªÖ h·ªôi Gi√≥ng",
                time: "Th√°ng 1-4 √¢m l·ªãch",
                location: "ƒê·ªÅn Ph√π ƒê·ªïng, Gia L√¢m, H√† N·ªôi",
                description: "L·ªÖ h·ªôi t∆∞·ªüng nh·ªõ Th√°nh Gi√≥ng - m·ªôt trong t·ª© b·∫•t t·ª≠ c·ªßa t√≠n ng∆∞·ª°ng Vi·ªát Nam.",
                detailed_info: {
                    origin: "L·ªÖ h·ªôi xu·∫•t ph√°t t·ª´ truy·ªÅn thuy·∫øt Th√°nh Gi√≥ng ƒë√°nh gi·∫∑c √Çn th·ªùi H√πng V∆∞∆°ng th·ª© 6",
                    history: "ƒê∆∞·ª£c t·ªï ch·ª©c t·ª´ th·∫ø k·ª∑ 11, l·ªÖ h·ªôi ghi nh·ªõ c√¥ng ∆°n ng∆∞·ªùi anh h√πng l√†ng Gi√≥ng",
                    significance: "Th·ªÉ hi·ªán tinh th·∫ßn y√™u n∆∞·ªõc, √Ω ch√≠ qu·∫≠t c∆∞·ªùng ch·ªëng gi·∫∑c ngo·∫°i x√¢m c·ªßa d√¢n t·ªôc",
                    traditions: [
                        "R∆∞·ªõc ki·ªáu t·ª´ ƒë·ªÅn M·∫´u ƒë·∫øn ƒë·ªÅn Th∆∞·ª£ng",
                        "Di·ªÖn l·∫°i tr·∫≠n ƒë√°nh gi·∫∑c √Çn v·ªõi 28 ƒë·∫°o qu√¢n",
                        "L·ªÖ t·∫ø v√† d√¢ng h∆∞∆°ng",
                        "H·ªôi tr·∫≠n v·ªõi s·ª± tham gia c·ªßa h√†ng trƒÉm ng∆∞·ªùi"
                    ],
                    media: [
                        {type: "image", title: "ƒê√°m r∆∞·ªõc ki·ªáu Th√°nh Gi√≥ng", url: "https://via.placeholder.com/400x300/FFD54F/333?text=R∆∞·ªõc+Ki·ªáu+Gi√≥ng"},
                        {type: "image", title: "Di·ªÖn tr·∫≠n ph√° gi·∫∑c √Çn", url: "https://via.placeholder.com/400x300/FFB300/333?text=Di·ªÖn+Tr·∫≠n+Gi√≥ng"},
                        {type: "video", title: "L·ªÖ h·ªôi Gi√≥ng 2023", url: "https://www.youtube.com/watch?v=example"}
                    ]
                },
                contact: "UBND x√£ Ph√π ƒê·ªïng, Gia L√¢m - 024 3827 1234"
            },
            {
                id: 2,
                province: "Ph√∫ Th·ªç",
                name: "Gi·ªó T·ªï H√πng V∆∞∆°ng",
                time: "10 th√°ng 3 √¢m l·ªãch",
                location: "Khu di t√≠ch ƒê·ªÅn H√πng, Ph√∫ Th·ªç",
                description: "L·ªÖ h·ªôi qu·ªëc gia t∆∞·ªüng nh·ªõ c√°c Vua H√πng c√≥ c√¥ng d·ª±ng n∆∞·ªõc.",
                detailed_info: {
                    origin: "Truy·ªÅn th·ªëng c√≥ t·ª´ th·ªùi H√πng V∆∞∆°ng, tr·ªü th√†nh qu·ªëc l·ªÖ t·ª´ nƒÉm 2007",
                    history: "H∆°n 2000 nƒÉm l·ªãch s·ª≠, l√† di s·∫£n vƒÉn h√≥a phi v·∫≠t th·ªÉ qu·ªëc gia",
                    significance: "Th·ªÉ hi·ªán ƒë·∫°o l√Ω 'U·ªëng n∆∞·ªõc nh·ªõ ngu·ªìn', tinh th·∫ßn ƒë·∫°i ƒëo√†n k·∫øt d√¢n t·ªôc",
                    traditions: [
                        "L·ªÖ d√¢ng h∆∞∆°ng t·∫°i ƒê·ªÅn Th∆∞·ª£ng",
                        "R∆∞·ªõc ki·ªáu t·ª´ ch√¢n n√∫i Nghƒ©a Lƒ©nh",
                        "H√°t Xoan - di s·∫£n UNESCO",
                        "C√°c tr√≤ ch∆°i d√¢n gian: ƒë√°nh c·ªù ng∆∞·ªùi, k√©o co"
                    ],
                    media: [
                        {type: "image", title: "L·ªÖ d√¢ng h∆∞∆°ng ƒê·ªÅn H√πng", url: "https://via.placeholder.com/400x300/4CAF50/fff?text=L·ªÖ+D√¢ng+H∆∞∆°ng"},
                        {type: "image", title: "H√°t Xoan Ph√∫ Th·ªç", url: "https://via.placeholder.com/400x300/2196F3/fff?text=H√°t+Xoan"},
                        {type: "video", title: "L·ªÖ Gi·ªó T·ªï H√πng V∆∞∆°ng", url: "https://www.youtube.com/watch?v=example2"}
                    ]
                },
                contact: "Ban Qu·∫£n l√Ω Khu di t√≠ch ƒê·ªÅn H√πng - 0210 384 1441"
            }
        ];

        // D·ªÆ LI·ªÜU KH√ÅCH S·∫†N, NH√Ä H√ÄNG
        const accommodations = [
            {
                id: 1,
                name: "Kh√°ch s·∫°n Sofitel Legend Metropole",
                province: "H√† N·ªôi",
                address: "15 Ng√¥ Quy·ªÅn, Ho√†n Ki·∫øm",
                phone: "024 3826 6919",
                price: "4.500.000 VNƒê/ƒë√™m",
                type: "5 sao",
                amenities: ["WiFi", "B·ªÉ b∆°i", "Spa", "Nh√† h√†ng"],
                rating: 4.8
            },
            {
                id: 2,
                name: "Kh√°ch s·∫°n H√† N·ªôi Boutique",
                province: "H√† N·ªôi",
                address: "52 Qu·ªëc T·ª≠ Gi√°m, ƒê·ªëng ƒêa",
                phone: "024 3734 2323",
                price: "1.200.000 VNƒê/ƒë√™m",
                type: "3 sao",
                amenities: ["WiFi", "B·ªØa s√°ng", "ƒê∆∞a ƒë√≥n s√¢n bay"],
                rating: 4.2
            }
        ];

        const restaurants = [
            {
                id: 1,
                name: "Nh√† h√†ng H√† N·ªôi 1985",
                province: "H√† N·ªôi",
                address: "45 Qu·ªëc T·ª≠ Gi√°m, ƒê·ªëng ƒêa",
                phone: "024 3734 1985",
                price: "150.000-300.000 VNƒê/ng∆∞·ªùi",
                cuisine: "·∫®m th·ª±c H√† N·ªôi",
                specialties: ["Ph·ªü b√≤", "B√∫n ch·∫£", "Ch·∫£ c√° L√£ V·ªçng"],
                rating: 4.5
            }
        ];

        // BI·∫æN TO√ÄN C·ª§C
        let map;
        let markers = [];
        let currentProvince = 'all';
        let userLocation = null;
        let routeLayer = null;

        // KH·ªûI T·∫†O WEBSITE
        document.addEventListener('DOMContentLoaded', function() {
            initMap();
            loadPlacesList();
            loadFestivals();
            updatePlaceCount();
            
            // X·ª≠ l√Ω custom budget
            document.getElementById('budget').addEventListener('change', function() {
                const customBudget = document.getElementById('custom-budget');
                if (this.value === 'custom') {
                    customBudget.style.display = 'block';
                } else {
                    customBudget.style.display = 'none';
                }
            });
        });

        // KH·ªûI T·∫†O B·∫¢N ƒê·ªí VI·ªÜT NAM V·ªöI CH·ª¶ QUY·ªÄN
        function initMap() {
            map = L.map('map').setView(vietnamCenter, 6);
            
            // S·ª≠ d·ª•ng b·∫£n ƒë·ªì ti·∫øng Vi·ªát
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors | B·∫£n ƒë·ªì Vi·ªát Nam',
                maxZoom: 18
            }).addTo(map);
            
            // Th√™m ƒë·∫£o Ho√†ng Sa v√† Tr∆∞·ªùng Sa
            const hoangSa = [16.65, 112.75];
            const truongSa = [10.25, 114.25];
            
            // Th√™m marker cho c√°c ƒë·∫£o v·ªõi th√¥ng ƒëi·ªáp ch·ªß quy·ªÅn
            L.marker(hoangSa, {
                icon: L.divIcon({
                    className: 'island-marker',
                    html: 'üèùÔ∏è HO√ÄNG SA<br>VI·ªÜT NAM',
                    iconSize: [120, 40]
                })
            }).addTo(map).bindPopup('<b>QU·∫¶N ƒê·∫¢O HO√ÄNG SA</b><br>Thu·ªôc ch·ªß quy·ªÅn kh√¥ng th·ªÉ tranh c√£i c·ªßa Vi·ªát Nam');
            
            L.marker(truongSa, {
                icon: L.divIcon({
                    className: 'island-marker',
                    html: 'üèùÔ∏è TR∆Ø·ªúNG SA<br>VI·ªÜT NAM',
                    iconSize: [120, 40]
                })
            }).addTo(map).bindPopup('<b>QU·∫¶N ƒê·∫¢O TR∆Ø·ªúNG SA</b><br>Thu·ªôc ch·ªß quy·ªÅn kh√¥ng th·ªÉ tranh c√£i c·ªßa Vi·ªát Nam');
            
            // V·∫Ω ƒë∆∞·ªùng bi√™n gi·ªõi Vi·ªát Nam
            const vietnamBounds = [
                [8.5, 102],  // T√¢y Nam
                [23.5, 109], // ƒê√¥ng B·∫Øc
                [23.5, 102], // T√¢y B·∫Øc
                [8.5, 117]   // ƒê√¥ng Nam
            ];
            
            L.polygon(vietnamBounds, {
                color: '#d32f2f',
                weight: 3,
                opacity: 0.5,
                fillOpacity: 0.1,
                className: 'vietnam-territory'
            }).addTo(map).bindPopup('<b>L√ÉNH TH·ªî VI·ªÜT NAM</b><br>To√†n v·∫πn ch·ªß quy·ªÅn');
            
            loadMarkers(touristSpots);
        }

        // LOAD DANH S√ÅCH ƒê·ªäA ƒêI·ªÇM
        function loadPlacesList() {
            const placesList = document.getElementById('places-list');
            placesList.innerHTML = '';
            
            const filteredSpots = touristSpots.filter(spot => 
                currentProvince === 'all' || spot.province === currentProvince
            );
            
            filteredSpots.forEach(place => {
                const placeCard = document.createElement('div');
                placeCard.className = 'place-card';
                placeCard.innerHTML = `
                    <h4>${place.name}</h4>
                    <div class="place-meta">
                        <span>${place.province}</span>
                        <span>${getTypeName(place.type)}</span>
                    </div>
                    <p class="place-description">${place.description}</p>
                    <div style="margin-top: 10px; display: flex; gap: 10px;">
                        <button onclick="showPlaceDetails(${place.id})" style="padding: 8px 15px; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 14px;">
                            <i class="fas fa-info-circle"></i> Chi ti·∫øt
                        </button>
                        <button onclick="showDirectionsToPlace(${place.id})" style="padding: 8px 15px; background: #2196F3; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 14px;">
                            <i class="fas fa-route"></i> ƒê∆∞·ªùng ƒëi
                        </button>
                    </div>
                `;
                placesList.appendChild(placeCard);
            });
        }

        // LOAD L·ªÑ H·ªòI V·ªöI TH√îNG TIN CHI TI·∫æT
        function loadFestivals() {
            const festivalsList = document.getElementById('festivals-list');
            festivalsList.innerHTML = '';
            
            festivals.forEach(festival => {
                const festivalCard = document.createElement('div');
                festivalCard.className = 'festival-card';
                festivalCard.innerHTML = `
                    <h4>${festival.name}</h4>
                    <p><strong>T·ªânh th√†nh:</strong> ${festival.province}</p>
                    <p><strong>Th·ªùi gian:</strong> ${festival.time}</p>
                    <p><strong>ƒê·ªãa ƒëi·ªÉm:</strong> ${festival.location}</p>
                    <p><strong>M√¥ t·∫£:</strong> ${festival.description}</p>
                    <div style="margin-top: 15px; display: flex; gap: 10px; flex-wrap: wrap;">
                        <button onclick="showFestivalDetails(${festival.id})" style="padding: 8px 15px; background: #1a237e; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 13px;">
                            <i class="fas fa-info-circle"></i> Chi ti·∫øt l·ªÖ h·ªôi
                        </button>
                        <button onclick="filterByProvince('${festival.province}')" style="padding: 8px 15px; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 13px;">
                            <i class="fas fa-map-marker-alt"></i> ƒêi·ªÉm du l·ªãch ${festival.province}
                        </button>
                    </div>
                `;
                festivalsList.appendChild(festivalCard);
            });
        }

        // HI·ªÇN TH·ªä CHI TI·∫æT ƒê·ªäA ƒêI·ªÇM
        function showPlaceDetails(id) {
            const place = touristSpots.find(p => p.id === id);
            if (!place) return;
            
            const detailsDiv = document.getElementById('place-details');
            
            detailsDiv.innerHTML = `
                <h3>${place.name}</h3>
                
                <div class="tab-buttons">
                    <button class="tab-btn active" onclick="switchTab('info-tab', this)">Th√¥ng tin c∆° b·∫£n</button>
                    <button class="tab-btn" onclick="switchTab('history-tab', this)">L·ªãch s·ª≠ & Thuy·∫øt minh</button>
                    <button class="tab-btn" onclick="switchTab('facilities-tab', this)">Ti·ªán √≠ch xung quanh</button>
                    <button class="tab-btn" onclick="switchTab('navigation-tab', this)">H∆∞·ªõng d·∫´n ƒë∆∞·ªùng ƒëi</button>
                </div>
                
                <div id="info-tab" class="tab-content active">
                    <div style="display: flex; gap: 20px; margin: 20px 0; flex-wrap: wrap;">
                        <div style="flex: 1; min-width: 300px;">
                            <h4 style="color: #1a237e; margin-bottom: 15px;">
                                <i class="fas fa-info-circle"></i> Th√¥ng tin c∆° b·∫£n
                            </h4>
                            <p><strong>T·ªânh th√†nh:</strong> ${place.province}</p>
                            <p><strong>Lo·∫°i h√¨nh:</strong> ${getTypeName(place.type)}</p>
                            <p><strong>ƒê·ªãa ch·ªâ:</strong> ${place.address}</p>
                            <p><strong>Gi·ªù m·ªü c·ª≠a:</strong> ${place.hours}</p>
                            <p><strong>V√© v√†o c·ªïng:</strong> ${place.ticket}</p>
                            ${place.contact ? `<p><strong>Li√™n h·ªá:</strong> ${place.contact}</p>` : ''}
                            ${place.features ? `
                                <div style="margin-top: 15px;">
                                    <strong>ƒê·∫∑c ƒëi·ªÉm n·ªïi b·∫≠t:</strong>
                                    <ul style="margin-top: 5px; padding-left: 20px;">
                                        ${place.features.map(f => `<li>${f}</li>`).join('')}
                                    </ul>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                </div>
                
                <div id="history-tab" class="tab-content">
                    ${place.historical_narrative ? `
                        <div class="historical-narrative">
                            <h4 style="color: #1a237e; margin-bottom: 10px;">
                                <i class="fas fa-book-open"></i> Thuy·∫øt minh l·ªãch s·ª≠
                            </h4>
                            <p>${place.historical_narrative}</p>
                        </div>
                    ` : '<p>ƒêang c·∫≠p nh·∫≠t th√¥ng tin thuy·∫øt minh...</p>'}
                </div>
                
                <div id="facilities-tab" class="tab-content">
                    ${place.facilities && place.facilities.length > 0 ? `
                        <div style="margin-top: 25px;">
                            <h4 style="color: #1a237e; margin-bottom: 15px;">
                                <i class="fas fa-concierge-bell"></i> Ti·ªán √≠ch xung quanh
                            </h4>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px;">
                                ${place.facilities.map(facility => `
                                    <div class="facility-detail">
                                        <h5><i class="${getFacilityIcon(facility.type)}"></i> ${getFacilityName(facility.type)}</h5>
                                        <p><strong>T√™n:</strong> ${facility.name}</p>
                                        <p><strong>ƒê·ªãa ch·ªâ:</strong> ${facility.address || 'Kh√¥ng c√≥'}</p>
                                        <p><strong>ƒêi·ªán tho·∫°i:</strong> ${facility.phone || 'Kh√¥ng c√≥'}</p>
                                        <p><strong>Gi√°:</strong> ${facility.price || 'Li√™n h·ªá'}</p>
                                        <p><strong>Kho·∫£ng c√°ch:</strong> ${facility.distance}</p>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    ` : '<p>ƒêang c·∫≠p nh·∫≠t th√¥ng tin ti·ªán √≠ch...</p>'}
                </div>
                
                <div id="navigation-tab" class="tab-content">
                    <div class="navigation-section">
                        <h4 style="color: #1a237e; margin-bottom: 15px;">
                            <i class="fas fa-route"></i> H∆∞·ªõng d·∫´n ƒë∆∞·ªùng ƒëi ƒë·∫øn ${place.name}
                        </h4>
                        <p><strong>ƒê·ªãa ch·ªâ:</strong> ${place.address}</p>
                        <p><strong>T·ªça ƒë·ªô:</strong> ${place.coordinates[0]}, ${place.coordinates[1]}</p>
                        
                        <div style="margin-top: 20px;">
                            <button onclick="calculateRoute(${place.id})" style="padding: 10px 20px; background: #2196F3; color: white; border: none; border-radius: 5px; cursor: pointer;">
                                <i class="fas fa-directions"></i> T√≠nh to√°n ƒë∆∞·ªùng ƒëi
                            </button>
                        </div>
                        
                        <div id="route-instructions" style="margin-top: 20px;"></div>
                    </div>
                </div>
            `;
            
            map.flyTo(place.coordinates, 13);
            updateWeatherForLocation(place.coordinates);
        }

        // HI·ªÇN TH·ªä CHI TI·∫æT L·ªÑ H·ªòI
        function showFestivalDetails(id) {
            const festival = festivals.find(f => f.id === id);
            if (!festival) return;
            
            const detailsDiv = document.getElementById('place-details');
            
            detailsDiv.innerHTML = `
                <h3>${festival.name} - ${festival.province}</h3>
                
                <div class="tab-buttons">
                    <button class="tab-btn active" onclick="switchTab('festival-info', this)">Th√¥ng tin chung</button>
                    <button class="tab-btn" onclick="switchTab('festival-details', this)">Chi ti·∫øt l·ªÖ h·ªôi</button>
                    <button class="tab-btn" onclick="switchTab('festival-media', this)">H√¨nh ·∫£nh & Video</button>
                </div>
                
                <div id="festival-info" class="tab-content active">
                    <div style="display: flex; gap: 20px; margin: 20px 0; flex-wrap: wrap;">
                        <div style="flex: 1; min-width: 300px;">
                            <h4 style="color: #1a237e; margin-bottom: 15px;">
                                <i class="fas fa-info-circle"></i> Th√¥ng tin c∆° b·∫£n
                            </h4>
                            <p><strong>T·ªânh th√†nh:</strong> ${festival.province}</p>
                            <p><strong>Th·ªùi gian:</strong> ${festival.time}</p>
                            <p><strong>ƒê·ªãa ƒëi·ªÉm:</strong> ${festival.location}</p>
                            <p><strong>Li√™n h·ªá:</strong> ${festival.contact || 'ƒêang c·∫≠p nh·∫≠t'}</p>
                            <p><strong>M√¥ t·∫£:</strong> ${festival.description}</p>
                        </div>
                    </div>
                </div>
                
                <div id="festival-details" class="tab-content">
                    ${festival.detailed_info ? `
                        <div style="margin: 20px 0;">
                            <h4 style="color: #1a237e; margin-bottom: 15px;">
                                <i class="fas fa-history"></i> Ngu·ªìn g·ªëc & Truy·ªÅn thuy·∫øt
                            </h4>
                            <p>${festival.detailed_info.origin}</p>
                        </div>
                        
                        <div style="margin: 20px 0;">
                            <h4 style="color: #1a237e; margin-bottom: 15px;">
                                <i class="fas fa-book"></i> L·ªãch s·ª≠ ph√°t tri·ªÉn
                            </h4>
                            <p>${festival.detailed_info.history}</p>
                        </div>
                        
                        <div style="margin: 20px 0;">
                            <h4 style="color: #1a237e; margin-bottom: 15px;">
                                <i class="fas fa-star"></i> √ù nghƒ©a vƒÉn h√≥a
                            </h4>
                            <p>${festival.detailed_info.significance}</p>
                        </div>
                        
                        <div style="margin: 20px 0;">
                            <h4 style="color: #1a237e; margin-bottom: 15px;">
                                <i class="fas fa-list-ol"></i> C√°c nghi th·ª©c truy·ªÅn th·ªëng
                            </h4>
                            <ul style="padding-left: 20px;">
                                ${festival.detailed_info.traditions.map(tradition => `<li>${tradition}</li>`).join('')}
                            </ul>
                        </div>
                    ` : '<p>ƒêang c·∫≠p nh·∫≠t th√¥ng tin chi ti·∫øt...</p>'}
                </div>
                
                <div id="festival-media" class="tab-content">
                    ${festival.detailed_info && festival.detailed_info.media ? `
                        <div class="festival-media">
                            ${festival.detailed_info.media.map(media => `
                                <div class="media-item">
                                    <div style="height: 200px; background: #f0f0f0; display: flex; align-items: center; justify-content: center;">
                                        ${media.type === 'image' ? 
                                            `<img src="${media.url}" alt="${media.title}" style="max-width: 100%; max-height: 100%;">` :
                                            `<div style="text-align: center; color: #666;">
                                                <i class="fas fa-video" style="font-size: 48px;"></i>
                                                <p>${media.title}</p>
                                            </div>`
                                        }
                                    </div>
                                    <div class="media-caption">
                                        <strong>${media.title}</strong>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    ` : '<p>ƒêang c·∫≠p nh·∫≠t h√¨nh ·∫£nh v√† video...</p>'}
                </div>
            `;
        }

        // L·∫§Y V·ªä TR√ç NG∆Ø·ªúI D√ôNG
        function getUserLocation() {
            if (!navigator.geolocation) {
                alert("Tr√¨nh duy·ªát c·ªßa b·∫°n kh√¥ng h·ªó tr·ª£ ƒë·ªãnh v·ªã");
                return;
            }
            
            const locationInfo = document.getElementById('location-info');
            locationInfo.innerHTML = '<p><i class="fas fa-spinner fa-spin"></i> ƒêang l·∫•y v·ªã tr√≠...</p>';
            
            navigator.geolocation.getCurrentPosition(
                function(position) {
                    userLocation = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude
                    };
                    
                    locationInfo.innerHTML = `
                        <p style="color: #4CAF50;">
                            <i class="fas fa-check-circle"></i> ƒê√£ l·∫•y v·ªã tr√≠ th√†nh c√¥ng!
                        </p>
                        <p style="font-size: 14px;">
                            Vƒ© ƒë·ªô: ${userLocation.lat.toFixed(6)}<br>
                            Kinh ƒë·ªô: ${userLocation.lng.toFixed(6)}
                        </p>
                        <button onclick="showNearbyPlaces()" style="margin-top: 10px; padding: 8px 15px; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 13px;">
                            <i class="fas fa-map-marker-alt"></i> T√¨m ƒëi·ªÉm du l·ªãch g·∫ßn ƒë√¢y
                        </button>
                    `;
                    
                    // Th√™m marker v·ªã tr√≠ ng∆∞·ªùi d√πng
                    L.marker([userLocation.lat, userLocation.lng])
                        .addTo(map)
                        .bindPopup('<b>V·ªã tr√≠ c·ªßa b·∫°n</b>')
                        .openPopup();
                        
                    map.flyTo([userLocation.lat, userLocation.lng], 13);
                    
                    // C·∫≠p nh·∫≠t th·ªùi ti·∫øt cho v·ªã tr√≠ ng∆∞·ªùi d√πng
                    updateWeatherForLocation([userLocation.lat, userLocation.lng]);
                },
                function(error) {
                    let message = "Kh√¥ng th·ªÉ l·∫•y v·ªã tr√≠: ";
                    switch(error.code) {
                        case error.PERMISSION_DENIED:
                            message += "B·∫°n ƒë√£ t·ª´ ch·ªëi quy·ªÅn truy c·∫≠p v·ªã tr√≠";
                            break;
                        case error.POSITION_UNAVAILABLE:
                            message += "Th√¥ng tin v·ªã tr√≠ kh√¥ng kh·∫£ d·ª•ng";
                            break;
                        case error.TIMEOUT:
                            message += "H·∫øt th·ªùi gian ch·ªù l·∫•y v·ªã tr√≠";
                            break;
                        default:
                            message += "L·ªói kh√¥ng x√°c ƒë·ªãnh";
                    }
                    locationInfo.innerHTML = `<p style="color: #f44336;">${message}</p>`;
                },
                {
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 0
                }
            );
        }

        // T√åM ƒêI·ªÇM DU L·ªäCH G·∫¶N ƒê√ÇY C√ì TH·ª® T·ª∞
        function showNearbyPlaces() {
            if (!userLocation) {
                getUserLocation();
                return;
            }
            
            // T√≠nh kho·∫£ng c√°ch v√† s·∫Øp x·∫øp
            const nearbySpots = touristSpots.map(spot => {
                const distance = calculateDistance(
                    userLocation.lat, userLocation.lng,
                    spot.coordinates[0], spot.coordinates[1]
                );
                return { ...spot, distance };
            }).sort((a, b) => a.distance - b.distance);
            
            // Ph√¢n lo·∫°i: <50km, 50-200km, >200km
            const veryNear = nearbySpots.filter(s => s.distance < 50);
            const near = nearbySpots.filter(s => s.distance >= 50 && s.distance <= 200);
            const far = nearbySpots.filter(s => s.distance > 200);
            
            const detailsDiv = document.getElementById('place-details');
            detailsDiv.innerHTML = `
                <h3><i class="fas fa-map-marker-alt"></i> ƒêi·ªÉm du l·ªãch g·∫ßn v·ªã tr√≠ c·ªßa b·∫°n</h3>
                
                ${veryNear.length > 0 ? `
                    <div style="margin: 30px 0;">
                        <h4 style="color: #4CAF50; border-bottom: 2px solid #4CAF50; padding-bottom: 5px;">
                            <i class="fas fa-walking"></i> R·∫•t g·∫ßn (< 50km)
                        </h4>
                        <div class="nearby-places">
                            ${veryNear.slice(0, 6).map(spot => `
                                <div class="nearby-place-card" onclick="showPlaceDetails(${spot.id})">
                                    <h4>${spot.name}</h4>
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin: 10px 0;">
                                        <span>${spot.province}</span>
                                        <span class="distance-badge">${spot.distance.toFixed(1)} km</span>
                                    </div>
                                    <p style="font-size: 14px; color: #666;">${spot.description.substring(0, 100)}...</p>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                ` : ''}
                
                ${near.length > 0 ? `
                    <div style="margin: 30px 0;">
                        <h4 style="color: #2196F3; border-bottom: 2px solid #2196F3; padding-bottom: 5px;">
                            <i class="fas fa-car"></i> C√≥ th·ªÉ ƒëi trong ng√†y (50-200km)
                        </h4>
                        <div class="nearby-places">
                            ${near.slice(0, 6).map(spot => `
                                <div class="nearby-place-card" onclick="showPlaceDetails(${spot.id})">
                                    <h4>${spot.name}</h4>
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin: 10px 0;">
                                        <span>${spot.province}</span>
                                        <span class="distance-badge">${spot.distance.toFixed(1)} km</span>
                                    </div>
                                    <p style="font-size: 14px; color: #666;">${spot.description.substring(0, 100)}...</p>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                ` : ''}
                
                ${far.length > 0 ? `
                    <div style="margin: 30px 0;">
                        <h4 style="color: #FF9800; border-bottom: 2px solid #FF9800; padding-bottom: 5px;">
                            <i class="fas fa-plane"></i> Xa (> 200km) - C·∫ßn l·∫≠p k·∫ø ho·∫°ch
                        </h4>
                        <div class="nearby-places">
                            ${far.slice(0, 4).map(spot => `
                                <div class="nearby-place-card" onclick="showPlaceDetails(${spot.id})">
                                    <h4>${spot.name}</h4>
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin: 10px 0;">
                                        <span>${spot.province}</span>
                                        <span class="distance-badge">${spot.distance.toFixed(1)} km</span>
                                    </div>
                                    <p style="font-size: 14px; color: #666;">${spot.description.substring(0, 100)}...</p>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                ` : ''}
                
                <div style="text-align: center; margin-top: 30px;">
                    <p>T·ªïng s·ªë ƒëi·ªÉm ƒë∆∞·ª£c ƒë·ªÅ xu·∫•t: ${veryNear.length + near.length + far.length} ƒëi·ªÉm</p>
                </div>
            `;
        }

        // C·∫¨P NH·∫¨T TH·ªúI TI·∫æT
        function updateWeatherForLocation(coords) {
            const weatherContent = document.getElementById('weather-content');
            weatherContent.innerHTML = '<p><i class="fas fa-spinner fa-spin"></i> ƒêang c·∫≠p nh·∫≠t th·ªùi ti·∫øt...</p>';
            
            // L·∫•y d·ªØ li·ªáu th·ªùi ti·∫øt th·ª±c t·∫ø (gi·∫£ l·∫≠p)
            setTimeout(() => {
                const weather = getWeatherData(coords);
                weatherContent.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap;">
                        <div>
                            <h4 style="margin: 0;">${weather.location}</h4>
                            <p style="opacity: 0.9; margin: 5px 0;">${weather.date}</p>
                        </div>
                        <div style="font-size: 2rem;">${weather.icon}</div>
                    </div>
                    
                    <div class="weather-info">
                        <div class="weather-item">
                            <p style="margin: 0; font-size: 12px;">Nhi·ªát ƒë·ªô</p>
                            <p style="margin: 0; font-size: 1.5rem; font-weight: bold;">${weather.temp}¬∞C</p>
                        </div>
                        
                        <div class="weather-item">
                            <p style="margin: 0; font-size: 12px;">ƒê·ªô ·∫©m</p>
                            <p style="margin: 0; font-size: 1.5rem; font-weight: bold;">${weather.humidity}%</p>
                        </div>
                        
                        <div class="weather-item">
                            <p style="margin: 0; font-size: 12px;">T√¨nh tr·∫°ng</p>
                            <p style="margin: 0; font-size: 1rem; font-weight: bold;">${weather.condition}</p>
                        </div>
                        
                        <div class="weather-item">
                            <p style="margin: 0; font-size: 12px;">Gi√≥</p>
                            <p style="margin: 0; font-size: 1rem; font-weight: bold;">${weather.wind}</p>
                        </div>
                    </div>
                    
                    <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.2);">
                        <p style="margin: 0; font-size: 14px;"><strong>L·ªùi khuy√™n:</strong> ${weather.advice}</p>
                    </div>
                `;
            }, 1000);
        }

        // T·∫†O L·ªò TR√åNH TH√îNG MINH
        function generateSmartItinerary() {
            const days = parseInt(document.getElementById('days-count').value);
            const province = document.getElementById('start-province').value;
            const interest = document.getElementById('main-interest').value;
            let budget = document.getElementById('budget').value;
            
            if (budget === 'custom') {
                budget = document.getElementById('custom-budget').value;
                if (!budget || budget < 1000000) {
                    alert('Vui l√≤ng nh·∫≠p ng√¢n s√°ch h·ª£p l·ªá (t·ªëi thi·ªÉu 1,000,000 VNƒê)');
                    return;
                }
            }
            budget = parseInt(budget);
            
            // T·∫°o l·ªô tr√¨nh chi ti·∫øt
            const itinerary = createDetailedItinerary(days, province, interest, budget);
            
            const resultsDiv = document.getElementById('itinerary-results');
            resultsDiv.innerHTML = `
                <div style="background: rgba(255,255,255,0.95); padding: 30px; border-radius: 15px; margin-top: 20px; color: #333;">
                    <h3 style="color: #1a237e; text-align: center; margin-bottom: 20px;">
                        <i class="fas fa-calendar-alt"></i> L·ªô tr√¨nh ${days} ng√†y ${days-1} ƒë√™m
                    </h3>
                    
                    <div class="budget-section">
                        <h4 style="color: #1a237e; margin-bottom: 15px;">
                            <i class="fas fa-money-bill-wave"></i> Ph√¢n b·ªï ng√¢n s√°ch: ${formatCurrency(budget)}
                        </h4>
                        <div class="budget-breakdown">
                            <div class="budget-item">
                                <p style="margin: 0; font-size: 12px;">Ch·ªó ·ªü</p>
                                <p style="margin: 0; font-size: 1.2rem; font-weight: bold; color: #4CAF50;">
                                    ${formatCurrency(itinerary.budgetBreakdown.accommodation)}
                                </p>
                            </div>
                            <div class="budget-item">
                                <p style="margin: 0; font-size: 12px;">ƒÇn u·ªëng</p>
                                <p style="margin: 0; font-size: 1.2rem; font-weight: bold; color: #FF9800;">
                                    ${formatCurrency(itinerary.budgetBreakdown.food)}
                                </p>
                            </div>
                            <div class="budget-item">
                                <p style="margin: 0; font-size: 12px;">Di chuy·ªÉn</p>
                                <p style="margin: 0; font-size: 1.2rem; font-weight: bold; color: #2196F3;">
                                    ${formatCurrency(itinerary.budgetBreakdown.transport)}
                                </p>
                            </div>
                            <div class="budget-item">
                                <p style="margin: 0; font-size: 12px;">V√© tham quan</p>
                                <p style="margin: 0; font-size: 1.2rem; font-weight: bold; color: #9C27B0;">
                                    ${formatCurrency(itinerary.budgetBreakdown.entrance)}
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    ${itinerary.days.map((day, index) => `
                        <div class="itinerary-day">
                            <div class="day-header">
                                <h4 style="margin: 0;">Ng√†y ${index + 1}</h4>
                                <span style="background: white; color: #1a237e; padding: 5px 10px; border-radius: 20px; font-size: 12px;">
                                    ${day.date}
                                </span>
                            </div>
                            
                            <div style="margin-bottom: 20px;">
                                <h5 style="color: #1a237e; margin-bottom: 10px;">
                                    <i class="fas fa-sun"></i> Bu·ªïi s√°ng
                                </h5>
                                ${day.morning.map(item => `
                                    <div class="recommendation-item">
                                        <strong>${item.time}:</strong> ${item.activity}
                                        ${item.location ? `<br><small><i class="fas fa-map-marker-alt"></i> ${item.location}</small>` : ''}
                                        ${item.contact ? `<br><small><i class="fas fa-phone"></i> ${item.contact}</small>` : ''}
                                    </div>
                                `).join('')}
                            </div>
                            
                            <div style="margin-bottom: 20px;">
                                <h5 style="color: #1a237e; margin-bottom: 10px;">
                                    <i class="fas fa-utensils"></i> ƒÇn tr∆∞a
                                </h5>
                                ${day.lunch.map(item => `
                                    <div class="recommendation-item">
                                        <strong>${item.name}</strong><br>
                                        <small><i class="fas fa-map-marker-alt"></i> ${item.address}</small><br>
                                        <small><i class="fas fa-phone"></i> ${item.phone}</small><br>
                                        <small><i class="fas fa-money-bill"></i> ${item.price}</small>
                                    </div>
                                `).join('')}
                            </div>
                            
                            <div style="margin-bottom: 20px;">
                                <h5 style="color: #1a237e; margin-bottom: 10px;">
                                    <i class="fas fa-cloud-sun"></i> Bu·ªïi chi·ªÅu
                                </h5>
                                ${day.afternoon.map(item => `
                                    <div class="recommendation-item">
                                        <strong>${item.time}:</strong> ${item.activity}
                                        ${item.location ? `<br><small><i class="fas fa-map-marker-alt"></i> ${item.location}</small>` : ''}
                                        ${item.contact ? `<br><small><i class="fas fa-phone"></i> ${item.contact}</small>` : ''}
                                    </div>
                                `).join('')}
                            </div>
                            
                            ${day.accommodation ? `
                                <div>
                                    <h5 style="color: #1a237e; margin-bottom: 10px;">
                                        <i class="fas fa-hotel"></i> Ch·ªó ngh·ªâ
                                    </h5>
                                    <div class="recommendation-item">
                                        <strong>${day.accommodation.name}</strong><br>
                                        <small><i class="fas fa-map-marker-alt"></i> ${day.accommodation.address}</small><br>
                                        <small><i class="fas fa-phone"></i> ${day.accommodation.phone}</small><br>
                                        <small><i class="fas fa-money-bill"></i> ${day.accommodation.price}</small>
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                    `).join('')}
                    
                    <div style="text-align: center; margin-top: 30px;">
                        <button onclick="saveItinerary()" style="padding: 12px 30px; background: #4CAF50; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; margin-right: 10px;">
                            <i class="fas fa-save"></i> L∆∞u l·ªô tr√¨nh
                        </button>
                        <button onclick="printItinerary()" style="padding: 12px 30px; background: #2196F3; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 16px;">
                            <i class="fas fa-print"></i> In l·ªô tr√¨nh
                        </button>
                    </div>
                </div>
            `;
        }

        // T·∫†O L·ªò TR√åNH CHI TI·∫æT
        function createDetailedItinerary(days, province, interest, budget) {
            // Ch·ªçn ƒë·ªãa ƒëi·ªÉm d·ª±a tr√™n s·ªü th√≠ch
            const spots = touristSpots.filter(spot => 
                spot.province === province || getProvinceNeighbors(province).includes(spot.province)
            ).slice(0, days * 2);
            
            // T√≠nh to√°n ng√¢n s√°ch
            const budgetPerDay = budget / days;
            const budgetBreakdown = {
                accommodation: Math.floor(budget * 0.4),
                food: Math.floor(budget * 0.3),
                transport: Math.floor(budget * 0.2),
                entrance: Math.floor(budget * 0.1)
            };
            
            // T·∫°o l·ªãch tr√¨nh t·ª´ng ng√†y
            const itineraryDays = [];
            const startDate = new Date();
            
            for (let i = 0; i < days; i++) {
                const currentDate = new Date(startDate);
                currentDate.setDate(startDate.getDate() + i);
                
                const daySpots = spots.slice(i * 2, (i + 1) * 2);
                
                itineraryDays.push({
                    date: currentDate.toLocaleDateString('vi-VN'),
                    morning: [
                        {
                            time: '08:00',
                            activity: `Tham quan ${daySpots[0]?.name || 'ƒëi·ªÉm du l·ªãch'}`,
                            location: daySpots[0]?.address,
                            contact: daySpots[0]?.contact
                        }
                    ],
                    lunch: [{
                        name: "Nh√† h√†ng ƒë·ªãa ph∆∞∆°ng",
                        address: "S·ªë 1, ƒë∆∞·ªùng ch√≠nh",
                        phone: "024 1234 5678",
                        price: "150.000 VNƒê/ng∆∞·ªùi"
                    }],
                    afternoon: [
                        {
                            time: '14:00',
                            activity: `Tham quan ${daySpots[1]?.name || 'ƒëi·ªÉm du l·ªãch'}`,
                            location: daySpots[1]?.address,
                            contact: daySpots[1]?.contact
                        }
                    ],
                    accommodation: i < days - 1 ? {
                        name: "Kh√°ch s·∫°n ƒë·ªãa ph∆∞∆°ng",
                        address: "S·ªë 2, ƒë∆∞·ªùng ch√≠nh",
                        phone: "024 8765 4321",
                        price: `${Math.floor(budgetBreakdown.accommodation / (days - 1)).toLocaleString()} VNƒê/ƒë√™m`
                    } : null
                });
            }
            
            return {
                days: itineraryDays,
                budgetBreakdown: budgetBreakdown,
                totalBudget: budget
            };
        }

        // H√ÄM H·ªñ TR·ª¢
        function switchTab(tabId, button) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            button.classList.add('active');
        }

        function getTypeName(type) {
            const typeNames = {
                'di_tich': 'Di t√≠ch l·ªãch s·ª≠',
                'tham_quan': 'Th·∫Øng c·∫£nh',
                'bao_tang': 'B·∫£o t√†ng',
                'am_thuc': '·∫®m th·ª±c',
                'le_hoi': 'L·ªÖ h·ªôi',
                'nghi_duong': 'Ngh·ªâ d∆∞·ª°ng',
                'mua_sam': 'Mua s·∫Øm',
                'tam_linh': 'T√¢m linh',
                'van_hoa': 'VƒÉn h√≥a d√¢n t·ªôc'
            };
            return typeNames[type] || 'ƒêi·ªÉm tham quan';
        }

        function getFacilityIcon(type) {
            const icons = {
                'hotel': 'fas fa-hotel',
                'restaurant': 'fas fa-utensils',
                'parking': 'fas fa-parking',
                'transport': 'fas fa-car',
                'hospital': 'fas fa-hospital',
                'cafe': 'fas fa-coffee'
            };
            return icons[type] || 'fas fa-info-circle';
        }

        function getFacilityName(type) {
            const names = {
                'hotel': 'Kh√°ch s·∫°n',
                'restaurant': 'Nh√† h√†ng',
                'parking': 'B√£i ƒë·ªó xe',
                'transport': 'Ph∆∞∆°ng ti·ªán',
                'hospital': 'B·ªánh vi·ªán',
                'cafe': 'Qu√°n c√† ph√™'
            };
            return names[type] || 'Ti·ªán √≠ch';
        }

        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371;
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = 
                Math.sin(dLat/2) * Math.sin(dLat/2) +
                Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * 
                Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        function getWeatherData(coords) {
            const locations = {
                'H√† N·ªôi': { temp: 25, humidity: 75, wind: 'ƒê√¥ng Nam 10km/h', icon: '‚òÄÔ∏è' },
                'Hu·∫ø': { temp: 28, humidity: 85, wind: 'B·∫Øc 15km/h', icon: '‚õÖ' },
                'ƒê√† N·∫µng': { temp: 30, humidity: 80, wind: 'ƒê√¥ng 12km/h', icon: '‚òÄÔ∏è' },
                'TP H·ªì Ch√≠ Minh': { temp: 32, humidity: 78, wind: 'T√¢y Nam 8km/h', icon: 'üå§Ô∏è' }
            };
            
            // X√°c ƒë·ªãnh v·ªã tr√≠ g·∫ßn nh·∫•t
            let nearestLocation = 'H√† N·ªôi';
            let minDistance = Infinity;
            
            for (const [location, data] of Object.entries(locations)) {
                const locationCoords = getProvinceCenter(location);
                const distance = calculateDistance(coords[0], coords[1], locationCoords[0], locationCoords[1]);
                if (distance < minDistance) {
                    minDistance = distance;
                    nearestLocation = location;
                }
            }
            
            const weather = locations[nearestLocation];
            const conditions = ['N·∫Øng ƒë·∫πp', '√çt m√¢y', 'M√¢y r·∫£i r√°c', 'Tr·ªùi trong'];
            const advices = [
                'Th·ªùi ti·∫øt thu·∫≠n l·ª£i cho du l·ªãch',
                'N√™n mang theo √¥ d√π ph√≤ng m∆∞a',
                'M·∫∑c trang ph·ª•c tho√°ng m√°t',
                'Chu·∫©n b·ªã n∆∞·ªõc u·ªëng ƒë·∫ßy ƒë·ªß'
            ];
            
            return {
                location: nearestLocation,
                date: new Date().toLocaleDateString('vi-VN'),
                temp: weather.temp + Math.floor(Math.random() * 4) - 2,
                humidity: weather.humidity,
                wind: weather.wind,
                icon: weather.icon,
                condition: conditions[Math.floor(Math.random() * conditions.length)],
                advice: advices[Math.floor(Math.random() * advices.length)]
            };
        }

        function getProvinceCenter(province) {
            const centers = {
                'H√† N·ªôi': [21.0285, 105.8542],
                'Hu·∫ø': [16.4637, 107.5909],
                'ƒê√† N·∫µng': [16.0544, 108.2022],
                'TP H·ªì Ch√≠ Minh': [10.8231, 106.6297],
                'L·∫°ng S∆°n': [21.8537, 106.7619],
                'Sa Pa': [22.3364, 103.8440],
                'Ph√∫ Th·ªç': [21.3222, 105.4020],
                'Qu·∫£ng Ng√£i': [15.1214, 108.8044]
            };
            return centers[province] || [16.0, 108.0];
        }

        function getProvinceNeighbors(province) {
            const neighbors = {
                'H√† N·ªôi': ['Ph√∫ Th·ªç', 'L·∫°ng S∆°n'],
                'Hu·∫ø': ['ƒê√† N·∫µng', 'Qu·∫£ng Ng√£i'],
                'ƒê√† N·∫µng': ['Hu·∫ø', 'Qu·∫£ng Ng√£i'],
                'TP H·ªì Ch√≠ Minh': [],
                'L·∫°ng S∆°n': ['H√† N·ªôi'],
                'Sa Pa': ['L·∫°ng S∆°n'],
                'Ph√∫ Th·ªç': ['H√† N·ªôi'],
                'Qu·∫£ng Ng√£i': ['Hu·∫ø', 'ƒê√† N·∫µng']
            };
            return neighbors[province] || [];
        }

        function formatCurrency(amount) {
            return new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(amount);
        }

        function filterByProvince(province) {
            currentProvince = province;
            loadPlacesList();
            loadMarkers(touristSpots);
            updatePlaceCount();
            
            const provinceCenter = getProvinceCenter(province);
            if (province !== 'all') {
                map.flyTo(provinceCenter, 9);
                updateWeatherForLocation(provinceCenter);
            } else {
                map.flyTo(vietnamCenter, 6);
            }
        }

        function updatePlaceCount() {
            const count = touristSpots.filter(spot => 
                currentProvince === 'all' || spot.province === currentProvince
            ).length;
            
            const status = document.createElement('div');
            status.innerHTML = `
                <div style="background: #e8f5e9; padding: 10px 15px; border-radius: 8px; margin-top: 15px; text-align: center;">
                    <strong>ƒêang hi·ªÉn th·ªã ${count} ƒëi·ªÉm du l·ªãch</strong>
                    ${currentProvince !== 'all' ? ` t·∫°i ${currentProvince}` : ''}
                </div>
            `;
            
            const existingStatus = document.querySelector('#place-count-status');
            if (existingStatus) existingStatus.remove();
            
            status.id = 'place-count-status';
            document.getElementById('places-list').appendChild(status);
        }

        function loadMarkers(spots) {
            markers.forEach(marker => map.removeLayer(marker));
            markers = [];
            
            spots.forEach(spot => {
                if (currentProvince === 'all' || spot.province === currentProvince) {
                    const marker = L.marker(spot.coordinates)
                        .addTo(map)
                        .bindPopup(`
                            <div style="max-width: 250px;">
                                <h4 style="margin: 0; color: #1a237e;">${spot.name}</h4>
                                <p style="margin: 5px 0; color: #666; font-size: 13px;">${spot.province}</p>
                                <p style="margin: 5px 0; font-size: 12px;">${spot.description.substring(0, 80)}...</p>
                                <button onclick="showPlaceDetails(${spot.id})" style="width: 100%; padding: 6px; background: #4CAF50; color: white; border: none; border-radius: 3px; cursor: pointer; font-size: 11px;">
                                    Xem chi ti·∫øt
                                </button>
                            </div>
                        `);
                    markers.push(marker);
                }
            });
            
            if (markers.length > 0) {
                const group = new L.featureGroup(markers);
                map.fitBounds(group.getBounds().pad(0.1));
            }
        }

        function saveItinerary() {
            alert('L·ªô tr√¨nh ƒë√£ ƒë∆∞·ª£c l∆∞u th√†nh c√¥ng v√†o t√†i kho·∫£n c·ªßa b·∫°n!');
        }

        function printItinerary() {
            window.print();
        }

        function showDirectionsToPlace(placeId) {
            const place = touristSpots.find(p => p.id === placeId);
            if (!place) return;
            
            if (!userLocation) {
                alert("Vui l√≤ng l·∫•y v·ªã tr√≠ c·ªßa b·∫°n tr∆∞·ªõc ƒë·ªÉ s·ª≠ d·ª•ng t√≠nh nƒÉng n√†y");
                getUserLocation();
                return;
            }
            
            showPlaceDetails(placeId);
            switchTab('navigation-tab', document.querySelector('#navigation-tab').previousElementSibling);
            
            const routeInstructions = document.getElementById('route-instructions');
            const distance = calculateDistance(userLocation.lat, userLocation.lng, place.coordinates[0], place.coordinates[1]);
            
            routeInstructions.innerHTML = `
                <div style="background: white; padding: 15px; border-radius: 8px; margin-top: 15px;">
                    <h5 style="color: #1a237e; margin-bottom: 10px;">H∆∞·ªõng d·∫´n ƒë∆∞·ªùng ƒëi</h5>
                    <p><strong>Kho·∫£ng c√°ch:</strong> ${distance.toFixed(1)} km</p>
                    <p><strong>Th·ªùi gian di chuy·ªÉn ∆∞·ªõc t√≠nh:</strong> ${Math.round(distance / 40 * 60)} ph√∫t (b·∫±ng √¥ t√¥)</p>
                    <p><strong>Ph∆∞∆°ng ti·ªán ƒë·ªÅ xu·∫•t:</strong> √î t√¥ / Taxi</p>
                    <p><strong>Chi ph√≠ ∆∞·ªõc t√≠nh:</strong> ${(distance * 15000).toLocaleString()} VNƒê</p>
                    <div style="margin-top: 15px;">
                        <a href="https://maps.google.com/?q=${place.coordinates[0]},${place.coordinates[1]}" target="_blank" style="padding: 8px 15px; background: #4285F4; color: white; text-decoration: none; border-radius: 5px;">
                            <i class="fab fa-google"></i> M·ªü Google Maps
                        </a>
                    </div>
                </div>
            `;
        }

        // KH·ªûI ƒê·ªòNG
        window.onload = function() {
            console.log('VietTravelGuide Phi√™n b·∫£n 4.1 ƒë√£ s·∫µn s√†ng!');
            console.log('Ho√†ng Sa - Tr∆∞·ªùng Sa l√† c·ªßa Vi·ªát Nam!');
        };
    </script>
</body>
</html>
