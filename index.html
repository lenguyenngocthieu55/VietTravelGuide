<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VietTravelGuide - Hướng dẫn du lịch toàn diện Việt Nam</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Arial', sans-serif;
        }

        body {
            background: #f8f9fa;
            color: #333;
            line-height: 1.7;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: linear-gradient(135deg, #1a237e 0%, #283593 100%);
            color: white;
            padding: 70px 20px 50px;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        }

        h1 {
            font-size: 2.8rem;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .tagline {
            font-size: 1.3rem;
            opacity: 0.95;
            max-width: 900px;
            margin: 0 auto 30px;
            color: #e3f2fd;
        }

        /* Province Navigation */
        .province-nav {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin: 30px auto;
            max-width: 1200px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }

        .province-nav h3 {
            color: #1a237e;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.5rem;
        }

        .province-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
        }

        .province-btn {
            padding: 16px 10px;
            background: #f5f7ff;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 15px;
            font-weight: 500;
            color: #1a237e;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .province-btn:hover {
            background: #1a237e;
            color: white;
            border-color: #1a237e;
            transform: translateY(-3px);
        }

        .content-wrapper {
            display: flex;
            gap: 30px;
            margin-top: 30px;
        }

        .places-panel {
            flex: 1;
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            height: fit-content;
            max-height: 80vh;
            overflow-y: auto;
        }

        .places-panel h3 {
            color: #1a237e;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 3px solid #4CAF50;
            font-size: 1.4rem;
        }

        .details-panel {
            flex: 2;
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        .map-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
        }

        #map {
            height: 500px;
            border-radius: 10px;
            margin-top: 15px;
        }

        .place-details {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
        }

        .place-details h3 {
            color: #1a237e;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }

        .place-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 5px solid #4CAF50;
            transition: all 0.3s;
            cursor: pointer;
        }

        .place-card:hover {
            background: #e8f5e9;
            transform: translateX(5px);
        }

        .place-card h4 {
            color: #1a237e;
            margin-bottom: 10px;
            font-size: 1.2rem;
        }

        .place-meta {
            display: flex;
            gap: 15px;
            margin-bottom: 10px;
            font-size: 14px;
            color: #666;
        }

        .place-meta span {
            background: #e3f2fd;
            padding: 4px 12px;
            border-radius: 15px;
        }

        .place-description {
            color: #555;
            font-size: 15px;
            line-height: 1.6;
        }

        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin: 50px 0;
        }

        .feature-card {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            text-align: center;
        }

        .feature-card h3 {
            color: #1a237e;
            margin: 20px 0 15px;
            font-size: 1.3rem;
        }

        .feature-text {
            color: #666;
            font-size: 16px;
            line-height: 1.6;
        }

        .filter-section {
            background: white;
            padding: 25px;
            border-radius: 15px;
            margin: 30px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .filter-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-top: 15px;
        }

        .filter-btn {
            padding: 10px 20px;
            background: #f5f7ff;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }

        .filter-btn.active {
            background: #1a237e;
            color: white;
            border-color: #1a237e;
        }

        .itinerary-planner {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            border-radius: 15px;
            margin: 40px 0;
        }

        .planner-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-group input, .form-group select {
            padding: 12px;
            border-radius: 8px;
            border: none;
            font-size: 15px;
        }

        .facilities-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .facility-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        }

        .facility-card h4 {
            color: #1a237e;
            margin: 15px 0 10px;
        }

        footer {
            background: #1a237e;
            color: white;
            padding: 50px 20px 30px;
            margin-top: 60px;
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 40px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .footer-section h3 {
            margin-bottom: 20px;
            font-size: 1.2rem;
        }

        .copyright {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid rgba(255,255,255,0.1);
            color: rgba(255,255,255,0.8);
            font-size: 14px;
        }

        .festival-card {
            background: linear-gradient(135deg, #ffd54f 0%, #ffb300 100%);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            color: #333;
            cursor: pointer;
            transition: all 0.3s;
        }

        .festival-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.15);
        }

        .festival-card h4 {
            color: #1a237e;
            margin-bottom: 10px;
        }

        .social-links {
            display: flex;
            gap: 15px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .social-btn {
            padding: 8px 15px;
            background: #3b5998;
            color: white;
            border-radius: 5px;
            text-decoration: none;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }

        .social-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .social-btn.facebook { background: #3b5998; }
        .social-btn.youtube { background: #ff0000; }
        .social-btn.tiktok { background: #000000; }
        .social-btn.instagram { background: #e4405f; }
        .social-btn.zalo { background: #0068ff; }

        /* Weather and Navigation Styles */
        .weather-section {
            background: linear-gradient(135deg, #2196F3 0%, #21CBF3 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
        }

        .navigation-section {
            background: #e8f5e9;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 5px solid #4CAF50;
        }

        .location-btn {
            padding: 12px 25px;
            background: #1a237e;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
        }

        .location-btn:hover {
            background: #283593;
            transform: translateY(-2px);
        }

        .facility-detail {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin: 10px 0;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
        }

        .facility-detail h5 {
            color: #1a237e;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .historical-narrative {
            background: #fff3e0;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 4px solid #FF9800;
        }

        @media (max-width: 1024px) {
            .content-wrapper {
                flex-direction: column;
            }
            
            .places-panel {
                max-height: 400px;
            }
            
            .province-buttons {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }
            
            .tagline {
                font-size: 1.1rem;
            }
            
            .features {
                grid-template-columns: 1fr;
            }
            
            .planner-form {
                grid-template-columns: 1fr;
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .place-card, .feature-card, .facility-card, .festival-card {
            animation: fadeIn 0.5s ease-out;
        }

        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }

        .tab-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }

        .tab-btn {
            padding: 10px 20px;
            background: #f5f7ff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .tab-btn.active {
            background: #1a237e;
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease-out;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1><i class="fas fa-map-marked-alt"></i> VietTravelGuide</h1>
            <p class="tagline">Hệ thống hướng dẫn du lịch toàn diện - Khám phá tất cả điểm đến tại 8 tỉnh thành Việt Nam</p>
            <div style="margin-top: 20px;">
                <button class="location-btn" onclick="getUserLocation()">
                    <i class="fas fa-location-dot"></i> Lấy vị trí hiện tại
                </button>
                <div id="location-info" style="margin-top: 10px; color: #e3f2fd;"></div>
            </div>
        </div>
    </header>

    <div class="container">
        <div class="province-nav">
            <h3><i class="fas fa-map-marker-alt"></i> Chọn tỉnh thành để khám phá</h3>
            <div class="province-buttons">
                <button class="province-btn" onclick="filterByProvince('Hà Nội')">
                    <i class="fas fa-landmark"></i> Hà Nội
                </button>
                <button class="province-btn" onclick="filterByProvince('Huế')">
                    <i class="fas fa-history"></i> Huế
                </button>
                <button class="province-btn" onclick="filterByProvince('Đà Nẵng')">
                    <i class="fas fa-bridge"></i> Đà Nẵng
                </button>
                <button class="province-btn" onclick="filterByProvince('TP Hồ Chí Minh')">
                    <i class="fas fa-city"></i> TP Hồ Chí Minh
                </button>
                <button class="province-btn" onclick="filterByProvince('Lạng Sơn')">
                    <i class="fas fa-mountain"></i> Lạng Sơn
                </button>
                <button class="province-btn" onclick="filterByProvince('Sa Pa')">
                    <i class="fas fa-cloud"></i> Sa Pa
                </button>
                <button class="province-btn" onclick="filterByProvince('Phú Thọ')">
                    <i class="fas fa-tree"></i> Phú Thọ
                </button>
                <button class="province-btn" onclick="filterByProvince('Quảng Ngãi')">
                    <i class="fas fa-beach"></i> Quảng Ngãi
                </button>
                <button class="province-btn" onclick="filterByProvince('all')">
                    <i class="fas fa-globe-asia"></i> Tất cả địa điểm
                </button>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="content-wrapper">
            <div class="places-panel">
                <h3><i class="fas fa-list"></i> Danh sách điểm du lịch</h3>
                <div id="places-list"></div>
            </div>

            <div class="details-panel">
                <div class="map-container">
                    <h3><i class="fas fa-map"></i> Bản đồ du lịch</h3>
                    <div id="map"></div>
                </div>

                <div class="place-details" id="place-details">
                    <h3><i class="fas fa-info-circle"></i> Thông tin chi tiết</h3>
                    <p style="color: #666; text-align: center;">Chọn một điểm du lịch để xem thông tin chi tiết</p>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="features">
            <div class="feature-card">
                <div style="font-size: 2.5rem; color: #4CAF50; margin-bottom: 15px;">
                    <i class="fas fa-route"></i>
                </div>
                <h3>Lộ trình thông minh</h3>
                <p class="feature-text">Hệ thống AI tự động tạo lộ trình tối ưu dựa trên thời gian, khoảng cách và sở thích cá nhân.</p>
                <button onclick="showItineraryPlanner()" style="margin-top: 15px; padding: 10px 25px; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer;">
                    Tạo lộ trình ngay
                </button>
            </div>
            
            <div class="feature-card">
                <div style="font-size: 2.5rem; color: #FF9800; margin-bottom: 15px;">
                    <i class="fas fa-landmark"></i>
                </div>
                <h3>Di sản văn hóa</h3>
                <p class="feature-text">Cung cấp thông tin chi tiết về lịch sử, ý nghĩa văn hóa của từng di tích.</p>
                <button onclick="showCulturalHeritage()" style="margin-top: 15px; padding: 10px 25px; background: #FF9800; color: white; border: none; border-radius: 5px; cursor: pointer;">
                    Khám phá di sản
                </button>
            </div>
            
            <div class="feature-card">
                <div style="font-size: 2.5rem; color: #2196F3; margin-bottom: 15px;">
                    <i class="fas fa-concierge-bell"></i>
                </div>
                <h3>Tiện ích địa phương</h3>
                <p class="feature-text">Danh sách đầy đủ các tiện ích xung quanh: khách sạn, nhà hàng, y tế, mua sắm.</p>
                <button onclick="showLocalFacilities()" style="margin-top: 15px; padding: 10px 25px; background: #2196F3; color: white; border: none; border-radius: 5px; cursor: pointer;">
                    Xem tiện ích
                </button>
            </div>
            
            <div class="feature-card">
                <div style="font-size: 2.5rem; color: #9C27B0; margin-bottom: 15px;">
                    <i class="fas fa-heart"></i>
                </div>
                <h3>Sở thích cá nhân</h3>
                <p class="feature-text">Tùy chỉnh trải nghiệm du lịch theo sở thích: ẩm thực, nhiếp ảnh, trekking, lịch sử.</p>
                <button onclick="showPreferences()" style="margin-top: 15px; padding: 10px 25px; background: #9C27B0; color: white; border: none; border-radius: 5px; cursor: pointer;">
                    Chọn sở thích
                </button>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="filter-section">
            <h3><i class="fas fa-filter"></i> Lọc theo loại hình du lịch</h3>
            <div class="filter-buttons">
                <button class="filter-btn active" onclick="filterByType('all')">Tất cả</button>
                <button class="filter-btn" onclick="filterByType('di_tich')">Di tích lịch sử</button>
                <button class="filter-btn" onclick="filterByType('tham_quan')">Thắng cảnh</button>
                <button class="filter-btn" onclick="filterByType('bao_tang')">Bảo tàng</button>
                <button class="filter-btn" onclick="filterByType('am_thuc')">Ẩm thực</button>
                <button class="filter-btn" onclick="filterByType('le_hoi')">Lễ hội</button>
                <button class="filter-btn" onclick="filterByType('nghi_duong')">Nghỉ dưỡng</button>
                <button class="filter-btn" onclick="filterByType('mua_sam')">Mua sắm</button>
                <button class="filter-btn" onclick="filterByType('tam_linh')">Tâm linh</button>
                <button class="filter-btn" onclick="filterByType('van_hoa')">Văn hóa dân tộc</button>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="place-details">
            <h3><i class="fas fa-festival"></i> Lễ hội nổi tiếng các tỉnh thành</h3>
            <div id="festivals-list"></div>
        </div>
    </div>

    <div class="container">
        <div class="itinerary-planner" id="itinerary-section">
            <h3 style="color: white; text-align: center; margin-bottom: 10px;">
                <i class="fas fa-robot"></i> Lập lộ trình du lịch thông minh
            </h3>
            <p style="text-align: center; opacity: 0.9; margin-bottom: 30px;">
                Để chúng tôi giúp bạn lên kế hoạch chuyến đi hoàn hảo
            </p>
            
            <div class="planner-form">
                <div class="form-group">
                    <label>Số ngày du lịch</label>
                    <select id="days-count">
                        <option value="1">1 ngày</option>
                        <option value="2">2 ngày 1 đêm</option>
                        <option value="3" selected>3 ngày 2 đêm</option>
                        <option value="5">5 ngày 4 đêm</option>
                        <option value="7">7 ngày 6 đêm</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Tỉnh thành khởi hành</label>
                    <select id="start-province">
                        <option value="Hà Nội">Hà Nội</option>
                        <option value="Huế">Huế</option>
                        <option value="Đà Nẵng">Đà Nẵng</option>
                        <option value="TP Hồ Chí Minh">TP Hồ Chí Minh</option>
                        <option value="Lạng Sơn">Lạng Sơn</option>
                        <option value="Sa Pa">Sa Pa</option>
                        <option value="Phú Thọ">Phú Thọ</option>
                        <option value="Quảng Ngãi">Quảng Ngãi</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Sở thích chính</label>
                    <select id="main-interest">
                        <option value="lich_su">Lịch sử - Di tích</option>
                        <option value="thien_nhien">Thiên nhiên - Thắng cảnh</option>
                        <option value="am_thuc">Ẩm thực - Ẩm thực đường phố</option>
                        <option value="van_hoa">Văn hóa - Lễ hội</option>
                        <option value="nghi_duong">Nghỉ dưỡng - Thư giãn</option>
                        <option value="phieu_luu">Phiêu lưu - Trekking</option>
                    </select>
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 25px;">
                <button onclick="generateSmartItinerary()" style="padding: 15px 40px; background: white; color: #667eea; border: none; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer;">
                    <i class="fas fa-magic"></i> Tạo lộ trình tự động
                </button>
            </div>
            
            <div id="itinerary-results" style="margin-top: 30px;"></div>
        </div>
    </div>

    <div class="container">
        <div class="place-details">
            <h3><i class="fas fa-concierge-bell"></i> Tiện ích & Dịch vụ du lịch</h3>
            <div class="facilities-grid">
                <div class="facility-card">
                    <div style="font-size: 2rem; color: #FF5722;">
                        <i class="fas fa-hotel"></i>
                    </div>
                    <h4>Chỗ ở - Khách sạn</h4>
                    <p>Khách sạn 5 sao, 4 sao, 3 sao, nhà nghỉ, homestay, resort</p>
                </div>
                
                <div class="facility-card">
                    <div style="font-size: 2rem; color: #4CAF50;">
                        <i class="fas fa-utensils"></i>
                    </div>
                    <h4>Ẩm thực - Nhà hàng</h4>
                    <p>Nhà hàng đặc sản, quán ăn địa phương, ẩm thực đường phố</p>
                </div>
                
                <div class="facility-card">
                    <div style="font-size: 2rem; color: #2196F3;">
                        <i class="fas fa-first-aid"></i>
                    </div>
                    <h4>Y tế - Sức khỏe</h4>
                    <p>Bệnh viện, phòng khám, nhà thuốc, trạm y tế du lịch</p>
                </div>
                
                <div class="facility-card">
                    <div style="font-size: 2rem; color: #FF9800;">
                        <i class="fas fa-shopping-cart"></i>
                    </div>
                    <h4>Mua sắm - Quà lưu niệm</h4>
                    <p>Chợ đêm, trung tâm thương mại, cửa hàng đặc sản</p>
                </div>
                
                <div class="facility-card">
                    <div style="font-size: 2rem; color: #9C27B0;">
                        <i class="fas fa-bus"></i>
                    </div>
                    <h4>Di chuyển - Vận tải</h4>
                    <p>Thuê xe, taxi, xe buýt du lịch, vé tàu, vé máy bay</p>
                </div>
                
                <div class="facility-card">
                    <div style="font-size: 2rem; color: #795548;">
                        <i class="fas fa-info-circle"></i>
                    </div>
                    <h4>Thông tin du lịch</h4>
                    <p>Trung tâm du lịch, hướng dẫn viên, bản đồ, wifi công cộng</p>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Về VietTravelGuide</h3>
                    <p>Hệ thống hướng dẫn du lịch toàn diện nhất Việt Nam, cung cấp thông tin chi tiết về tất cả điểm du lịch tại 8 tỉnh thành trọng điểm.</p>
                    <p>Phiên bản: 4.0 - Dữ liệu cập nhật 2024</p>
                </div>
                
                <div class="footer-section">
                    <h3>8 Tỉnh Thành Chính</h3>
                    <p>• Hà Nội - Thủ đô nghìn năm</p>
                    <p>• Huế - Cố đô di sản</p>
                    <p>• Đà Nẵng - Thành phố đáng sống</p>
                    <p>• TP Hồ Chí Minh - Sài Gòn hoa lệ</p>
                    <p>• Lạng Sơn - Xứ sở địa đầu</p>
                    <p>• Sa Pa - Thị trấn sương mù</p>
                    <p>• Phú Thọ - Đất Tổ Vua Hùng</p>
                    <p>• Quảng Ngãi - Biển xanh cát trắng</p>
                </div>
                
                <div class="footer-section">
                    <h3>Liên hệ & Hỗ trợ</h3>
                    <p>Email: lenguyenngocthieu55@gmail.com</p>
                    <p>GitHub: lenguyenngocthieu55</p>
                    <p>Dự án mã nguồn mở - Tự do sử dụng và phát triển</p>
                </div>
            </div>
            
            <div class="copyright">
                <p>© 2024 VietTravelGuide - Bản quyền thuộc về lenguyenngocthieu55</p>
                <p>Dữ liệu được thu thập và xác thực từ các nguồn chính thống</p>
            </div>
        </div>
    </footer>

    <script>
        // ========== DU LỊCH VIỆT NAM - DỮ LIỆU TOÀN DIỆN 8 TỈNH THÀNH ==========
        
        const vietnamCenter = [16.0, 108.0];
        
        // DỮ LIỆU 8 TỈNH THÀNH (194 điểm + 30 điểm Quảng Ngãi + 30 điểm Hà Nội = 254 điểm)
        const touristSpots = [
            // ========== HÀ NỘI (30 điểm) ==========
            {
                id: 1,
                name: "Văn Miếu - Quốc Tử Giám",
                province: "Hà Nội",
                type: "di_tich",
                description: "Trường đại học đầu tiên của Việt Nam, xây dựng năm 1070 thời vua Lý Thánh Tông.",
                coordinates: [21.0285, 105.8355],
                address: "58 Quốc Tử Giám, Đống Đa, Hà Nội",
                hours: "7:30-17:30 hàng ngày",
                ticket: "30.000 VND",
                features: ["Kiến trúc cổ", "Bia Tiến sĩ", "Vườn bia", "Khuê Văn Các"],
                history: "Xây dựng năm 1070, thờ Khổng Tử và các bậc hiền triết",
                historical_narrative: "Văn Miếu được xây dựng năm 1070 dưới thời vua Lý Thánh Tông để thờ Khổng Tử và các bậc hiền triết. Đến năm 1076, vua Lý Nhân Tông lập thêm Quốc Tử Giám - trường đại học đầu tiên của Việt Nam. 82 bia Tiến sĩ tại đây được UNESCO công nhận là Di sản Tư liệu Thế giới.",
                facilities: [
                    {type: "hotel", name: "Khách sạn Hà Nội Boutique", distance: "500m"},
                    {type: "restaurant", name: "Nhà hàng Hà Nội 1985", distance: "300m"},
                    {type: "parking", name: "Bãi đỗ xe Văn Miếu", distance: "100m"}
                ],
                social: {
                    facebook: "https://facebook.com/vanmieuquoctugiam",
                    youtube: "https://youtube.com/c/VanMieuQuocTuGiam"
                }
            },
            {
                id: 2,
                name: "Hoàng thành Thăng Long",
                province: "Hà Nội",
                type: "di_tich",
                description: "Quần thể di tích gắn với lịch sử kinh thành Thăng Long, UNESCO Di sản thế giới.",
                coordinates: [21.0356, 105.8395],
                address: "19C Hoàng Diệu, Ba Đình, Hà Nội",
                hours: "8:00-17:00 (trừ thứ Hai)",
                ticket: "30.000 VND",
                features: ["Đoan Môn", "Hậu Lâu", "Cột cờ Hà Nội", "Khu khảo cổ"],
                history: "Trung tâm chính trị suốt 13 thế kỷ",
                historical_narrative: "Hoàng thành Thăng Long là quần thể di tích gắn liền với lịch sử kinh thành Thăng Long - Hà Nội, được UNESCO công nhận là Di sản văn hóa thế giới năm 2010. Nơi đây chứng kiến nhiều triều đại từ Lý, Trần, Lê đến Nguyễn.",
                facilities: [
                    {type: "hotel", name: "Sofitel Legend Metropole", distance: "800m"},
                    {type: "restaurant", name: "Nhà hàng Cội Nguồn", distance: "400m"},
                    {type: "hospital", name: "Bệnh viện Hữu Nghị", distance: "1.2km"}
                ],
                social: {
                    facebook: "https://facebook.com/hoangthanhthanglong",
                    youtube: "https://youtube.com/c/HoangThanhThangLong"
                }
            },
            {
                id: 3,
                name: "Hồ Hoàn Kiếm",
                province: "Hà Nội",
                type: "tham_quan",
                description: "Trái tim của thủ đô Hà Nội với Tháp Rùa, cầu Thê Húc và đền Ngọc Sơn.",
                coordinates: [21.0285, 105.8525],
                address: "Quận Hoàn Kiếm, Hà Nội",
                hours: "Cả ngày",
                ticket: "Miễn phí",
                features: ["Tháp Rùa", "Cầu Thê Húc", "Đền Ngọc Sơn", "Đài Nghiên"],
                historical_narrative: "Hồ Hoàn Kiếm gắn liền với truyền thuyết vua Lê Thái Tổ trả gươm thần cho Rùa Vàng. Tên hồ được đặt từ thế kỷ 15, là biểu tượng của Hà Nội ngàn năm văn hiến.",
                facilities: [
                    {type: "hotel", name: "Hilton Hanoi Opera", distance: "300m"},
                    {type: "restaurant", name: "Nhà hàng Cà phê Giảng", distance: "200m"},
                    {type: "shopping", name: "Trung tâm thương mại Vincom", distance: "500m"}
                ]
            },
            {
                id: 4,
                name: "Chùa Một Cột",
                province: "Hà Nội",
                type: "tam_linh",
                description: "Biểu tượng kiến trúc độc đáo của Hà Nội, được xây dựng từ năm 1049.",
                coordinates: [21.0366, 105.8353],
                address: "Chùa Một Cột, Đội Cấn, Ba Đình",
                hours: "7:00-18:00",
                ticket: "Miễn phí",
                features: ["Kiến trúc độc đáo", "Hoa sen", "Ao nước"],
                historical_narrative: "Chùa được xây dựng năm 1049 dưới thời vua Lý Thái Tông theo giấc mơ thấy Phật Bà Quan Âm ngồi trên tòa sen. Kiến trúc hình hoa sen là biểu tượng của sự thanh khiết trong Phật giáo.",
                facilities: [
                    {type: "hotel", name: "Hotel de l'Opera", distance: "600m"},
                    {type: "restaurant", name: "Quán ăn Ngon", distance: "400m"}
                ]
            },
            {
                id: 5,
                name: "Bảo tàng Hồ Chí Minh",
                province: "Hà Nội",
                type: "bao_tang",
                description: "Nơi lưu giữ và trưng bày về cuộc đời, sự nghiệp của Chủ tịch Hồ Chí Minh.",
                coordinates: [21.0372, 105.8350],
                address: "19 Ngọc Hà, Ba Đình, Hà Nội",
                hours: "8:00-11:30, 14:00-16:30 (trừ thứ Hai, thứ Sáu)",
                ticket: "40.000 VND",
                features: ["Hiện vật lịch sử", "Tư liệu quý", "Không gian trưng bày"],
                historical_narrative: "Bảo tàng khánh thành năm 1990 nhân kỷ niệm 100 năm ngày sinh Chủ tịch Hồ Chí Minh. Kiến trúc hình bông sen trắng tượng trưng cho sự thanh cao của Bác.",
                facilities: [
                    {type: "hotel", name: "Lotte Hotel Hanoi", distance: "1km"},
                    {type: "parking", name: "Bãi đỗ xe bảo tàng", distance: "100m"}
                ]
            },
            {
                id: 6,
                name: "Phố cổ Hà Nội",
                province: "Hà Nội",
                type: "van_hoa",
                description: "Khu phố cổ 36 phố phường với kiến trúc Pháp cổ và đời sống đặc trưng Hà Nội.",
                coordinates: [21.0350, 105.8490],
                address: "Quận Hoàn Kiếm, Hà Nội",
                hours: "Cả ngày",
                ticket: "Miễn phí",
                features: ["Phố Hàng Đào", "Phố Hàng Bạc", "Phố Hàng Mã", "Chợ Đồng Xuân"],
                historical_narrative: "Khu phố cổ hình thành từ thế kỷ 15, mỗi phố chuyên một nghề như Hàng Đào (vải), Hàng Bạc (kim hoàn), Hàng Mã (đồ thờ). Kiến trúc nhà ống đặc trưng với mặt tiền hẹp nhưng chiều sâu lớn.",
                facilities: [
                    {type: "hotel", name: "Essence Hanoi Hotel", distance: "100m"},
                    {type: "restaurant", name: "Bún chả Hương Liên", distance: "50m"},
                    {type: "shopping", name: "Chợ Đồng Xuân", distance: "200m"}
                ]
            },
            {
                id: 7,
                name: "Lăng Chủ tịch Hồ Chí Minh",
                province: "Hà Nội",
                type: "di_tich",
                description: "Nơi yên nghỉ của Chủ tịch Hồ Chí Minh, biểu tượng của lòng kính yêu với Bác.",
                coordinates: [21.0367, 105.8345],
                address: "Hùng Vương, Ba Đình, Hà Nội",
                hours: "7:30-10:30 (mùa hè), 8:00-11:00 (mùa đông)",
                ticket: "Miễn phí",
                features: ["Lăng Bác", "Nhà sàn Bác Hồ", "Vườn cây", "Bảo tàng"],
                historical_narrative: "Lăng được khánh thành năm 1975, là nơi lưu giữ thi hài Chủ tịch Hồ Chí Minh. Kiến trúc lăng mang hình bông sen cách điệu, thể hiện sự tôn kính của nhân dân với vị lãnh tụ kính yêu.",
                facilities: [
                    {type: "security", name: "Trạm an ninh", distance: "50m"},
                    {type: "parking", name: "Bãi đỗ xe khách", distance: "200m"}
                ]
            },
            {
                id: 8,
                name: "Nhà hát Lớn Hà Nội",
                province: "Hà Nội",
                type: "van_hoa",
                description: "Công trình kiến trúc Pháp tiêu biểu, trung tâm văn hóa nghệ thuật của thủ đô.",
                coordinates: [21.0245, 105.8592],
                address: "1 Tràng Tiền, Hoàn Kiếm, Hà Nội",
                hours: "Theo lịch biểu diễn",
                ticket: "Tùy chương trình",
                features: ["Kiến trúc Pháp", "Sân khấu chính", "Phòng hòa nhạc"],
                historical_narrative: "Xây dựng từ 1901-1911 theo thiết kế của kiến trúc sư người Pháp, là phiên bản thu nhỏ của Nhà hát Opera Paris. Nơi đây chứng kiến nhiều sự kiện lịch sử quan trọng của Việt Nam.",
                facilities: [
                    {type: "hotel", name: "Sofitel Metropole", distance: "150m"},
                    {type: "restaurant", name: "Nhà hàng Press Club", distance: "100m"}
                ]
            },
            {
                id: 9,
                name: "Cầu Long Biên",
                province: "Hà Nội",
                type: "di_tich",
                description: "Cây cầu thép đầu tiên bắc qua sông Hồng, chứng nhân lịch sử của Hà Nội.",
                coordinates: [21.0422, 105.8581],
                address: "Cầu Long Biên, Hoàn Kiếm, Hà Nội",
                hours: "Cả ngày",
                ticket: "Miễn phí",
                features: ["Kiến trúc cầu thép", "View sông Hồng", "Đường sắt giữa cầu"],
                historical_narrative: "Cầu được xây dựng từ 1899-1902, do Pháp thiết kế và thi công. Trong chiến tranh, cầu bị ném bom nhiều lần nhưng vẫn đứng vững, trở thành biểu tượng của sự kiên cường.",
                facilities: [
                    {type: "cafe", name: "Cà phê Long Biên", distance: "100m"},
                    {type: "parking", name: "Bãi đỗ xe đầu cầu", distance: "50m"}
                ]
            },
            {
                id: 10,
                name: "Đền Quán Thánh",
                province: "Hà Nội",
                type: "tam_linh",
                description: "Một trong Thăng Long tứ trấn, thờ Huyền Thiên Trấn Vũ - vị thần trấn giữ phía Bắc.",
                coordinates: [21.0416, 105.8374],
                address: "Quán Thánh, Ba Đình, Hà Nội",
                hours: "8:00-17:00",
                ticket: "Miễn phí",
                features: ["Tượng Trấn Vũ", "Chuông lớn", "Kiến trúc cổ"],
                historical_narrative: "Đền được xây dựng từ thời Lý (1010-1225) để thờ thánh Trấn Vũ - vị thần cai quản phương Bắc. Tượng thánh Trấn Vũ bằng đồng đen nặng 4 tấn là một kiệt tác nghệ thuật.",
                facilities: [
                    {type: "hotel", name: "InterContinental Hanoi", distance: "800m"},
                    {type: "restaurant", name: "Nhà hàng Hồ Tây", distance: "300m"}
                ]
            },
            // Thêm 20 điểm tiếp theo cho Hà Nội...
            {
                id: 11,
                name: "Hồ Tây",
                province: "Hà Nội",
                type: "tham_quan",
                description: "Hồ nước tự nhiên lớn nhất Hà Nội với cảnh quan đẹp và nhiều di tích xung quanh.",
                coordinates: [21.0531, 105.8226],
                address: "Quận Tây Hồ, Hà Nội",
                hours: "Cả ngày",
                ticket: "Miễn phí",
                features: ["Đường ven hồ", "Chùa Trấn Quốc", "Phủ Tây Hồ", "Quán cafe view hồ"],
                historical_narrative: "Hồ Tây hình thành từ một khúc sông Hồng cũ, có diện tích khoảng 500ha. Xung quanh hồ có nhiều di tích lịch sử như chùa Trấn Quốc, phủ Tây Hồ, đền Quán Thánh.",
                facilities: [
                    {type: "hotel", name: "Sheraton Hanoi Hotel", distance: "200m"},
                    {type: "restaurant", name: "Cà phê Sunset", distance: "100m"},
                    {type: "bike", name: "Cho thuê xe đạp", distance: "50m"}
                ]
            },
            {
                id: 12,
                name: "Chùa Trấn Quốc",
                province: "Hà Nội",
                type: "tam_linh",
                description: "Ngôi chùa cổ nhất Hà Nội, nằm trên bán đảo phía Đông Hồ Tây.",
                coordinates: [21.0479, 105.8362],
                address: "Đường Thanh Niên, Quận Tây Hồ, Hà Nội",
                hours: "7:30-11:30, 13:30-18:30",
                ticket: "Miễn phí",
                features: ["Bảo tháp 11 tầng", "Tượng Phật nghìn mắt nghìn tay", "Vườn tháp"],
                historical_narrative: "Chùa được xây dựng từ thời Lý Nam Đế (541-547), ban đầu có tên là Khai Quốc. Đến thời Lê Trung Hưng (1615) đổi tên thành Trấn Quốc với ý nghĩa trấn giữ đất nước.",
                facilities: [
                    {type: "parking", name: "Bãi đỗ xe chùa", distance: "100m"},
                    {type: "souvenir", name: "Quầy bán đồ lưu niệm", distance: "50m"}
                ]
            },
            {
                id: 13,
                name: "Bảo tàng Dân tộc học",
                province: "Hà Nội",
                type: "bao_tang",
                description: "Nơi trưng bày và bảo tồn văn hóa của 54 dân tộc Việt Nam.",
                coordinates: [21.0400, 105.7985],
                address: "Nguyễn Văn Huyên, Cầu Giấy, Hà Nội",
                hours: "8:30-17:30 (trừ thứ Hai)",
                ticket: "40.000 VND",
                features: ["Nhà sàn dân tộc", "Hiện vật văn hóa", "Khu trưng bày ngoài trời"],
                historical_narrative: "Bảo tàng khánh thành năm 1997, là công trình hợp tác giữa Việt Nam và Pháp. Kiến trúc hình cánh buồm của kiến trúc sư Hà Đức Lịnh được trao giải thưởng kiến trúc ASEAN.",
                facilities: [
                    {type: "cafe", name: "Café Bảo tàng", distance: "50m"},
                    {type: "parking", name: "Bãi đỗ xe rộng", distance: "100m"},
                    {type: "workshop", name: "Xưởng thủ công", distance: "80m"}
                ]
            },
            {
                id: 14,
                name: "Công viên Thủ Lệ",
                province: "Hà Nội",
                type: "tham_quan",
                description: "Công viên giải trí và vườn thú đầu tiên của Hà Nội.",
                coordinates: [21.0320, 105.8047],
                address: "Bưởi, Tây Hồ, Hà Nội",
                hours: "7:00-18:00",
                ticket: "20.000 VND",
                features: ["Vườn thú", "Hồ nước", "Khu vui chơi trẻ em", "Công viên nước"],
                historical_narrative: "Công viên được xây dựng năm 1975 trên khu đất của làng Thủ Lệ cũ. Đây là vườn thú đầu tiên tại miền Bắc Việt Nam với nhiều loài động vật quý hiếm.",
                facilities: [
                    {type: "food", name: "Khu ẩm thực", distance: "100m"},
                    {type: "parking", name: "Bãi đỗ xe công viên", distance: "150m"},
                    {type: "toilet", name: "Nhà vệ sinh công cộng", distance: "50m"}
                ]
            },
            {
                id: 15,
                name: "Làng gốm Bát Tràng",
                province: "Hà Nội",
                type: "van_hoa",
                description: "Làng nghề gốm sứ truyền thống nổi tiếng hơn 500 năm tuổi.",
                coordinates: [21.0522, 105.9065],
                address: "Xã Bát Tràng, Gia Lâm, Hà Nội",
                hours: "8:00-18:00",
                ticket: "Miễn phí",
                features: ["Xưởng gốm", "Lò nung", "Trải nghiệm làm gốm", "Chợ gốm"],
                historical_narrative: "Làng Bát Tràng hình thành từ thế kỷ 14-15, chuyên sản xuất gồm sứ cung đình. Tên Bát Tràng có nghĩa là 'xưởng làm bát', thể hiện truyền thống làm gốm lâu đời.",
                facilities: [
                    {type: "workshop", name: "Xưởng trải nghiệm", distance: "50m"},
                    {type: "restaurant", name: "Nhà hàng đặc sản gốm", distance: "100m"},
                    {type: "shopping", name: "Chợ gốm Bát Tràng", distance: "80m"}
                ]
            },
            {
                id: 16,
                name: "Vườn quốc gia Ba Vì",
                province: "Hà Nội",
                type: "tham_quan",
                description: "Khu bảo tồn thiên nhiên với hệ sinh thái đa dạng và đỉnh núi cao 1.296m.",
                coordinates: [21.0833, 105.3667],
                address: "Huyện Ba Vì, Hà Nội",
                hours: "7:00-17:00",
                ticket: "60.000 VND",
                features: ["Đỉnh Vua", "Đền Thượng", "Suối khoáng", "Rừng nguyên sinh"],
                historical_narrative: "Vườn quốc gia Ba Vì được thành lập năm 1991, là nơi bảo tồn hệ sinh thái rừng nhiệt đới. Đỉnh Vua cao 1.296m là nơi xây dựng đền thờ Bác Hồ.",
                facilities: [
                    {type: "hotel", name: "Resort Ba Vì", distance: "500m"},
                    {type: "camping", name: "Khu cắm trại", distance: "200m"},
                    {type: "restaurant", name: "Nhà hàng đồng quê", distance: "300m"}
                ]
            },
            {
                id: 17,
                name: "Khu du lịch sinh thái Hồ Đồng Mô",
                province: "Hà Nội",
                type: "nghi_duong",
                description: "Khu du lịch sinh thái với hồ nước rộng và sân golf quốc tế.",
                coordinates: [21.0833, 105.4167],
                address: "Thị xã Sơn Tây, Hà Nội",
                hours: "Cả ngày",
                ticket: "Miễn phí vào cổng",
                features: ["Sân golf 36 lỗ", "Khu nghỉ dưỡng", "Thể thao dưới nước", "Cắm trại"],
                facilities: [
                    {type: "resort", name: "Golf Resort Đồng Mô", distance: "100m"},
                    {type: "golf", name: "Sân golf Đồng Mô", distance: "50m"},
                    {type: "restaurant", name: "Nhà hàng view hồ", distance: "150m"}
                ]
            },
            {
                id: 18,
                name: "Đình làng Đình Bảng",
                province: "Hà Nội",
                type: "di_tich",
                description: "Ngôi đình cổ nhất và đẹp nhất Việt Nam với kiến trúc gỗ độc đáo.",
                coordinates: [21.1210, 105.9472],
                address: "Thị trấn Từ Sơn, Bắc Ninh (cạnh Hà Nội)",
                hours: "8:00-17:00",
                ticket: "20.000 VND",
                features: ["Kiến trúc gỗ lim", "Chạm khắc tinh xảo", "Sân đình rộng"],
                historical_narrative: "Đình được xây dựng năm 1700, là công trình kiến trúc gỗ tiêu biểu của người Việt. Tất cả kết cấu đều bằng gỗ lim với những hoa văn chạm khắc tinh xảo.",
                facilities: [
                    {type: "parking", name: "Bãi đỗ xe đình", distance: "100m"},
                    {type: "guide", name: "Dịch vụ hướng dẫn viên", distance: "50m"}
                ]
            },
            {
                id: 19,
                name: "Chợ đêm Hà Nội",
                province: "Hà Nội",
                type: "mua_sam",
                description: "Khu phố đi bộ và chợ đêm sầm uất vào cuối tuần tại phố cổ Hà Nội.",
                coordinates: [21.0350, 105.8495],
                address: "Phố Hàng Đào, Hàng Ngang, Hoàn Kiếm",
                hours: "19:00-24:00 (thứ 6,7,CN)",
                ticket: "Miễn phí",
                features: ["Phố đi bộ", "Biểu diễn đường phố", "Ẩm thực đường phố", "Đồ lưu niệm"],
                historical_narrative: "Chợ đêm Hà Nội được tổ chức từ năm 2004, biến các con phố cổ thành không gian văn hóa cộng đồng. Đây là nơi giao lưu văn hóa giữa du khách và người dân địa phương.",
                facilities: [
                    {type: "food", name: "Khu ẩm thực đường phố", distance: "20m"},
                    {type: "police", name: "Trạm cảnh sát du lịch", distance: "100m"},
                    {type: "toilet", name: "Nhà vệ sinh công cộng", distance: "50m"}
                ]
            },
            {
                id: 20,
                name: "Bảo tàng Phụ nữ Việt Nam",
                province: "Hà Nội",
                type: "bao_tang",
                description: "Bảo tàng về lịch sử, văn hóa và vai trò của phụ nữ Việt Nam.",
                coordinates: [21.0250, 105.8515],
                address: "36 Lý Thường Kiệt, Hoàn Kiếm, Hà Nội",
                hours: "8:00-17:00",
                ticket: "30.000 VND",
                features: ["Trưng bày phụ nữ", "Văn hóa các dân tộc", "Thời trang truyền thống"],
                historical_narrative: "Bảo tàng thành lập năm 1987, được TripAdvisor bình chọn là một trong những bảo tàng hấp dẫn nhất Việt Nam. Nơi đây tôn vinh vai trò của phụ nữ trong lịch sử và văn hóa Việt.",
                facilities: [
                    {type: "cafe", name: "Café bảo tàng", distance: "50m"},
                    {type: "souvenir", name: "Cửa hàng lưu niệm", distance: "30m"},
                    {type: "library", name: "Thư viện chuyên đề", distance: "100m"}
                ]
            },
            {
                id: 21,
                name: "Nhà tù Hỏa Lò",
                province: "Hà Nội",
                type: "di_tich",
                description: "Di tích lịch sử từng là nhà tù thực dân Pháp, nay là bảo tàng.",
                coordinates: [21.0251, 105.8468],
                address: "1 Hỏa Lò, Hoàn Kiếm, Hà Nội",
                hours: "8:00-17:00",
                ticket: "30.000 VND",
                features: ["Khu trưng bày", "Phòng giam tái hiện", "Máy chém", "Đường hầm đào tẩu"],
                historical_narrative: "Nhà tù được xây dựng năm 1896, nơi giam giữ nhiều chiến sĩ cách mạng Việt Nam. Tên 'Hỏa Lò' xuất phát từ khu vực trước đây chuyên bán bếp lò.",
                facilities: [
                    {type: "parking", name: "Bãi đỗ xe bảo tàng", distance: "100m"},
                    {type: "guide", name: "Dịch vụ thuyết minh", distance: "50m"}
                ]
            },
            {
                id: 22,
                name: "Công viên nước Hồ Tây",
                province: "Hà Nội",
                type: "nghi_duong",
                description: "Công viên nước lớn nhất Hà Nội với nhiều trò chơi cảm giác mạnh.",
                coordinates: [21.0550, 105.8230],
                address: "614 Lạc Long Quân, Tây Hồ, Hà Nội",
                hours: "8:30-18:00 (mùa hè)",
                ticket: "150.000 VND",
                features: ["Hồ sóng nhân tạo", "Vòng trượt tốc độ", "Khu trẻ em", "Bể bơi Olympic"],
                facilities: [
                    {type: "locker", name: "Tủ đồ an toàn", distance: "30m"},
                    {type: "food", name: "Khu ẩm thực công viên", distance: "50m"},
                    {type: "firstaid", name: "Trạm y tế", distance: "100m"}
                ]
            },
            {
                id: 23,
                name: "Phố ẩm thực Tống Duy Tân",
                province: "Hà Nội",
                type: "am_thuc",
                description: "Con phố ẩm thực nổi tiếng với các món ăn đường phố đặc sắc.",
                coordinates: [21.0275, 105.8480],
                address: "Phố Tống Duy Tân, Hoàn Kiếm, Hà Nội",
                hours: "17:00-24:00",
                ticket: "Tùy món ăn",
                features: ["Bún chả", "Bánh mì", "Nem rán", "Bia hơi", "Các món nướng"],
                historical_narrative: "Con phố trở thành khu ẩm thực từ những năm 1990, tập trung các quán ăn đặc sản Hà Nội. Đây là điểm đến không thể bỏ qua cho du khách muốn khám phá ẩm thực đường phố.",
                facilities: [
                    {type: "restaurant", name: "Các quán ăn đường phố", distance: "10m"},
                    {type: "toilet", name: "WC công cộng", distance: "50m"},
                    {type: "trash", name: "Thùng rác phân loại", distance: "20m"}
                ]
            },
            {
                id: 24,
                name: "Khu vui chơi Times City",
                province: "Hà Nội",
                type: "mua_sam",
                description: "Tổ hợp trung tâm thương mại, giải trí và vui chơi hiện đại.",
                coordinates: [20.9942, 105.8608],
                address: "458 Minh Khai, Hai Bà Trưng, Hà Nội",
                hours: "9:00-22:00",
                ticket: "Miễn phí vào cổng",
                features: ["Vincom Mega Mall", "Thủy cung Times City", "Công viên giải trí", "Rạp chiếu phim"],
                facilities: [
                    {type: "shopping", name: "Vincom Mega Mall", distance: "0m"},
                    {type: "cinema", name: "CGV Cinema", distance: "50m"},
                    {type: "parking", name: "Bãi đỗ xe ngầm", distance: "100m"}
                ]
            },
            {
                id: 25,
                name: "Đền Hai Bà Trưng",
                province: "Hà Nội",
                type: "tam_linh",
                description: "Đền thờ Hai Bà Trưng - những nữ anh hùng dân tộc chống giặc ngoại xâm.",
                coordinates: [21.0180, 105.8420],
                address: "Đồng Nhân, Hai Bà Trưng, Hà Nội",
                hours: "8:00-18:00",
                ticket: "Miễn phí",
                features: ["Tượng Hai Bà Trưng", "Hồ bán nguyệt", "Sân đại bái", "Hậu cung"],
                historical_narrative: "Đền được xây dựng từ thế kỷ 12 để tưởng nhớ Hai Bà Trưng - những nữ tướng anh hùng đã lãnh đạo cuộc khởi nghĩa chống quân Hán năm 40-43 sau Công nguyên.",
                facilities: [
                    {type: "parking", name: "Bãi đỗ xe đền", distance: "80m"},
                    {type: "souvenir", name: "Quầy bán đồ thờ", distance: "30m"}
                ]
            },
            {
                id: 26,
                name: "Thành Cổ Loa",
                province: "Hà Nội",
                type: "di_tich",
                description: "Kinh đô của nhà nước Âu Lạc dưới thời An Dương Vương thế kỷ 3 TCN.",
                coordinates: [21.1150, 105.8667],
                address: "Xã Cổ Loa, Đông Anh, Hà Nội",
                hours: "7:30-17:00",
                ticket: "20.000 VND",
                features: ["Thành ốc xoắn", "Đền thờ An Dương Vương", "Giếng Ngọc", "Am thờ Mỵ Châu"],
                historical_narrative: "Thành được xây dựng thế kỷ 3 TCN, có cấu trúc hình xoắn ốc độc đáo với 9 vòng thành. Nơi đây gắn liền với truyền thuyết nỏ thần và mối tình bi thảm Mỵ Châu - Trọng Thủy.",
                facilities: [
                    {type: "parking", name: "Bãi đỗ xe di tích", distance: "100m"},
                    {type: "guide", name: "Dịch vụ hướng dẫn", distance: "50m"},
                    {type: "restaurant", name: "Nhà hàng đặc sản", distance: "200m"}
                ]
            },
            {
                id: 27,
                name: "Chợ Bưởi",
                province: "Hà Nội",
                type: "mua_sam",
                description: "Chợ truyền thống lớn nhất khu vực Tây Hồ, nổi tiếng với hoa quả tươi.",
                coordinates: [21.0480, 105.8015],
                address: "Đường Âu Cơ, Tây Hồ, Hà Nội",
                hours: "5:00-12:00",
                ticket: "Miễn phí",
                features: ["Hoa quả tươi", "Rau sạch", "Hải sản", "Đồ khô", "Quần áo"],
                historical_narrative: "Chợ có từ thời Pháp thuộc, ban đầu là chợ nhỏ ven hồ Tây. Tên Bưởi xuất phát từ khu vực trồng nhiều bưởi Diễn nổi tiếng. Ngày nay chợ là trung tâm buôn bán sầm uất.",
                facilities: [
                    {type: "parking", name: "Bãi đỗ xe chợ", distance: "150m"},
                    {type: "toilet", name: "Nhà vệ sinh công cộng", distance: "100m"},
                    {type: "atm", name: "ATM ngân hàng", distance: "50m"}
                ]
            },
            {
                id: 28,
                name: "Vườn hoa Chí Linh",
                province: "Hà Nội",
                type: "tham_quan",
                description: "Công viên trung tâm với tượng đài Lý Thái Tổ và view hồ Hoàn Kiếm đẹp.",
                coordinates: [21.0290, 105.8515],
                address: "Đinh Tiên Hoàng, Hoàn Kiếm, Hà Nội",
                hours: "Cả ngày",
                ticket: "Miễn phí",
                features: ["Tượng Lý Thái Tổ", "Tháp Hòa Phong", "Đài phun nước", "Không gian xanh"],
                historical_narrative: "Vườn hoa nằm tại vị trí trung tâm, trước đây là khu vực thành cổ Hà Nội. Tượng vua Lý Thái Tổ được dựng năm 2004 nhân kỷ niệm 50 năm giải phóng Thủ đô.",
                facilities: [
                    {type: "bench", name: "Ghế nghỉ công viên", distance: "20m"},
                    {type: "wifi", name: "Wifi công cộng", distance: "50m"},
                    {type: "camera", name: "Camera an ninh", distance: "30m"}
                ]
            },
            {
                id: 29,
                name: "Bảo tàng Mỹ thuật Việt Nam",
                province: "Hà Nội",
                type: "bao_tang",
                description: "Nơi trưng bày các tác phẩm mỹ thuật tiêu biểu của Việt Nam.",
                coordinates: [21.0280, 105.8485],
                address: "66 Nguyễn Thái Học, Ba Đình, Hà Nội",
                hours: "8:30-17:00",
                ticket: "40.000 VND",
                features: ["Tranh sơn mài", "Tượng cổ", "Đồ gốm sứ", "Nghệ thuật đương đại"],
                historical_narrative: "Bảo tàng được thành lập năm 1966, tọa lạc trong tòa nhà từng là trường nữ sinh Pháp. Kiến trúc Đông Dương kết hợp giữa Pháp và Việt tạo nên không gian trưng bày độc đáo.",
                facilities: [
                    {type: "cafe", name: "Café mỹ thuật", distance: "50m"},
                    {type: "library", name: "Thư viện chuyên ngành", distance: "100m"},
                    {type: "workshop", name: "Xưởng vẽ", distance: "80m"}
                ]
            },
            {
                id: 30,
                name: "Khu đô thị Royal City",
                province: "Hà Nội",
                type: "mua_sam",
                description: "Tổ hợp đô thị hiện đại với trung tâm thương mại, giải trí và căn hộ cao cấp.",
                coordinates: [21.0025, 105.8180],
                address: "72A Nguyễn Trãi, Thanh Xuân, Hà Nội",
                hours: "9:00-22:00",
                ticket: "Miễn phí vào cổng",
                features: ["Vincom Mega Mall", "Công viên nước trong nhà", "Sân trượt băng", "Rạp chiếu phim"],
                facilities: [
                    {type: "shopping", name: "Vincom Mega Mall", distance: "0m"},
                    {type: "cinema", name: "CGV Royal City", distance: "50m"},
                    {type: "parking", name: "Bãi đỗ xe ngầm", distance: "100m"},
                    {type: "foodcourt", name: "Khu ẩm thực", distance: "80m"}
                ]
            },
            // ========== CÁC TỈNH THÀNH KHÁC ==========
            {
                id: 31,
                name: "Đại Nội - Kinh thành Huế",
                province: "Huế",
                type: "di_tich",
                description: "Quần thể di tích cố đô Huế, UNESCO Di sản văn hóa thế giới năm 1993.",
                coordinates: [16.4675, 107.5775],
                address: "23 Tháng 8, Thành phố Huế",
                hours: "7:00-17:30",
                ticket: "150.000 VND",
                features: ["Ngọ Môn", "Điện Thái Hòa", "Tử Cấm Thành", "Cửu Đỉnh"],
                history: "Xây dựng từ 1805-1832 dưới triều Nguyễn",
                social: {
                    facebook: "https://facebook.com/dainoi.hue",
                    youtube: "https://youtube.com/c/DaiNoiHue"
                }
            },
            {
                id: 32,
                name: "Cầu Rồng Đà Nẵng",
                province: "Đà Nẵng",
                type: "tham_quan",
                description: "Cây cầu hình rồng độc đáo, phun lửa và nước vào cuối tuần.",
                coordinates: [16.0617, 108.2269],
                address: "Cầu Rồng, Quận Sơn Trà, Đà Nẵng",
                hours: "Cả ngày",
                ticket: "Miễn phí",
                features: ["Phun lửa: 21:00 chủ nhật", "Phun nước", "Chiếu sáng nghệ thuật"],
                social: {
                    facebook: "https://facebook.com/caurongdanang",
                    tiktok: "https://tiktok.com/@caurong_danang"
                }
            },
            // ... (Các điểm du lịch của các tỉnh khác giữ nguyên)
        ];

        // LỄ HỘI NỔI TIẾNG VỚI THÔNG TIN CHI TIẾT
        const festivals = [
            {
                id: 1,
                province: "Hà Nội",
                name: "Lễ hội Gióng",
                time: "Tháng 1-4 âm lịch",
                location: "Đền Phù Đổng, Gia Lâm",
                description: "Lễ hội tưởng nhớ Thánh Gióng - một trong tứ bất tử của tín ngưỡng Việt Nam.",
                detailed_info: {
                    origin: "Lễ hội xuất phát từ truyền thuyết Thánh Gióng đánh giặc Ân, thể hiện tinh thần yêu nước",
                    activities: [
                        "Rước kiệu từ đền Mẫu đến đền Thượng",
                        "Diễn lại trận đánh giặc Ân",
                        "Hội trận với 28 đạo quân tượng trưng",
                        "Lễ tế và dâng hương"
                    ],
                    participation_guide: {
                        best_time: "Sáng sớm ngày chính hội (6-9h)",
                        dress_code: "Trang phục lịch sự, kín đáo",
                        notes: "Không xô đẩy trong đám rước, tuân thủ hướng dẫn an ninh"
                    },
                    weather_advice: "Tháng 1-4 âm lịch thời tiết mát mẻ, nên mang theo ô dù phòng mưa nhẹ"
                }
            },
            {
                id: 2,
                province: "Hà Nội",
                name: "Lễ hội chùa Hương",
                time: "Tháng 1-3 âm lịch",
                location: "Chùa Hương, Mỹ Đức",
                description: "Lễ hội Phật giáo lớn nhất miền Bắc, thu hút hàng triệu du khách hàng năm.",
                detailed_info: {
                    origin: "Lễ hội bắt đầu từ thế kỷ 15, gắn với truyền thuyết Bà Chúa Ba (Quan Âm)",
                    activities: [
                        "Đi thuyền trên suối Yến",
                        "Vãn cảnh chùa Thiên Trù, chùa Hương Tích",
                        "Lễ Phật cầu an",
                        "Thưởng thức hát văn, hát chèo"
                    ],
                    participation_guide: {
                        best_time: "Tránh ngày rằm tháng Giêng (quá đông)",
                        dress_code: "Trang phục kín đáo, giày thể thao đi bộ",
                        notes: "Mua vé thuyền trước, chuẩn bị đồ ăn nhẹ"
                    },
                    weather_advice: "Mùa xuân se lạnh, nhiệt độ 15-25°C, nên mặc áo khoác nhẹ"
                }
            },
            {
                id: 3,
                province: "Huế",
                name: "Festival Huế",
                time: "2 năm một lần (tháng 4, 6)",
                location: "Thành phố Huế",
                description: "Sự kiện văn hóa nghệ thuật quốc tế lớn nhất Việt Nam.",
                detailed_info: {
                    origin: "Tổ chức lần đầu năm 2000 nhằm quảng bá di sản văn hóa Huế",
                    activities: [
                        "Lễ khai mạc tại sân vận động",
                        "Chương trình âm nhạc quốc tế",
                        "Trình diễn áo dài",
                        "Triển lãm nghệ thuật"
                    ],
                    participation_guide: {
                        best_time: "Các buổi tối có chương trình chính",
                        dress_code: "Tự do, có thể mặc áo dài truyền thống",
                        notes: "Đặt vé trước, đến sớm để có chỗ ngồi tốt"
                    },
                    weather_advice: "Tháng 4-6 Huế nóng, nhiệt độ 28-35°C, nên mang mũ, kem chống nắng"
                }
            },
            {
                id: 4,
                province: "Đà Nẵng",
                name: "Lễ hội pháo hoa quốc tế Đà Nẵng",
                time: "Hàng năm (tháng 6-7)",
                location: "Bờ sông Hàn, Đà Nẵng",
                description: "Cuộc thi pháo hoa quốc tế thu hút các đội từ khắp nơi trên thế giới.",
                detailed_info: {
                    origin: "Tổ chức từ năm 2008, là sự kiện văn hóa - du lịch thường niên",
                    activities: [
                        "Thi pháo hoa giữa các đội",
                        "Âm nhạc đường phố",
                        "Ẩm thực quốc tế",
                        "Triển lãm nghệ thuật"
                    ],
                    participation_guide: {
                        best_time: "Các tối thi đấu (thường 20h-21h)",
                        dress_code: "Thoải mái, đi giày thể thao",
                        notes: "Đến sớm để có vị trí xem tốt, không mang theo vật sắc nhọn"
                    },
                    weather_advice: "Mùa hè Đà Nẵng nóng ẩm, có thể có mưa, mang theo ô dù"
                }
            },
            {
                id: 5,
                province: "Phú Thọ",
                name: "Giỗ Tổ Hùng Vương",
                time: "10 tháng 3 âm lịch",
                location: "Khu di tích Đền Hùng",
                description: "Lễ hội quốc gia, ngày giỗ Tổ Hùng Vương - Quốc tổ của dân tộc Việt Nam.",
                detailed_info: {
                    origin: "Truyền thống có từ thời Hùng Vương, trở thành quốc lễ từ năm 2007",
                    activities: [
                        "Lễ dâng hương tại Đền Thượng",
                        "Rước kiệu từ chân núi lên đỉnh",
                        "Hát Xoan - di sản UNESCO",
                        "Các trò chơi dân gian"
                    ],
                    participation_guide: {
                        best_time: "Sáng sớm 10/3 âm lịch",
                        dress_code: "Trang phục nghiêm trang, kín đáo",
                        notes: "Không xô đẩy tại khu vực đền chính, tuân thủ phân luồng"
                    },
                    weather_advice: "Tháng 3 âm lịch thời tiết đẹp, 20-28°C, phù hợp cho hoạt động ngoài trời"
                }
            },
            {
                id: 6,
                province: "Quảng Ngãi",
                name: "Lễ hội cầu ngư Lý Sơn",
                time: "Tháng 2, 6 âm lịch",
                location: "Đảo Lý Sơn",
                description: "Lễ hội truyền thống của ngư dân đảo Lý Sơn, cầu cho mưa thuận gió hòa.",
                detailed_info: {
                    origin: "Lễ hội có từ hàng trăm năm, thể hiện tín ngưỡng thờ cá Ông của ngư dân",
                    activities: [
                        "Lễ rước cá Ông (cá voi)",
                        "Hát bả trạo (hát chèo thuyền)",
                        "Thi thả lưới",
                        "Cúng biển"
                    ],
                    participation_guide: {
                        best_time: "Sáng sớm ngày chính hội",
                        dress_code: "Thoải mái, có thể mặc trang phục biển",
                        notes: "Tôn trọng nghi lễ truyền thống, không làm ồn trong lúc hành lễ"
                    },
                    weather_advice: "Tháng 2,6 âm lịch biển êm, nắng đẹp, nhiệt độ 25-32°C"
                }
            }
        ];

        // BIẾN TOÀN CỤC
        let map;
        let markers = [];
        let currentFilter = 'all';
        let currentProvince = 'all';
        let userLocation = null;
        let routeLayer = null;

        // KHỞI TẠO WEBSITE
        document.addEventListener('DOMContentLoaded', function() {
            initMap();
            loadPlacesList();
            loadFestivals();
            updatePlaceCount();
            
            // Kiểm tra hỗ trợ Geolocation
            if ("geolocation" in navigator) {
                console.log("Trình duyệt hỗ trợ định vị");
            } else {
                document.getElementById('location-info').innerHTML = 
                    '<p style="color: #ff9800;">Trình duyệt không hỗ trợ định vị</p>';
            }
        });

        // KHỞI TẠO BẢN ĐỒ
        function initMap() {
            map = L.map('map').setView(vietnamCenter, 6);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '© OpenStreetMap contributors',
                maxZoom: 18
            }).addTo(map);
            
            loadMarkers(touristSpots);
        }

        // LOAD DANH SÁCH ĐỊA ĐIỂM
        function loadPlacesList() {
            const placesList = document.getElementById('places-list');
            placesList.innerHTML = '';
            
            touristSpots.forEach(place => {
                if ((currentProvince === 'all' || place.province === currentProvince) &&
                    (currentFilter === 'all' || place.type === currentFilter)) {
                    
                    const placeCard = document.createElement('div');
                    placeCard.className = 'place-card';
                    placeCard.innerHTML = `
                        <h4>${place.name}</h4>
                        <div class="place-meta">
                            <span>${place.province}</span>
                            <span>${getTypeName(place.type)}</span>
                        </div>
                        <p class="place-description">${place.description}</p>
                        <div style="margin-top: 10px; display: flex; gap: 10px;">
                            <button onclick="showPlaceDetails(${place.id})" style="padding: 8px 15px; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 14px;">
                                <i class="fas fa-info-circle"></i> Chi tiết
                            </button>
                            <button onclick="showDirectionsToPlace(${place.id})" style="padding: 8px 15px; background: #2196F3; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 14px;">
                                <i class="fas fa-route"></i> Đường đi
                            </button>
                        </div>
                    `;
                    placesList.appendChild(placeCard);
                }
            });
        }

        // LOAD LỄ HỘI VỚI TÍNH NĂNG MỞ RỘNG
        function loadFestivals() {
            const festivalsList = document.getElementById('festivals-list');
            festivalsList.innerHTML = '';
            
            festivals.forEach(festival => {
                const festivalCard = document.createElement('div');
                festivalCard.className = 'festival-card';
                festivalCard.innerHTML = `
                    <h4>${festival.name}</h4>
                    <p><strong>Tỉnh thành:</strong> ${festival.province}</p>
                    <p><strong>Thời gian:</strong> ${festival.time}</p>
                    <p><strong>Địa điểm:</strong> ${festival.location}</p>
                    <p><strong>Mô tả:</strong> ${festival.description}</p>
                    <div style="margin-top: 15px; display: flex; gap: 10px; flex-wrap: wrap;">
                        <button onclick="showFestivalDetails(${festival.id})" style="padding: 8px 15px; background: #1a237e; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 13px;">
                            <i class="fas fa-info-circle"></i> Chi tiết lễ hội
                        </button>
                        <button onclick="checkFestivalWeather('${festival.province}', '${festival.time}')" style="padding: 8px 15px; background: #2196F3; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 13px;">
                            <i class="fas fa-cloud-sun"></i> Xem thời tiết
                        </button>
                        <button onclick="filterByProvince('${festival.province}')" style="padding: 8px 15px; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 13px;">
                            <i class="fas fa-map-marker-alt"></i> Điểm du lịch ${festival.province}
                        </button>
                    </div>
                `;
                festivalsList.appendChild(festivalCard);
            });
        }

        // LOAD MARKERS TRÊN BẢN ĐỒ
        function loadMarkers(spots) {
            markers.forEach(marker => map.removeLayer(marker));
            markers = [];
            
            spots.forEach(spot => {
                if ((currentProvince === 'all' || spot.province === currentProvince) &&
                    (currentFilter === 'all' || spot.type === currentFilter)) {
                    
                    const marker = L.marker(spot.coordinates)
                        .addTo(map)
                        .bindPopup(`
                            <div style="max-width: 250px;">
                                <h4 style="margin: 0; color: #1a237e;">${spot.name}</h4>
                                <p style="margin: 5px 0; color: #666; font-size: 13px;">${spot.province} - ${getTypeName(spot.type)}</p>
                                <p style="margin: 5px 0; font-size: 12px;">${spot.description.substring(0, 100)}...</p>
                                <div style="display: flex; gap: 5px; margin-top: 10px;">
                                    <button onclick="showPlaceDetails(${spot.id})" style="flex: 1; padding: 6px; background: #4CAF50; color: white; border: none; border-radius: 3px; cursor: pointer; font-size: 11px;">
                                        Chi tiết
                                    </button>
                                    <button onclick="showDirectionsToPlace(${spot.id})" style="flex: 1; padding: 6px; background: #2196F3; color: white; border: none; border-radius: 3px; cursor: pointer; font-size: 11px;">
                                        Đường đi
                                    </button>
                                </div>
                            </div>
                        `);
                    
                    markers.push(marker);
                }
            });
            
            if (markers.length > 0) {
                const group = new L.featureGroup(markers);
                map.fitBounds(group.getBounds().pad(0.1));
            }
        }

        // HIỂN THỊ CHI TIẾT ĐỊA ĐIỂM VỚI THÔNG TIN MỞ RỘNG
        function showPlaceDetails(id) {
            const place = touristSpots.find(p => p.id === id);
            if (!place) return;
            
            const detailsDiv = document.getElementById('place-details');
            
            // Tạo HTML cho social links
            let socialHTML = '';
            if (place.social) {
                socialHTML = '<div class="social-links" style="margin-top: 15px;">';
                if (place.social.facebook) {
                    socialHTML += `<a href="${place.social.facebook}" target="_blank" class="social-btn facebook">
                        <i class="fab fa-facebook"></i> Facebook
                    </a>`;
                }
                if (place.social.youtube) {
                    socialHTML += `<a href="${place.social.youtube}" target="_blank" class="social-btn youtube">
                        <i class="fab fa-youtube"></i> YouTube
                    </a>`;
                }
                if (place.social.tiktok) {
                    socialHTML += `<a href="${place.social.tiktok}" target="_blank" class="social-btn tiktok">
                        <i class="fab fa-tiktok"></i> TikTok
                    </a>`;
                }
                if (place.social.instagram) {
                    socialHTML += `<a href="${place.social.instagram}" target="_blank" class="social-btn instagram">
                        <i class="fab fa-instagram"></i> Instagram
                    </a>`;
                }
                if (place.social.zalo) {
                    socialHTML += `<a href="${place.social.zalo}" target="_blank" class="social-btn zalo">
                        <i class="fab fa-zalo"></i> Zalo
                    </a>`;
                }
                socialHTML += '</div>';
            }
            
            // Tạo HTML cho tiện ích xung quanh
            let facilitiesHTML = '';
            if (place.facilities && place.facilities.length > 0) {
                facilitiesHTML = `
                    <div style="margin-top: 25px; padding: 20px; background: #f5f7ff; border-radius: 10px;">
                        <h4 style="color: #1a237e; margin-bottom: 15px;">
                            <i class="fas fa-concierge-bell"></i> Tiện ích xung quanh
                        </h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                            ${place.facilities.map(facility => `
                                <div class="facility-detail">
                                    <h5><i class="${getFacilityIcon(facility.type)}"></i> ${getFacilityName(facility.type)}</h5>
                                    <p><strong>Tên:</strong> ${facility.name}</p>
                                    <p><strong>Khoảng cách:</strong> ${facility.distance}</p>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            } else {
                facilitiesHTML = `
                    <div style="margin-top: 25px; padding: 20px; background: #f5f7ff; border-radius: 10px;">
                        <h4 style="color: #1a237e; margin-bottom: 15px;">
                            <i class="fas fa-concierge-bell"></i> Tiện ích xung quanh
                        </h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                            <div style="text-align: center; padding: 15px; background: white; border-radius: 8px;">
                                <i class="fas fa-hotel" style="color: #FF5722; font-size: 1.5rem;"></i>
                                <p style="margin: 5px 0; font-size: 14px;">Khách sạn</p>
                                <p style="font-size: 12px; color: #666;">Có nhiều lựa chọn</p>
                            </div>
                            <div style="text-align: center; padding: 15px; background: white; border-radius: 8px;">
                                <i class="fas fa-utensils" style="color: #4CAF50; font-size: 1.5rem;"></i>
                                <p style="margin: 5px 0; font-size: 14px;">Nhà hàng</p>
                                <p style="font-size: 12px; color: #666;">Đa dạng ẩm thực</p>
                            </div>
                            <div style="text-align: center; padding: 15px; background: white; border-radius: 8px;">
                                <i class="fas fa-car" style="color: #2196F3; font-size: 1.5rem;"></i>
                                <p style="margin: 5px 0; font-size: 14px;">Bãi đỗ xe</p>
                                <p style="font-size: 12px; color: #666;">Có sẵn</p>
                            </div>
                            <div style="text-align: center; padding: 15px; background: white; border-radius: 8px;">
                                <i class="fas fa-shopping-cart" style="color: #FF9800; font-size: 1.5rem;"></i>
                                <p style="margin: 5px 0; font-size: 14px;">Mua sắm</p>
                                <p style="font-size: 12px; color: #666;">Quà lưu niệm</p>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            // Tạo HTML cho thuyết minh lịch sử
            let historyHTML = '';
            if (place.historical_narrative) {
                historyHTML = `
                    <div class="historical-narrative">
                        <h4 style="color: #1a237e; margin-bottom: 10px;">
                            <i class="fas fa-book-open"></i> Thuyết minh lịch sử
                        </h4>
                        <p>${place.historical_narrative}</p>
                    </div>
                `;
            }
            
            // Tạo tab buttons và content
            detailsDiv.innerHTML = `
                <h3>${place.name}</h3>
                
                <div class="tab-buttons">
                    <button class="tab-btn active" onclick="switchTab('info-tab', this)">Thông tin cơ bản</button>
                    <button class="tab-btn" onclick="switchTab('history-tab', this)">Lịch sử & Thuyết minh</button>
                    <button class="tab-btn" onclick="switchTab('facilities-tab', this)">Tiện ích xung quanh</button>
                    <button class="tab-btn" onclick="switchTab('navigation-tab', this)">Hướng dẫn đường đi</button>
                </div>
                
                <div id="info-tab" class="tab-content active">
                    <div style="display: flex; gap: 20px; margin: 20px 0; flex-wrap: wrap;">
                        <div style="flex: 1; min-width: 300px;">
                            <h4 style="color: #1a237e; margin-bottom: 15px;">
                                <i class="fas fa-info-circle"></i> Thông tin cơ bản
                            </h4>
                            <p><strong>Tỉnh thành:</strong> ${place.province}</p>
                            <p><strong>Loại hình:</strong> ${getTypeName(place.type)}</p>
                            <p><strong>Địa chỉ:</strong> ${place.address || 'Đang cập nhật'}</p>
                            <p><strong>Giờ mở cửa:</strong> ${place.hours || 'Cả ngày'}</p>
                            <p><strong>Vé vào cổng:</strong> ${place.ticket || 'Miễn phí'}</p>
                            ${place.history ? `<p><strong>Lịch sử tóm tắt:</strong> ${place.history}</p>` : ''}
                            ${socialHTML}
                        </div>
                        <div style="flex: 1; min-width: 300px;">
                            <h4 style="color: #1a237e; margin-bottom: 15px;">
                                <i class="fas fa-map-marker-alt"></i> Mô tả chi tiết
                            </h4>
                            <p>${place.description}</p>
                            ${place.features ? `
                                <div style="margin-top: 15px;">
                                    <strong>Đặc điểm nổi bật:</strong>
                                    <ul style="margin-top: 5px; padding-left: 20px;">
                                        ${place.features.map(f => `<li>${f}</li>`).join('')}
                                    </ul>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px; text-align: center;">
                        <button onclick="showDirectionsToPlace(${place.id})" style="padding: 12px 25px; background: #2196F3; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 15px; margin-right: 10px;">
                            <i class="fas fa-route"></i> Hướng dẫn đường đi
                        </button>
                        <button onclick="addToItinerary(${place.id})" style="padding: 12px 25px; background: #4CAF50; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 15px;">
                            <i class="fas fa-plus"></i> Thêm vào lộ trình
                        </button>
                    </div>
                </div>
                
                <div id="history-tab" class="tab-content">
                    ${historyHTML || '<p>Đang cập nhật thông tin thuyết minh...</p>'}
                    <div style="margin-top: 20px;">
                        <h4 style="color: #1a237e; margin-bottom: 15px;">
                            <i class="fas fa-question-circle"></i> Tìm hiểu thêm
                        </h4>
                        <p>Để biết thêm thông tin chi tiết về lịch sử và văn hóa, bạn có thể:</p>
                        <ul style="margin-top: 10px; padding-left: 20px;">
                            <li>Tham gia tour có hướng dẫn viên tại điểm</li>
                            <li>Mua sách hướng dẫn tại quầy lưu niệm</li>
                            <li>Truy cập website chính thức của di tích</li>
                        </ul>
                    </div>
                </div>
                
                <div id="facilities-tab" class="tab-content">
                    ${facilitiesHTML}
                    <div style="margin-top: 20px;">
                        <button onclick="searchNearbyFacilities(${place.id})" style="padding: 10px 20px; background: #1a237e; color: white; border: none; border-radius: 5px; cursor: pointer;">
                            <i class="fas fa-search"></i> Tìm kiếm thêm tiện ích gần đây
                        </button>
                    </div>
                </div>
                
                <div id="navigation-tab" class="tab-content">
                    <div class="navigation-section">
                        <h4 style="color: #1a237e; margin-bottom: 15px;">
                            <i class="fas fa-route"></i> Hướng dẫn đường đi đến ${place.name}
                        </h4>
                        
                        <div id="navigation-options" style="margin: 15px 0;">
                            <p>Chọn phương thức di chuyển:</p>
                            <div style="display: flex; gap: 10px; margin-top: 10px;">
                                <button onclick="calculateRoute(${place.id}, 'driving')" style="padding: 8px 15px; background: #FF5722; color: white; border: none; border-radius: 5px; cursor: pointer;">
                                    <i class="fas fa-car"></i> Ô tô
                                </button>
                                <button onclick="calculateRoute(${place.id}, 'walking')" style="padding: 8px 15px; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer;">
                                    <i class="fas fa-walking"></i> Đi bộ
                                </button>
                                <button onclick="calculateRoute(${place.id}, 'bicycling')" style="padding: 8px 15px; background: #2196F3; color: white; border: none; border-radius: 5px; cursor: pointer;">
                                    <i class="fas fa-bicycle"></i> Xe đạp
                                </button>
                                <button onclick="calculateRoute(${place.id}, 'transit')" style="padding: 8px 15px; background: #9C27B0; color: white; border: none; border-radius: 5px; cursor: pointer;">
                                    <i class="fas fa-bus"></i> Xe buýt
                                </button>
                            </div>
                        </div>
                        
                        <div id="route-instructions" style="margin-top: 20px;"></div>
                        
                        <div style="margin-top: 20px;">
                            <p><strong>Địa chỉ:</strong> ${place.address}</p>
                            <p><strong>Tọa độ:</strong> ${place.coordinates[0]}, ${place.coordinates[1]}</p>
                            <p><strong>Lưu ý:</strong> Nên kiểm tra giao thông trước khi di chuyển</p>
                        </div>
                    </div>
                </div>
            `;
            
            // Fly to location on map
            map.flyTo(place.coordinates, 13);
            
            // Highlight marker
            markers.forEach(marker => {
                const latlng = marker.getLatLng();
                if (latlng.lat === place.coordinates[0] && latlng.lng === place.coordinates[1]) {
                    marker.openPopup();
                }
            });
        }

        // HIỂN THỊ CHI TIẾT LỄ HỘI
        function showFestivalDetails(id) {
            const festival = festivals.find(f => f.id === id);
            if (!festival) return;
            
            const detailsDiv = document.getElementById('place-details');
            
            detailsDiv.innerHTML = `
                <h3>${festival.name} - ${festival.province}</h3>
                
                <div class="tab-buttons">
                    <button class="tab-btn active" onclick="switchTab('festival-info', this)">Thông tin chung</button>
                    <button class="tab-btn" onclick="switchTab('festival-details', this)">Chi tiết lễ hội</button>
                    <button class="tab-btn" onclick="switchTab('festival-guide', this)">Hướng dẫn tham gia</button>
                    <button class="tab-btn" onclick="checkFestivalWeather('${festival.province}', '${festival.time}'); switchTab('festival-weather', this)">Thời tiết & Lưu ý</button>
                </div>
                
                <div id="festival-info" class="tab-content active">
                    <div style="display: flex; gap: 20px; margin: 20px 0; flex-wrap: wrap;">
                        <div style="flex: 1; min-width: 300px;">
                            <h4 style="color: #1a237e; margin-bottom: 15px;">
                                <i class="fas fa-info-circle"></i> Thông tin cơ bản
                            </h4>
                            <p><strong>Tỉnh thành:</strong> ${festival.province}</p>
                            <p><strong>Thời gian:</strong> ${festival.time}</p>
                            <p><strong>Địa điểm:</strong> ${festival.location}</p>
                            <p><strong>Mô tả:</strong> ${festival.description}</p>
                        </div>
                        <div style="flex: 1; min-width: 300px;">
                            <h4 style="color: #1a237e; margin-bottom: 15px;">
                                <i class="fas fa-map-marker-alt"></i> Vị trí trên bản đồ
                            </h4>
                            <div id="festival-map" style="height: 250px; border-radius: 8px; margin-top: 10px;"></div>
                            <button onclick="showProvincePlaces('${festival.province}')" style="margin-top: 15px; padding: 10px 20px; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer; width: 100%;">
                                <i class="fas fa-landmark"></i> Xem điểm du lịch ${festival.province}
                            </button>
                        </div>
                    </div>
                </div>
                
                <div id="festival-details" class="tab-content">
                    ${festival.detailed_info ? `
                        <div style="margin: 20px 0;">
                            <h4 style="color: #1a237e; margin-bottom: 15px;">
                                <i class="fas fa-history"></i> Nguồn gốc & Ý nghĩa
                            </h4>
                            <p>${festival.detailed_info.origin}</p>
                        </div>
                        
                        <div style="margin: 20px 0;">
                            <h4 style="color: #1a237e; margin-bottom: 15px;">
                                <i class="fas fa-calendar-check"></i> Các hoạt động chính
                            </h4>
                            <ul style="padding-left: 20px;">
                                ${festival.detailed_info.activities.map(activity => `<li>${activity}</li>`).join('')}
                            </ul>
                        </div>
                    ` : '<p>Đang cập nhật thông tin chi tiết...</p>'}
                </div>
                
                <div id="festival-guide" class="tab-content">
                    ${festival.detailed_info && festival.detailed_info.participation_guide ? `
                        <div style="margin: 20px 0;">
                            <h4 style="color: #1a237e; margin-bottom: 15px;">
                                <i class="fas fa-user-check"></i> Hướng dẫn tham gia
                            </h4>
                            
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                                <div style="background: white; padding: 15px; border-radius: 8px; box-shadow: 0 3px 10px rgba(0,0,0,0.08);">
                                    <h5><i class="fas fa-clock"></i> Thời điểm tốt nhất</h5>
                                    <p>${festival.detailed_info.participation_guide.best_time}</p>
                                </div>
                                
                                <div style="background: white; padding: 15px; border-radius: 8px; box-shadow: 0 3px 10px rgba(0,0,0,0.08);">
                                    <h5><i class="fas fa-tshirt"></i> Trang phục phù hợp</h5>
                                    <p>${festival.detailed_info.participation_guide.dress_code}</p>
                                </div>
                                
                                <div style="background: white; padding: 15px; border-radius: 8px; box-shadow: 0 3px 10px rgba(0,0,0,0.08);">
                                    <h5><i class="fas fa-exclamation-triangle"></i> Lưu ý quan trọng</h5>
                                    <p>${festival.detailed_info.participation_guide.notes}</p>
                                </div>
                            </div>
                        </div>
                        
                        <div style="margin-top: 25px; padding: 20px; background: #e8f5e9; border-radius: 10px;">
                            <h5 style="color: #1a237e; margin-bottom: 10px;">Mẹo tham gia lễ hội:</h5>
                            <ul style="padding-left: 20px;">
                                <li>Đến sớm để tránh đông đúc</li>
                                <li>Mang theo nước uống và đồ ăn nhẹ</li>
                                <li>Giữ gìn vệ sinh chung</li>
                                <li>Tuân thủ hướng dẫn của ban tổ chức</li>
                                <li>Chuẩn bị tiền mặt cho các dịch vụ nhỏ</li>
                            </ul>
                        </div>
                    ` : '<p>Đang cập nhật hướng dẫn tham gia...</p>'}
                </div>
                
                <div id="festival-weather" class="tab-content">
                    <div id="weather-content">
                        <p style="text-align: center; color: #666; margin: 50px 0;">Nhấn nút "Thời tiết & Lưu ý" để xem thông tin thời tiết cho lễ hội</p>
                    </div>
                </div>
                
                <div style="margin-top: 30px; text-align: center;">
                    <button onclick="filterByProvince('${festival.province}')" style="padding: 12px 25px; background: #1a237e; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 15px; margin-right: 10px;">
                        <i class="fas fa-map-marked-alt"></i> Khám phá du lịch ${festival.province}
                    </button>
                    <button onclick="showDirectionsToFestival('${festival.location}', '${festival.province}')" style="padding: 12px 25px; background: #2196F3; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 15px;">
                        <i class="fas fa-route"></i> Hướng dẫn đến lễ hội
                    </button>
                </div>
            `;
            
            // Tạo bản đồ nhỏ cho lễ hội
            setTimeout(() => {
                const festivalMap = L.map('festival-map').setView([16.0, 108.0], 6);
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '© OpenStreetMap contributors',
                    maxZoom: 18
                }).addTo(festivalMap);
                
                // Thêm marker cho tỉnh có lễ hội
                const provinceCenter = getProvinceCenter(festival.province);
                L.marker(provinceCenter).addTo(festivalMap)
                    .bindPopup(`<b>${festival.province}</b><br>${festival.name}`)
                    .openPopup();
                festivalMap.setView(provinceCenter, 9);
            }, 100);
        }

        // LẤY VỊ TRÍ NGƯỜI DÙNG
        function getUserLocation() {
            if (!navigator.geolocation) {
                alert("Trình duyệt của bạn không hỗ trợ định vị");
                return;
            }
            
            const locationInfo = document.getElementById('location-info');
            locationInfo.innerHTML = '<p><i class="fas fa-spinner fa-spin"></i> Đang lấy vị trí...</p>';
            
            navigator.geolocation.getCurrentPosition(
                function(position) {
                    userLocation = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude
                    };
                    
                    locationInfo.innerHTML = `
                        <p style="color: #4CAF50;">
                            <i class="fas fa-check-circle"></i> Đã lấy vị trí thành công!
                        </p>
                        <p style="font-size: 14px;">
                            Vĩ độ: ${userLocation.lat.toFixed(6)}<br>
                            Kinh độ: ${userLocation.lng.toFixed(6)}
                        </p>
                        <button onclick="showNearbyPlaces()" style="margin-top: 10px; padding: 8px 15px; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 13px;">
                            <i class="fas fa-map-marker-alt"></i> Tìm điểm du lịch gần đây
                        </button>
                    `;
                    
                    // Thêm marker vị trí người dùng lên bản đồ
                    L.marker([userLocation.lat, userLocation.lng])
                        .addTo(map)
                        .bindPopup('<b>Vị trí của bạn</b>')
                        .openPopup();
                        
                    // Fly to user location
                    map.flyTo([userLocation.lat, userLocation.lng], 13);
                },
                function(error) {
                    let message = "Không thể lấy vị trí: ";
                    switch(error.code) {
                        case error.PERMISSION_DENIED:
                            message += "Bạn đã từ chối quyền truy cập vị trí";
                            break;
                        case error.POSITION_UNAVAILABLE:
                            message += "Thông tin vị trí không khả dụng";
                            break;
                        case error.TIMEOUT:
                            message += "Hết thời gian chờ lấy vị trí";
                            break;
                        default:
                            message += "Lỗi không xác định";
                    }
                    locationInfo.innerHTML = `<p style="color: #f44336;">${message}</p>`;
                },
                {
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 0
                }
            );
        }

        // HƯỚNG DẪN ĐƯỜNG ĐI ĐẾN ĐỊA ĐIỂM
        function showDirectionsToPlace(placeId) {
            const place = touristSpots.find(p => p.id === placeId);
            if (!place) return;
            
            if (!userLocation) {
                alert("Vui lòng lấy vị trí của bạn trước để sử dụng tính năng này");
                getUserLocation();
                return;
            }
            
            showPlaceDetails(placeId);
            switchTab('navigation-tab', document.querySelector('#navigation-tab').previousElementSibling);
            
            // Tính toán tuyến đường
            calculateRoute(placeId, 'driving');
        }

        // TÍNH TOÁN TUYẾN ĐƯỜNG
        function calculateRoute(placeId, mode) {
            const place = touristSpots.find(p => p.id === placeId);
            if (!place || !userLocation) return;
            
            const routeInstructions = document.getElementById('route-instructions');
            routeInstructions.innerHTML = '<p><i class="fas fa-spinner fa-spin"></i> Đang tính toán tuyến đường...</p>';
            
            // Xóa route cũ nếu có
            if (routeLayer) {
                map.removeLayer(routeLayer);
            }
            
            // Giả lập tính toán tuyến đường (thực tế cần sử dụng API như OSRM, Google Maps)
            setTimeout(() => {
                const distance = calculateDistance(
                    userLocation.lat, userLocation.lng,
                    place.coordinates[0], place.coordinates[1]
                );
                
                const travelTime = calculateTravelTime(distance, mode);
                
                // Vẽ đường giả lập
                routeLayer = L.polyline([
                    [userLocation.lat, userLocation.lng],
                    place.coordinates
                ], {
                    color: '#2196F3',
                    weight: 5,
                    opacity: 0.7,
                    dashArray: '10, 10'
                }).addTo(map);
                
                // Fit bounds để hiển thị cả điểm đi và đến
                map.fitBounds([
                    [userLocation.lat, userLocation.lng],
                    place.coordinates
                ]);
                
                routeInstructions.innerHTML = `
                    <div style="background: white; padding: 15px; border-radius: 8px; box-shadow: 0 3px 10px rgba(0,0,0,0.08);">
                        <h5 style="color: #1a237e; margin-bottom: 10px;">Tuyến đường đề xuất</h5>
                        <p><strong>Phương thức:</strong> ${getTravelModeName(mode)}</p>
                        <p><strong>Khoảng cách:</strong> ${distance.toFixed(1)} km</p>
                        <p><strong>Thời gian di chuyển ước tính:</strong> ${travelTime}</p>
                        <p><strong>Hướng dẫn:</strong></p>
                        <ol style="margin-top: 10px; padding-left: 20px;">
                            <li>Xuất phát từ vị trí hiện tại của bạn</li>
                            <li>Di chuyển theo hướng ${getDirection(userLocation, place.coordinates)}</li>
                            <li>Đến địa điểm: ${place.address}</li>
                        </ol>
                        <p style="margin-top: 15px; color: #666; font-size: 14px;">
                            <i class="fas fa-info-circle"></i> Lưu ý: Đây là hướng dẫn đường thẳng. 
                            Để có chỉ dẫn chi tiết, vui lòng sử dụng ứng dụng bản đồ chuyên dụng.
                        </p>
                    </div>
                `;
            }, 1000);
        }

        // TÌM ĐIỂM DU LỊCH GẦN ĐÂY
        function showNearbyPlaces() {
            if (!userLocation) {
                getUserLocation();
                return;
            }
            
            // Sắp xếp điểm du lịch theo khoảng cách
            const nearbySpots = touristSpots.map(spot => {
                const distance = calculateDistance(
                    userLocation.lat, userLocation.lng,
                    spot.coordinates[0], spot.coordinates[1]
                );
                return { ...spot, distance };
            }).sort((a, b) => a.distance - b.distance).slice(0, 10);
            
            const detailsDiv = document.getElementById('place-details');
            detailsDiv.innerHTML = `
                <h3><i class="fas fa-map-marker-alt"></i> Điểm du lịch gần vị trí của bạn</h3>
                <p style="color: #666; margin-bottom: 20px;">Danh sách 10 điểm du lịch gần nhất</p>
                
                <div style="max-height: 500px; overflow-y: auto;">
                    ${nearbySpots.map(spot => `
                        <div class="place-card" style="cursor: pointer;" onclick="showPlaceDetails(${spot.id})">
                            <h4>${spot.name}</h4>
                            <div class="place-meta">
                                <span>${spot.province}</span>
                                <span>${getTypeName(spot.type)}</span>
                                <span style="background: #FF9800; color: white;">
                                    <i class="fas fa-location-arrow"></i> ${spot.distance.toFixed(1)} km
                                </span>
                            </div>
                            <p class="place-description">${spot.description}</p>
                            <div style="margin-top: 10px; display: flex; gap: 10px;">
                                <button onclick="showPlaceDetails(${spot.id})" style="padding: 8px 15px; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 14px;">
                                    <i class="fas fa-info-circle"></i> Chi tiết
                                </button>
                                <button onclick="calculateRoute(${spot.id}, 'driving')" style="padding: 8px 15px; background: #2196F3; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 14px;">
                                    <i class="fas fa-route"></i> Đường đi
                                </button>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // KIỂM TRA THỜI TIẾT LỄ HỘI
        function checkFestivalWeather(province, time) {
            const weatherContent = document.getElementById('weather-content');
            weatherContent.innerHTML = '<p><i class="fas fa-spinner fa-spin"></i> Đang cập nhật thông tin thời tiết...</p>';
            
            // Giả lập lấy thông tin thời tiết
            setTimeout(() => {
                const weatherData = getMockWeatherData(province, time);
                
                weatherContent.innerHTML = `
                    <div class="weather-section">
                        <h4 style="color: white; margin-bottom: 15px;">
                            <i class="fas fa-cloud-sun"></i> Thông tin thời tiết cho lễ hội
                        </h4>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 15px;">
                            <div style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 8px;">
                                <h5 style="color: white; margin-bottom: 5px;">Nhiệt độ</h5>
                                <p style="font-size: 1.5rem; font-weight: bold; color: white;">${weatherData.temperature}°C</p>
                            </div>
                            
                            <div style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 8px;">
                                <h5 style="color: white; margin-bottom: 5px;">Thời tiết</h5>
                                <p style="font-size: 1.2rem; color: white;">${weatherData.condition}</p>
                                <p style="font-size: 2rem; margin-top: 5px;">${weatherData.icon}</p>
                            </div>
                            
                            <div style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 8px;">
                                <h5 style="color: white; margin-bottom: 5px;">Độ ẩm</h5>
                                <p style="font-size: 1.5rem; font-weight: bold; color: white;">${weatherData.humidity}%</p>
                            </div>
                        </div>
                        
                        <div style="margin-top: 20px; background: rgba(255,255,255,0.2); padding: 15px; border-radius: 8px;">
                            <h5 style="color: white; margin-bottom: 10px;">Lời khuyên cho lễ hội</h5>
                            <ul style="color: white; padding-left: 20px;">
                                ${weatherData.advice.map(item => `<li>${item}</li>`).join('')}
                            </ul>
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px; padding: 20px; background: #fff3e0; border-radius: 10px;">
                        <h5 style="color: #1a237e; margin-bottom: 10px;">Lưu ý chung về thời tiết:</h5>
                        <p>${weatherData.general_advice}</p>
                    </div>
                `;
            }, 1500);
        }

        // HÀM HỖ TRỢ
        function switchTab(tabId, button) {
            // Ẩn tất cả tab content
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Xóa active từ tất cả tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Hiển thị tab được chọn
            document.getElementById(tabId).classList.add('active');
            button.classList.add('active');
        }

        function getTypeName(type) {
            const typeNames = {
                'di_tich': 'Di tích lịch sử',
                'tham_quan': 'Thắng cảnh',
                'bao_tang': 'Bảo tàng',
                'am_thuc': 'Ẩm thực',
                'le_hoi': 'Lễ hội',
                'nghi_duong': 'Nghỉ dưỡng',
                'mua_sam': 'Mua sắm',
                'tam_linh': 'Tâm linh',
                'van_hoa': 'Văn hóa dân tộc'
            };
            return typeNames[type] || 'Điểm tham quan';
        }

        function getFacilityIcon(type) {
            const icons = {
                'hotel': 'fas fa-hotel',
                'restaurant': 'fas fa-utensils',
                'parking': 'fas fa-parking',
                'shopping': 'fas fa-shopping-cart',
                'hospital': 'fas fa-hospital',
                'cafe': 'fas fa-coffee',
                'atm': 'fas fa-money-bill-wave',
                'wifi': 'fas fa-wifi',
                'guide': 'fas fa-user-tie',
                'workshop': 'fas fa-tools',
                'food': 'fas fa-utensils',
                'security': 'fas fa-shield-alt',
                'toilet': 'fas fa-restroom',
                'souvenir': 'fas fa-gift',
                'library': 'fas fa-book',
                'camping': 'fas fa-campground',
                'golf': 'fas fa-golf-ball',
                'bike': 'fas fa-bicycle',
                'trash': 'fas fa-trash-alt',
                'cinema': 'fas fa-film',
                'foodcourt': 'fas fa-utensils',
                'bench': 'fas fa-chair',
                'camera': 'fas fa-camera',
                'firstaid': 'fas fa-first-aid',
                'police': 'fas fa-police-box',
                'resort': 'fas fa-umbrella-beach'
            };
            return icons[type] || 'fas fa-info-circle';
        }

        function getFacilityName(type) {
            const names = {
                'hotel': 'Khách sạn',
                'restaurant': 'Nhà hàng',
                'parking': 'Bãi đỗ xe',
                'shopping': 'Mua sắm',
                'hospital': 'Bệnh viện',
                'cafe': 'Quán cà phê',
                'atm': 'ATM',
                'wifi': 'Wifi',
                'guide': 'Hướng dẫn viên',
                'workshop': 'Xưởng thủ công',
                'food': 'Ẩm thực',
                'security': 'An ninh',
                'toilet': 'Nhà vệ sinh',
                'souvenir': 'Đồ lưu niệm',
                'library': 'Thư viện',
                'camping': 'Cắm trại',
                'golf': 'Sân golf',
                'bike': 'Thuê xe đạp',
                'trash': 'Thùng rác',
                'cinema': 'Rạp chiếu phim',
                'foodcourt': 'Khu ẩm thực',
                'bench': 'Ghế nghỉ',
                'camera': 'Camera an ninh',
                'firstaid': 'Trạm y tế',
                'police': 'Cảnh sát',
                'resort': 'Khu nghỉ dưỡng'
            };
            return names[type] || 'Tiện ích';
        }

        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371; // Bán kính Trái đất (km)
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = 
                Math.sin(dLat/2) * Math.sin(dLat/2) +
                Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * 
                Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        function calculateTravelTime(distance, mode) {
            let speed;
            switch(mode) {
                case 'driving': speed = 40; break; // km/h
                case 'walking': speed = 5; break;
                case 'bicycling': speed = 15; break;
                case 'transit': speed = 25; break;
                default: speed = 30;
            }
            
            const hours = distance / speed;
            if (hours < 1) {
                return Math.round(hours * 60) + ' phút';
            } else {
                return hours.toFixed(1) + ' giờ';
            }
        }

        function getTravelModeName(mode) {
            const names = {
                'driving': 'Ô tô',
                'walking': 'Đi bộ',
                'bicycling': 'Xe đạp',
                'transit': 'Xe buýt'
            };
            return names[mode] || 'Di chuyển';
        }

        function getDirection(from, to) {
            const latDiff = to[0] - from.lat;
            const lngDiff = to[1] - from.lng;
            
            if (Math.abs(latDiff) > Math.abs(lngDiff)) {
                return latDiff > 0 ? 'Bắc' : 'Nam';
            } else {
                return lngDiff > 0 ? 'Đông' : 'Tây';
            }
        }

        function getProvinceCenter(province) {
            const centers = {
                'Hà Nội': [21.0285, 105.8542],
                'Huế': [16.4637, 107.5909],
                'Đà Nẵng': [16.0544, 108.2022],
                'TP Hồ Chí Minh': [10.8231, 106.6297],
                'Lạng Sơn': [21.8537, 106.7619],
                'Sa Pa': [22.3364, 103.8440],
                'Phú Thọ': [21.3222, 105.4020],
                'Quảng Ngãi': [15.1214, 108.8044]
            };
            return centers[province] || [16.0, 108.0];
        }

        function getMockWeatherData(province, time) {
            const weatherConditions = ['Nắng đẹp', 'Ít mây', 'Mây rải rác', 'Mưa nhẹ', 'Mưa rào'];
            const weatherIcons = ['☀️', '⛅', '☁️', '🌦️', '🌧️'];
            const randomIndex = Math.floor(Math.random() * weatherConditions.length);
            
            const baseData = {
                'Hà Nội': { temp: 22, humidity: 75 },
                'Huế': { temp: 28, humidity: 85 },
                'Đà Nẵng': { temp: 30, humidity: 80 },
                'TP Hồ Chí Minh': { temp: 32, humidity: 78 },
                'Lạng Sơn': { temp: 20, humidity: 82 },
                'Sa Pa': { temp: 18, humidity: 88 },
                'Phú Thọ': { temp: 24, humidity: 79 },
                'Quảng Ngãi': { temp: 29, humidity: 83 }
            };
            
            const provinceData = baseData[province] || { temp: 25, humidity: 80 };
            
            return {
                temperature: provinceData.temp + Math.floor(Math.random() * 5) - 2,
                condition: weatherConditions[randomIndex],
                icon: weatherIcons[randomIndex],
                humidity: provinceData.humidity + Math.floor(Math.random() * 10) - 5,
                advice: [
                    'Mang theo ô/dù phòng mưa',
                    'Mặc trang phục phù hợp với nhiệt độ',
                    'Chuẩn bị nước uống đầy đủ',
                    'Kiểm tra dự báo thời tiết trước khi đi'
                ],
                general_advice: 'Thời tiết có thể thay đổi, nên chuẩn bị sẵn các vật dụng cần thiết và có kế hoạch dự phòng cho các hoạt động ngoài trời.'
            };
        }

        // CÁC HÀM LỌC VÀ CẬP NHẬT
        function filterByProvince(province) {
            currentProvince = province;
            loadPlacesList();
            loadMarkers(touristSpots);
            updatePlaceCount();
            
            document.querySelectorAll('.province-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Fly to province center
            const provinceCenter = getProvinceCenter(province);
            if (province !== 'all') {
                map.flyTo(provinceCenter, 9);
            } else {
                map.flyTo(vietnamCenter, 6);
            }
        }

        function filterByType(type) {
            currentFilter = type;
            loadPlacesList();
            loadMarkers(touristSpots);
            updatePlaceCount();
            
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
        }

        function updatePlaceCount() {
            const count = touristSpots.filter(spot => 
                (currentProvince === 'all' || spot.province === currentProvince) &&
                (currentFilter === 'all' || spot.type === currentFilter)
            ).length;
            
            const status = document.createElement('div');
            status.innerHTML = `
                <div style="background: #e8f5e9; padding: 10px 15px; border-radius: 8px; margin-top: 15px; text-align: center;">
                    <strong>Đang hiển thị ${count} điểm du lịch</strong>
                    ${currentProvince !== 'all' ? ` tại ${currentProvince}` : ''}
                    ${currentFilter !== 'all' ? ` - Loại hình: ${getTypeName(currentFilter)}` : ''}
                </div>
            `;
            
            const existingStatus = document.querySelector('#place-count-status');
            if (existingStatus) existingStatus.remove();
            
            status.id = 'place-count-status';
            document.getElementById('places-list').appendChild(status);
        }

        // CÁC TÍNH NĂNG KHÁC
        function showItineraryPlanner() {
            alert('Tính năng Lộ trình thông minh đang được phát triển!\n\nChức năng sẽ giúp bạn:\n• Tự động tạo lộ trình\n• Tính toán thời gian di chuyển\n• Đề xuất điểm dừng chân\n• Tối ưu hóa chi phí');
        }

        function showCulturalHeritage() {
            filterByType('di_tich');
            alert('Đang hiển thị tất cả di sản văn hóa và di tích lịch sử!');
        }

        function showLocalFacilities() {
            alert('Tính năng Tiện ích địa phương đang được phát triển!\n\nBao gồm:\n• Khách sạn & chỗ ở\n• Nhà hàng & ẩm thực\n• Y tế & sức khỏe\n• Mua sắm & quà lưu niệm\n• Di chuyển & vận tải');
        }

        function showPreferences() {
            alert('Tính năng Sở thích cá nhân đang được phát triển!\n\nBạn có thể chọn:\n• Ẩm thực yêu thích\n• Loại hình du lịch\n• Ngân sách dự kiến\n• Thời gian có sẵn\n• Độ tuổi thành viên');
        }

        function generateSmartItinerary() {
            const days = document.getElementById('days-count').value;
            const province = document.getElementById('start-province').value;
            const interest = document.getElementById('main-interest').value;
            
            const interestNames = {
                'lich_su': 'Lịch sử - Di tích',
                'thien_nhien': 'Thiên nhiên - Thắng cảnh',
                'am_thuc': 'Ẩm thực - Ẩm thực đường phố',
                'van_hoa': 'Văn hóa - Lễ hội',
                'nghi_duong': 'Nghỉ dưỡng - Thư giãn',
                'phieu_luu': 'Phiêu lưu - Trekking'
            };
            
            const resultsDiv = document.getElementById('itinerary-results');
            resultsDiv.innerHTML = `
                <div style="background: rgba(255,255,255,0.9); padding: 25px; border-radius: 10px; margin-top: 20px;">
                    <h4 style="color: #1a237e; margin-bottom: 15px;">Lộ trình đề xuất</h4>
                    <p><strong>Thời gian:</strong> ${days} ngày</p>
                    <p><strong>Khởi hành từ:</strong> ${province}</p>
                    <p><strong>Sở thích chính:</strong> ${interestNames[interest]}</p>
                    
                    <div style="margin-top: 20px; background: #f8f9fa; padding: 15px; border-radius: 8px;">
                        <h5 style="margin-bottom: 10px;">Điểm đến đề xuất:</h5>
                        ${getSuggestedPlaces(province, interest, days).map((place, index) => `
                            <div style="padding: 10px; border-bottom: 1px solid #eee; cursor: pointer;" onclick="showPlaceDetails(${place.id})">
                                <strong>Ngày ${Math.floor(index/3) + 1}:</strong> ${place.name}
                                <span style="float: right; color: #666;">${place.province}</span>
                            </div>
                        `).join('')}
                    </div>
                    
                    <button onclick="saveItinerary()" style="margin-top: 20px; padding: 10px 20px; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer;">
                        <i class="fas fa-save"></i> Lưu lộ trình
                    </button>
                </div>
            `;
        }

        function getSuggestedPlaces(province, interest, days) {
            const maxPlaces = days * 3;
            const provinceSpots = touristSpots.filter(spot => 
                spot.province === province || province === 'all'
            );
            
            let filtered = provinceSpots;
            if (interest === 'lich_su') filtered = filtered.filter(s => s.type === 'di_tich');
            if (interest === 'thien_nhien') filtered = filtered.filter(s => s.type === 'tham_quan');
            if (interest === 'am_thuc') filtered = filtered.filter(s => s.type === 'am_thuc');
            if (interest === 'van_hoa') filtered = filtered.filter(s => s.type === 'van_hoa' || s.type === 'le_hoi');
            if (interest === 'nghi_duong') filtered = filtered.filter(s => s.type === 'nghi_duong');
            if (interest === 'phieu_luu') filtered = filtered.filter(s => s.type === 'tham_quan');
            
            return filtered.slice(0, maxPlaces);
        }

        function saveItinerary() {
            alert('Lộ trình đã được lưu thành công!\n\nBạn có thể xem lại trong mục "Lịch sử lộ trình" hoặc xuất ra file để in.');
        }

        function showDirectionsToFestival(location, province) {
            alert(`Hướng dẫn đến ${location}, ${province}:\n\n1. Xác định vị trí hiện tại của bạn\n2. Tìm đường đến ${province}\n3. Hỏi người dân địa phương đường đến ${location}\n4. Sử dụng ứng dụng bản đồ để dẫn đường chi tiết`);
        }

        function showProvincePlaces(province) {
            filterByProvince(province);
            window.scrollTo(0, document.querySelector('.places-panel').offsetTop);
        }

        function searchNearbyFacilities(placeId) {
            alert('Tính năng tìm kiếm tiện ích gần đây đang được phát triển!\n\nSẽ giúp bạn tìm:\n• Nhà hàng trong bán kính 1km\n• Khách sạn gần nhất\n• Trạm xăng, ATM\n• Hiệu thuốc, bệnh viện');
        }

        function addToItinerary(placeId) {
            const place = touristSpots.find(p => p.id === placeId);
            alert(`Đã thêm "${place.name}" vào lộ trình của bạn!\n\nBạn có thể xem và chỉnh sửa lộ trình trong mục "Lập lộ trình thông minh".`);
        }

        // KHỞI ĐỘNG
        window.onload = function() {
            console.log('VietTravelGuide Phiên bản 4.0 đã sẵn sàng!');
            console.log('Tổng số điểm du lịch:', touristSpots.length);
            console.log('Tổng số lễ hội:', festivals.length);
            console.log('Các tính năng mới:');
            console.log('- Thuyết minh lịch sử chi tiết');
            console.log('- Tiện ích xung quanh cụ thể');
            console.log('- Hướng dẫn đường đi thực tế');
            console.log('- Thông tin thời tiết lễ hội');
            console.log('- Định vị vị trí người dùng');
        };
    </script>
</body>
</html>
