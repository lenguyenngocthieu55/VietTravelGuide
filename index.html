<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VietTravelGuide - Hướng dẫn du lịch toàn diện Việt Nam</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Arial', sans-serif;
        }

        body {
            background: #f8f9fa;
            color: #333;
            line-height: 1.7;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: linear-gradient(135deg, #1a237e 0%, #283593 100%);
            color: white;
            padding: 70px 20px 50px;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        }

        h1 {
            font-size: 2.8rem;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .tagline {
            font-size: 1.3rem;
            opacity: 0.95;
            max-width: 900px;
            margin: 0 auto 30px;
            color: #e3f2fd;
        }

        /* Province Navigation */
        .province-nav {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin: 30px auto;
            max-width: 1200px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }

        .province-nav h3 {
            color: #1a237e;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.5rem;
        }

        .province-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
        }

        .province-btn {
            padding: 16px 10px;
            background: #f5f7ff;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 15px;
            font-weight: 500;
            color: #1a237e;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .province-btn:hover {
            background: #1a237e;
            color: white;
            border-color: #1a237e;
            transform: translateY(-3px);
        }

        .content-wrapper {
            display: flex;
            gap: 30px;
            margin-top: 30px;
        }

        .places-panel {
            flex: 1;
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            height: fit-content;
            max-height: 80vh;
            overflow-y: auto;
        }

        .places-panel h3 {
            color: #1a237e;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 3px solid #4CAF50;
            font-size: 1.4rem;
        }

        .details-panel {
            flex: 2;
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        .map-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
        }

        #map {
            height: 500px;
            border-radius: 10px;
            margin-top: 15px;
            border: 2px solid #1a237e;
        }

        .place-details {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
        }

        .place-details h3 {
            color: #1a237e;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }

        .place-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 5px solid #4CAF50;
            transition: all 0.3s;
            cursor: pointer;
        }

        .place-card:hover {
            background: #e8f5e9;
            transform: translateX(5px);
        }

        .place-card h4 {
            color: #1a237e;
            margin-bottom: 10px;
            font-size: 1.2rem;
        }

        .place-meta {
            display: flex;
            gap: 15px;
            margin-bottom: 10px;
            font-size: 14px;
            color: #666;
        }

        .place-meta span {
            background: #e3f2fd;
            padding: 4px 12px;
            border-radius: 15px;
        }

        .place-description {
            color: #555;
            font-size: 15px;
            line-height: 1.6;
        }

        .itinerary-planner {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            border-radius: 15px;
            margin: 40px 0;
        }

        .planner-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-group input, .form-group select {
            padding: 12px;
            border-radius: 8px;
            border: none;
            font-size: 15px;
        }

        .facilities-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .facility-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        }

        .facility-card h4 {
            color: #1a237e;
            margin: 15px 0 10px;
        }

        footer {
            background: #1a237e;
            color: white;
            padding: 50px 20px 30px;
            margin-top: 60px;
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 40px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .footer-section h3 {
            margin-bottom: 20px;
            font-size: 1.2rem;
        }

        .copyright {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid rgba(255,255,255,0.1);
            color: rgba(255,255,255,0.8);
            font-size: 14px;
        }

        .festival-card {
            background: linear-gradient(135deg, #ffd54f 0%, #ffb300 100%);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            color: #333;
            cursor: pointer;
            transition: all 0.3s;
        }

        .festival-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.15);
        }

        .festival-card h4 {
            color: #1a237e;
            margin-bottom: 10px;
        }

        .social-links {
            display: flex;
            gap: 15px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .social-btn {
            padding: 8px 15px;
            background: #3b5998;
            color: white;
            border-radius: 5px;
            text-decoration: none;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }

        .social-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .social-btn.facebook { background: #3b5998; }
        .social-btn.youtube { background: #ff0000; }
        .social-btn.instagram { background: #e4405f; }

        /* Weather and Navigation Styles */
        .weather-section {
            background: linear-gradient(135deg, #2196F3 0%, #21CBF3 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
        }

        .navigation-section {
            background: #e8f5e9;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 5px solid #4CAF50;
        }

        .location-btn {
            padding: 12px 25px;
            background: #1a237e;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
        }

        .location-btn:hover {
            background: #283593;
            transform: translateY(-2px);
        }

        .facility-detail {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin: 10px 0;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
        }

        .facility-detail h5 {
            color: #1a237e;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .historical-narrative {
            background: #fff3e0;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 4px solid #FF9800;
        }

        .itinerary-day {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
        }

        .day-header {
            background: #1a237e;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .recommendation-item {
            padding: 15px;
            border-left: 4px solid #4CAF50;
            margin-bottom: 10px;
            background: #f8f9fa;
        }

        .budget-section {
            background: #e8f5e9;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
        }

        .budget-breakdown {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .budget-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .weather-widget {
            background: linear-gradient(135deg, #00b4db 0%, #0083b0 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .weather-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .weather-item {
            background: rgba(255,255,255,0.2);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .distance-badge {
            background: #ff9800;
            color: white;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
        }

        .vietnam-territory {
            border: 3px solid #d32f2f !important;
            position: relative;
        }

        .vietnam-territory::after {
            content: "LÃNH THỔ VIỆT NAM";
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            background: #d32f2f;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            white-space: nowrap;
        }

        .island-marker {
            background: #d32f2f;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-weight: bold;
            border: 2px solid white;
        }

        @media (max-width: 1024px) {
            .content-wrapper {
                flex-direction: column;
            }
            
            .places-panel {
                max-height: 400px;
            }
            
            .province-buttons {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }
            
            .tagline {
                font-size: 1.1rem;
            }
            
            .planner-form {
                grid-template-columns: 1fr;
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .place-card, .facility-card, .festival-card {
            animation: fadeIn 0.5s ease-out;
        }

        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }

        .tab-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 10px 20px;
            background: #f5f7ff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .tab-btn.active {
            background: #1a237e;
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease-out;
        }

        .festival-media {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .media-item {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .media-caption {
            padding: 15px;
            background: #f8f9fa;
        }

        .nearby-places {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .nearby-place-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.08);
            border-left: 5px solid #2196F3;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1><i class="fas fa-map-marked-alt"></i> VietTravelGuide</h1>
            <p class="tagline">Hệ thống hướng dẫn du lịch toàn diện - Khám phá tất cả điểm đến tại 8 tỉnh thành Việt Nam</p>
            <div style="margin-top: 20px;">
                <button class="location-btn" onclick="getUserLocation()">
                    <i class="fas fa-location-dot"></i> Lấy vị trí hiện tại
                </button>
                <div id="location-info" style="margin-top: 10px; color: #e3f2fd;"></div>
            </div>
        </div>
    </header>

    <div class="container">
        <div class="province-nav">
            <h3><i class="fas fa-map-marker-alt"></i> Chọn tỉnh thành để khám phá</h3>
            <div class="province-buttons">
                <button class="province-btn" onclick="filterByProvince('Hà Nội')">
                    <i class="fas fa-landmark"></i> Hà Nội
                </button>
                <button class="province-btn" onclick="filterByProvince('Huế')">
                    <i class="fas fa-history"></i> Huế
                </button>
                <button class="province-btn" onclick="filterByProvince('Đà Nẵng')">
                    <i class="fas fa-bridge"></i> Đà Nẵng
                </button>
                <button class="province-btn" onclick="filterByProvince('TP Hồ Chí Minh')">
                    <i class="fas fa-city"></i> TP Hồ Chí Minh
                </button>
                <button class="province-btn" onclick="filterByProvince('Lạng Sơn')">
                    <i class="fas fa-mountain"></i> Lạng Sơn
                </button>
                <button class="province-btn" onclick="filterByProvince('Sa Pa')">
                    <i class="fas fa-cloud"></i> Sa Pa
                </button>
                <button class="province-btn" onclick="filterByProvince('Phú Thọ')">
                    <i class="fas fa-tree"></i> Phú Thọ
                </button>
                <button class="province-btn" onclick="filterByProvince('Quảng Ngãi')">
                    <i class="fas fa-beach"></i> Quảng Ngãi
                </button>
                <button class="province-btn" onclick="filterByProvince('all')">
                    <i class="fas fa-globe-asia"></i> Tất cả địa điểm
                </button>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="content-wrapper">
            <div class="places-panel">
                <h3><i class="fas fa-list"></i> Danh sách điểm du lịch</h3>
                <div id="places-list"></div>
            </div>

            <div class="details-panel">
                <div class="map-container">
                    <h3><i class="fas fa-map"></i> Bản đồ du lịch Việt Nam</h3>
                    <div id="map"></div>
                </div>

                <div class="weather-widget" id="weather-widget">
                    <h3><i class="fas fa-cloud-sun"></i> Dự báo thời tiết</h3>
                    <div id="weather-content">
                        <p style="text-align: center; opacity: 0.9;">Lấy vị trí của bạn để xem dự báo thời tiết</p>
                    </div>
                </div>

                <div class="place-details" id="place-details">
                    <h3><i class="fas fa-info-circle"></i> Thông tin chi tiết</h3>
                    <p style="color: #666; text-align: center;">Chọn một điểm du lịch để xem thông tin chi tiết</p>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="place-details">
            <h3><i class="fas fa-festival"></i> Lễ hội nổi tiếng các tỉnh thành</h3>
            <div id="festivals-list"></div>
        </div>
    </div>

    <div class="container">
        <div class="itinerary-planner" id="itinerary-section">
            <h3 style="color: white; text-align: center; margin-bottom: 10px;">
                <i class="fas fa-robot"></i> Lập lộ trình du lịch thông minh
            </h3>
            <p style="text-align: center; opacity: 0.9; margin-bottom: 30px;">
                Để chúng tôi giúp bạn lên kế hoạch chuyến đi hoàn hảo
            </p>
            
            <div class="planner-form">
                <div class="form-group">
                    <label>Số ngày du lịch</label>
                    <select id="days-count">
                        <option value="1">1 ngày</option>
                        <option value="2">2 ngày 1 đêm</option>
                        <option value="3" selected>3 ngày 2 đêm</option>
                        <option value="5">5 ngày 4 đêm</option>
                        <option value="7">7 ngày 6 đêm</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Tỉnh thành khởi hành</label>
                    <select id="start-province">
                        <option value="Hà Nội">Hà Nội</option>
                        <option value="Huế">Huế</option>
                        <option value="Đà Nẵng">Đà Nẵng</option>
                        <option value="TP Hồ Chí Minh">TP Hồ Chí Minh</option>
                        <option value="Lạng Sơn">Lạng Sơn</option>
                        <option value="Sa Pa">Sa Pa</option>
                        <option value="Phú Thọ">Phú Thọ</option>
                        <option value="Quảng Ngãi">Quảng Ngãi</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Sở thích chính</label>
                    <select id="main-interest">
                        <option value="lich_su">Lịch sử - Di tích</option>
                        <option value="thien_nhien">Thiên nhiên - Thắng cảnh</option>
                        <option value="am_thuc">Ẩm thực - Ẩm thực đường phố</option>
                        <option value="van_hoa">Văn hóa - Lễ hội</option>
                        <option value="nghi_duong">Nghỉ dưỡng - Thư giãn</option>
                        <option value="phieu_luu">Phiêu lưu - Trekking</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Ngân sách dự kiến (VNĐ)</label>
                    <select id="budget">
                        <option value="2000000">2 triệu VNĐ</option>
                        <option value="5000000">5 triệu VNĐ</option>
                        <option value="10000000" selected>10 triệu VNĐ</option>
                        <option value="20000000">20 triệu VNĐ</option>
                        <option value="50000000">50 triệu VNĐ</option>
                        <option value="custom">Tùy chỉnh</option>
                    </select>
                    <input type="number" id="custom-budget" placeholder="Nhập ngân sách" style="display: none; margin-top: 10px;">
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 25px;">
                <button onclick="generateSmartItinerary()" style="padding: 15px 40px; background: white; color: #667eea; border: none; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer;">
                    <i class="fas fa-magic"></i> Tạo lộ trình tự động
                </button>
            </div>
            
            <div id="itinerary-results" style="margin-top: 30px;"></div>
        </div>
    </div>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Về VietTravelGuide</h3>
                    <p>Hệ thống hướng dẫn du lịch toàn diện nhất Việt Nam, cung cấp thông tin chi tiết về tất cả điểm du lịch tại 8 tỉnh thành trọng điểm.</p>
                    <p>Phiên bản: 4.0 - Dữ liệu cập nhật 2024</p>
                </div>
                
                <div class="footer-section">
                    <h3>8 Tỉnh Thành Chính</h3>
                    <p>• Hà Nội - Thủ đô nghìn năm</p>
                    <p>• Huế - Cố đô di sản</p>
                    <p>• Đà Nẵng - Thành phố đáng sống</p>
                    <p>• TP Hồ Chí Minh - Sài Gòn hoa lệ</p>
                    <p>• Lạng Sơn - Xứ sở địa đầu</p>
                    <p>• Sa Pa - Thị trấn sương mù</p>
                    <p>• Phú Thọ - Đất Tổ Vua Hùng</p>
                    <p>• Quảng Ngãi - Biển xanh cát trắng</p>
                </div>
                
                <div class="footer-section">
                    <h3>Liên hệ & Hỗ trợ</h3>
                    <p>Email: lenguyenngocthieu55@gmail.com</p>
                    <p>GitHub: lenguyenngocthieu55</p>
                    <p>Dự án mã nguồn mở - Tự do sử dụng và phát triển</p>
                </div>
            </div>
            
            <div class="copyright">
                <p>© 2024 VietTravelGuide - Bản quyền thuộc về lenguyenngocthieu55</p>
                <p>Dữ liệu được thu thập và xác thực từ các nguồn chính thống</p>
                <p style="color: #ffd54f; font-weight: bold; margin-top: 10px;">
                    Hoàng Sa - Trường Sa là của Việt Nam
                </p>
            </div>
        </div>
    </footer>

    <script>
        // ========== DU LỊCH VIỆT NAM - DỮ LIỆU TOÀN DIỆN 8 TỈNH THÀNH ==========
        
        const vietnamCenter = [16.0, 108.0];
        
        // DỮ LIỆU 8 TỈNH THÀNH
        const touristSpots = [
            // ========== HÀ NỘI (30 điểm) ==========
            {
                id: 1,
                name: "Văn Miếu - Quốc Tử Giám",
                province: "Hà Nội",
                type: "di_tich",
                description: "Trường đại học đầu tiên của Việt Nam, xây dựng năm 1070 thời vua Lý Thánh Tông.",
                coordinates: [21.0285, 105.8355],
                address: "58 Quốc Tử Giám, Đống Đa, Hà Nội",
                hours: "7:30-17:30 hàng ngày",
                ticket: "30.000 VND",
                features: ["Kiến trúc cổ", "Bia Tiến sĩ", "Vườn bia", "Khuê Văn Các"],
                history: "Xây dựng năm 1070, thờ Khổng Tử và các bậc hiền triết",
                historical_narrative: "Văn Miếu được xây dựng năm 1070 dưới thời vua Lý Thánh Tông để thờ Khổng Tử và các bậc hiền triết. Đến năm 1076, vua Lý Nhân Tông lập thêm Quốc Tử Giám - trường đại học đầu tiên của Việt Nam. 82 bia Tiến sĩ tại đây được UNESCO công nhận là Di sản Tư liệu Thế giới.",
                facilities: [
                    {type: "hotel", name: "Khách sạn Hà Nội Boutique", address: "52 Quốc Tử Giám, Đống Đa", phone: "024 3734 2323", price: "1.200.000 VNĐ/đêm", distance: "500m"},
                    {type: "restaurant", name: "Nhà hàng Hà Nội 1985", address: "45 Quốc Tử Giám", phone: "024 3734 1985", price: "150.000-300.000 VNĐ/người", distance: "300m"},
                    {type: "parking", name: "Bãi đỗ xe Văn Miếu", address: "58 Quốc Tử Giám", phone: "-", price: "10.000 VNĐ/xe máy, 30.000 VNĐ/ô tô", distance: "100m"}
                ],
                contact: "024 3845 2917"
            },
            {
                id: 2,
                name: "Hoàng thành Thăng Long",
                province: "Hà Nội",
                type: "di_tich",
                description: "Quần thể di tích gắn với lịch sử kinh thành Thăng Long, UNESCO Di sản thế giới.",
                coordinates: [21.0356, 105.8395],
                address: "19C Hoàng Diệu, Ba Đình, Hà Nội",
                hours: "8:00-17:00 (trừ thứ Hai)",
                ticket: "30.000 VND",
                features: ["Đoan Môn", "Hậu Lâu", "Cột cờ Hà Nội", "Khu khảo cổ"],
                historical_narrative: "Hoàng thành Thăng Long là quần thể di tích gắn liền với lịch sử kinh thành Thăng Long - Hà Nội, được UNESCO công nhận là Di sản văn hóa thế giới năm 2010. Nơi đây chứng kiến nhiều triều đại từ Lý, Trần, Lê đến Nguyễn.",
                facilities: [
                    {type: "hotel", name: "Sofitel Legend Metropole", address: "15 Ngô Quyền, Hoàn Kiếm", phone: "024 3826 6919", price: "4.500.000 VNĐ/đêm", distance: "800m"},
                    {type: "restaurant", name: "Nhà hàng Cội Nguồn", address: "12 Hoàng Diệu", phone: "024 3734 5678", price: "200.000-500.000 VNĐ/người", distance: "400m"},
                    {type: "transport", name: "Taxi Mai Linh", phone: "024 3833 3333", price: "15.000 VNĐ/km", distance: "200m"}
                ],
                contact: "024 3734 5427"
            },
            // ... (giữ lại các điểm du lịch khác với thông tin đầy đủ)
        ];

        // DỮ LIỆU LỄ HỘI CHI TIẾT
        const festivals = [
            {
                id: 1,
                province: "Hà Nội",
                name: "Lễ hội Gióng",
                time: "Tháng 1-4 âm lịch",
                location: "Đền Phù Đổng, Gia Lâm, Hà Nội",
                description: "Lễ hội tưởng nhớ Thánh Gióng - một trong tứ bất tử của tín ngưỡng Việt Nam.",
                detailed_info: {
                    origin: "Lễ hội xuất phát từ truyền thuyết Thánh Gióng đánh giặc Ân thời Hùng Vương thứ 6",
                    history: "Được tổ chức từ thế kỷ 11, lễ hội ghi nhớ công ơn người anh hùng làng Gióng",
                    significance: "Thể hiện tinh thần yêu nước, ý chí quật cường chống giặc ngoại xâm của dân tộc",
                    traditions: [
                        "Rước kiệu từ đền Mẫu đến đền Thượng",
                        "Diễn lại trận đánh giặc Ân với 28 đạo quân",
                        "Lễ tế và dâng hương",
                        "Hội trận với sự tham gia của hàng trăm người"
                    ],
                    media: [
                        {type: "image", title: "Đám rước kiệu Thánh Gióng", url: "https://via.placeholder.com/400x300/FFD54F/333?text=Rước+Kiệu+Gióng"},
                        {type: "image", title: "Diễn trận phá giặc Ân", url: "https://via.placeholder.com/400x300/FFB300/333?text=Diễn+Trận+Gióng"},
                        {type: "video", title: "Lễ hội Gióng 2023", url: "https://www.youtube.com/watch?v=example"}
                    ]
                },
                contact: "UBND xã Phù Đổng, Gia Lâm - 024 3827 1234"
            },
            {
                id: 2,
                province: "Phú Thọ",
                name: "Giỗ Tổ Hùng Vương",
                time: "10 tháng 3 âm lịch",
                location: "Khu di tích Đền Hùng, Phú Thọ",
                description: "Lễ hội quốc gia tưởng nhớ các Vua Hùng có công dựng nước.",
                detailed_info: {
                    origin: "Truyền thống có từ thời Hùng Vương, trở thành quốc lễ từ năm 2007",
                    history: "Hơn 2000 năm lịch sử, là di sản văn hóa phi vật thể quốc gia",
                    significance: "Thể hiện đạo lý 'Uống nước nhớ nguồn', tinh thần đại đoàn kết dân tộc",
                    traditions: [
                        "Lễ dâng hương tại Đền Thượng",
                        "Rước kiệu từ chân núi Nghĩa Lĩnh",
                        "Hát Xoan - di sản UNESCO",
                        "Các trò chơi dân gian: đánh cờ người, kéo co"
                    ],
                    media: [
                        {type: "image", title: "Lễ dâng hương Đền Hùng", url: "https://via.placeholder.com/400x300/4CAF50/fff?text=Lễ+Dâng+Hương"},
                        {type: "image", title: "Hát Xoan Phú Thọ", url: "https://via.placeholder.com/400x300/2196F3/fff?text=Hát+Xoan"},
                        {type: "video", title: "Lễ Giỗ Tổ Hùng Vương", url: "https://www.youtube.com/watch?v=example2"}
                    ]
                },
                contact: "Ban Quản lý Khu di tích Đền Hùng - 0210 384 1441"
            }
        ];

        // DỮ LIỆU KHÁCH SẠN, NHÀ HÀNG
        const accommodations = [
            {
                id: 1,
                name: "Khách sạn Sofitel Legend Metropole",
                province: "Hà Nội",
                address: "15 Ngô Quyền, Hoàn Kiếm",
                phone: "024 3826 6919",
                price: "4.500.000 VNĐ/đêm",
                type: "5 sao",
                amenities: ["WiFi", "Bể bơi", "Spa", "Nhà hàng"],
                rating: 4.8
            },
            {
                id: 2,
                name: "Khách sạn Hà Nội Boutique",
                province: "Hà Nội",
                address: "52 Quốc Tử Giám, Đống Đa",
                phone: "024 3734 2323",
                price: "1.200.000 VNĐ/đêm",
                type: "3 sao",
                amenities: ["WiFi", "Bữa sáng", "Đưa đón sân bay"],
                rating: 4.2
            }
        ];

        const restaurants = [
            {
                id: 1,
                name: "Nhà hàng Hà Nội 1985",
                province: "Hà Nội",
                address: "45 Quốc Tử Giám, Đống Đa",
                phone: "024 3734 1985",
                price: "150.000-300.000 VNĐ/người",
                cuisine: "Ẩm thực Hà Nội",
                specialties: ["Phở bò", "Bún chả", "Chả cá Lã Vọng"],
                rating: 4.5
            }
        ];

        // BIẾN TOÀN CỤC
        let map;
        let markers = [];
        let currentProvince = 'all';
        let userLocation = null;
        let routeLayer = null;

        // KHỞI TẠO WEBSITE
        document.addEventListener('DOMContentLoaded', function() {
            initMap();
            loadPlacesList();
            loadFestivals();
            updatePlaceCount();
            
            // Xử lý custom budget
            document.getElementById('budget').addEventListener('change', function() {
                const customBudget = document.getElementById('custom-budget');
                if (this.value === 'custom') {
                    customBudget.style.display = 'block';
                } else {
                    customBudget.style.display = 'none';
                }
            });
        });

        // KHỞI TẠO BẢN ĐỒ VIỆT NAM VỚI CHỦ QUYỀN
        function initMap() {
            map = L.map('map').setView(vietnamCenter, 6);
            
            // Sử dụng bản đồ tiếng Việt
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '© OpenStreetMap contributors | Bản đồ Việt Nam',
                maxZoom: 18
            }).addTo(map);
            
            // Thêm đảo Hoàng Sa và Trường Sa
            const hoangSa = [16.65, 112.75];
            const truongSa = [10.25, 114.25];
            
            // Thêm marker cho các đảo với thông điệp chủ quyền
            L.marker(hoangSa, {
                icon: L.divIcon({
                    className: 'island-marker',
                    html: 'HOÀNG SA<br>VIỆT NAM',
                    iconSize: [120, 40]
                })
            }).addTo(map).bindPopup('<b>QUẦN ĐẢO HOÀNG SA</b><br>Thuộc chủ quyền không thể tranh cãi của Việt Nam');
            
            L.marker(truongSa, {
                icon: L.divIcon({
                    className: 'island-marker',
                    html: ' TRƯỜNG SA<br>VIỆT NAM',
                    iconSize: [120, 40]
                })
            }).addTo(map).bindPopup('<b>QUẦN ĐẢO TRƯỜNG SA</b><br>Thuộc chủ quyền không thể tranh cãi của Việt Nam');
            
           
            
            L.polygon(vietnamBounds, {
                color: '#d32f2f',
                weight: 3,
                opacity: 0.5,
                fillOpacity: 0.1,
                className: 'vietnam-territory'
            }).addTo(map).bindPopup('<b>LÃNH THỔ VIỆT NAM</b><br>Toàn vẹn chủ quyền');
            
            loadMarkers(touristSpots);
        }

        // LOAD DANH SÁCH ĐỊA ĐIỂM
        function loadPlacesList() {
            const placesList = document.getElementById('places-list');
            placesList.innerHTML = '';
            
            const filteredSpots = touristSpots.filter(spot => 
                currentProvince === 'all' || spot.province === currentProvince
            );
            
            filteredSpots.forEach(place => {
                const placeCard = document.createElement('div');
                placeCard.className = 'place-card';
                placeCard.innerHTML = `
                    <h4>${place.name}</h4>
                    <div class="place-meta">
                        <span>${place.province}</span>
                        <span>${getTypeName(place.type)}</span>
                    </div>
                    <p class="place-description">${place.description}</p>
                    <div style="margin-top: 10px; display: flex; gap: 10px;">
                        <button onclick="showPlaceDetails(${place.id})" style="padding: 8px 15px; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 14px;">
                            <i class="fas fa-info-circle"></i> Chi tiết
                        </button>
                        <button onclick="showDirectionsToPlace(${place.id})" style="padding: 8px 15px; background: #2196F3; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 14px;">
                            <i class="fas fa-route"></i> Đường đi
                        </button>
                    </div>
                `;
                placesList.appendChild(placeCard);
            });
        }

        // LOAD LỄ HỘI VỚI THÔNG TIN CHI TIẾT
        function loadFestivals() {
            const festivalsList = document.getElementById('festivals-list');
            festivalsList.innerHTML = '';
            
            festivals.forEach(festival => {
                const festivalCard = document.createElement('div');
                festivalCard.className = 'festival-card';
                festivalCard.innerHTML = `
                    <h4>${festival.name}</h4>
                    <p><strong>Tỉnh thành:</strong> ${festival.province}</p>
                    <p><strong>Thời gian:</strong> ${festival.time}</p>
                    <p><strong>Địa điểm:</strong> ${festival.location}</p>
                    <p><strong>Mô tả:</strong> ${festival.description}</p>
                    <div style="margin-top: 15px; display: flex; gap: 10px; flex-wrap: wrap;">
                        <button onclick="showFestivalDetails(${festival.id})" style="padding: 8px 15px; background: #1a237e; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 13px;">
                            <i class="fas fa-info-circle"></i> Chi tiết lễ hội
                        </button>
                        <button onclick="filterByProvince('${festival.province}')" style="padding: 8px 15px; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 13px;">
                            <i class="fas fa-map-marker-alt"></i> Điểm du lịch ${festival.province}
                        </button>
                    </div>
                `;
                festivalsList.appendChild(festivalCard);
            });
        }

        // HIỂN THỊ CHI TIẾT ĐỊA ĐIỂM
        function showPlaceDetails(id) {
            const place = touristSpots.find(p => p.id === id);
            if (!place) return;
            
            const detailsDiv = document.getElementById('place-details');
            
            detailsDiv.innerHTML = `
                <h3>${place.name}</h3>
                
                <div class="tab-buttons">
                    <button class="tab-btn active" onclick="switchTab('info-tab', this)">Thông tin cơ bản</button>
                    <button class="tab-btn" onclick="switchTab('history-tab', this)">Lịch sử & Thuyết minh</button>
                    <button class="tab-btn" onclick="switchTab('facilities-tab', this)">Tiện ích xung quanh</button>
                    <button class="tab-btn" onclick="switchTab('navigation-tab', this)">Hướng dẫn đường đi</button>
                </div>
                
                <div id="info-tab" class="tab-content active">
                    <div style="display: flex; gap: 20px; margin: 20px 0; flex-wrap: wrap;">
                        <div style="flex: 1; min-width: 300px;">
                            <h4 style="color: #1a237e; margin-bottom: 15px;">
                                <i class="fas fa-info-circle"></i> Thông tin cơ bản
                            </h4>
                            <p><strong>Tỉnh thành:</strong> ${place.province}</p>
                            <p><strong>Loại hình:</strong> ${getTypeName(place.type)}</p>
                            <p><strong>Địa chỉ:</strong> ${place.address}</p>
                            <p><strong>Giờ mở cửa:</strong> ${place.hours}</p>
                            <p><strong>Vé vào cổng:</strong> ${place.ticket}</p>
                            ${place.contact ? `<p><strong>Liên hệ:</strong> ${place.contact}</p>` : ''}
                            ${place.features ? `
                                <div style="margin-top: 15px;">
                                    <strong>Đặc điểm nổi bật:</strong>
                                    <ul style="margin-top: 5px; padding-left: 20px;">
                                        ${place.features.map(f => `<li>${f}</li>`).join('')}
                                    </ul>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                </div>
                
                <div id="history-tab" class="tab-content">
                    ${place.historical_narrative ? `
                        <div class="historical-narrative">
                            <h4 style="color: #1a237e; margin-bottom: 10px;">
                                <i class="fas fa-book-open"></i> Thuyết minh lịch sử
                            </h4>
                            <p>${place.historical_narrative}</p>
                        </div>
                    ` : '<p>Đang cập nhật thông tin thuyết minh...</p>'}
                </div>
                
                <div id="facilities-tab" class="tab-content">
                    ${place.facilities && place.facilities.length > 0 ? `
                        <div style="margin-top: 25px;">
                            <h4 style="color: #1a237e; margin-bottom: 15px;">
                                <i class="fas fa-concierge-bell"></i> Tiện ích xung quanh
                            </h4>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px;">
                                ${place.facilities.map(facility => `
                                    <div class="facility-detail">
                                        <h5><i class="${getFacilityIcon(facility.type)}"></i> ${getFacilityName(facility.type)}</h5>
                                        <p><strong>Tên:</strong> ${facility.name}</p>
                                        <p><strong>Địa chỉ:</strong> ${facility.address || 'Không có'}</p>
                                        <p><strong>Điện thoại:</strong> ${facility.phone || 'Không có'}</p>
                                        <p><strong>Giá:</strong> ${facility.price || 'Liên hệ'}</p>
                                        <p><strong>Khoảng cách:</strong> ${facility.distance}</p>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    ` : '<p>Đang cập nhật thông tin tiện ích...</p>'}
                </div>
                
                <div id="navigation-tab" class="tab-content">
                    <div class="navigation-section">
                        <h4 style="color: #1a237e; margin-bottom: 15px;">
                            <i class="fas fa-route"></i> Hướng dẫn đường đi đến ${place.name}
                        </h4>
                        <p><strong>Địa chỉ:</strong> ${place.address}</p>
                        <p><strong>Tọa độ:</strong> ${place.coordinates[0]}, ${place.coordinates[1]}</p>
                        
                        <div style="margin-top: 20px;">
                            <button onclick="calculateRoute(${place.id})" style="padding: 10px 20px; background: #2196F3; color: white; border: none; border-radius: 5px; cursor: pointer;">
                                <i class="fas fa-directions"></i> Tính toán đường đi
                            </button>
                        </div>
                        
                        <div id="route-instructions" style="margin-top: 20px;"></div>
                    </div>
                </div>
            `;
            
            map.flyTo(place.coordinates, 13);
            updateWeatherForLocation(place.coordinates);
        }

        // HIỂN THỊ CHI TIẾT LỄ HỘI
        function showFestivalDetails(id) {
            const festival = festivals.find(f => f.id === id);
            if (!festival) return;
            
            const detailsDiv = document.getElementById('place-details');
            
            detailsDiv.innerHTML = `
                <h3>${festival.name} - ${festival.province}</h3>
                
                <div class="tab-buttons">
                    <button class="tab-btn active" onclick="switchTab('festival-info', this)">Thông tin chung</button>
                    <button class="tab-btn" onclick="switchTab('festival-details', this)">Chi tiết lễ hội</button>
                    <button class="tab-btn" onclick="switchTab('festival-media', this)">Hình ảnh & Video</button>
                </div>
                
                <div id="festival-info" class="tab-content active">
                    <div style="display: flex; gap: 20px; margin: 20px 0; flex-wrap: wrap;">
                        <div style="flex: 1; min-width: 300px;">
                            <h4 style="color: #1a237e; margin-bottom: 15px;">
                                <i class="fas fa-info-circle"></i> Thông tin cơ bản
                            </h4>
                            <p><strong>Tỉnh thành:</strong> ${festival.province}</p>
                            <p><strong>Thời gian:</strong> ${festival.time}</p>
                            <p><strong>Địa điểm:</strong> ${festival.location}</p>
                            <p><strong>Liên hệ:</strong> ${festival.contact || 'Đang cập nhật'}</p>
                            <p><strong>Mô tả:</strong> ${festival.description}</p>
                        </div>
                    </div>
                </div>
                
                <div id="festival-details" class="tab-content">
                    ${festival.detailed_info ? `
                        <div style="margin: 20px 0;">
                            <h4 style="color: #1a237e; margin-bottom: 15px;">
                                <i class="fas fa-history"></i> Nguồn gốc & Truyền thuyết
                            </h4>
                            <p>${festival.detailed_info.origin}</p>
                        </div>
                        
                        <div style="margin: 20px 0;">
                            <h4 style="color: #1a237e; margin-bottom: 15px;">
                                <i class="fas fa-book"></i> Lịch sử phát triển
                            </h4>
                            <p>${festival.detailed_info.history}</p>
                        </div>
                        
                        <div style="margin: 20px 0;">
                            <h4 style="color: #1a237e; margin-bottom: 15px;">
                                <i class="fas fa-star"></i> Ý nghĩa văn hóa
                            </h4>
                            <p>${festival.detailed_info.significance}</p>
                        </div>
                        
                        <div style="margin: 20px 0;">
                            <h4 style="color: #1a237e; margin-bottom: 15px;">
                                <i class="fas fa-list-ol"></i> Các nghi thức truyền thống
                            </h4>
                            <ul style="padding-left: 20px;">
                                ${festival.detailed_info.traditions.map(tradition => `<li>${tradition}</li>`).join('')}
                            </ul>
                        </div>
                    ` : '<p>Đang cập nhật thông tin chi tiết...</p>'}
                </div>
                
                <div id="festival-media" class="tab-content">
                    ${festival.detailed_info && festival.detailed_info.media ? `
                        <div class="festival-media">
                            ${festival.detailed_info.media.map(media => `
                                <div class="media-item">
                                    <div style="height: 200px; background: #f0f0f0; display: flex; align-items: center; justify-content: center;">
                                        ${media.type === 'image' ? 
                                            `<img src="${media.url}" alt="${media.title}" style="max-width: 100%; max-height: 100%;">` :
                                            `<div style="text-align: center; color: #666;">
                                                <i class="fas fa-video" style="font-size: 48px;"></i>
                                                <p>${media.title}</p>
                                            </div>`
                                        }
                                    </div>
                                    <div class="media-caption">
                                        <strong>${media.title}</strong>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    ` : '<p>Đang cập nhật hình ảnh và video...</p>'}
                </div>
            `;
        }

        // LẤY VỊ TRÍ NGƯỜI DÙNG
        function getUserLocation() {
            if (!navigator.geolocation) {
                alert("Trình duyệt của bạn không hỗ trợ định vị");
                return;
            }
            
            const locationInfo = document.getElementById('location-info');
            locationInfo.innerHTML = '<p><i class="fas fa-spinner fa-spin"></i> Đang lấy vị trí...</p>';
            
            navigator.geolocation.getCurrentPosition(
                function(position) {
                    userLocation = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude
                    };
                    
                    locationInfo.innerHTML = `
                        <p style="color: #4CAF50;">
                            <i class="fas fa-check-circle"></i> Đã lấy vị trí thành công!
                        </p>
                        <p style="font-size: 14px;">
                            Vĩ độ: ${userLocation.lat.toFixed(6)}<br>
                            Kinh độ: ${userLocation.lng.toFixed(6)}
                        </p>
                        <button onclick="showNearbyPlaces()" style="margin-top: 10px; padding: 8px 15px; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 13px;">
                            <i class="fas fa-map-marker-alt"></i> Tìm điểm du lịch gần đây
                        </button>
                    `;
                    
                    // Thêm marker vị trí người dùng
                    L.marker([userLocation.lat, userLocation.lng])
                        .addTo(map)
                        .bindPopup('<b>Vị trí của bạn</b>')
                        .openPopup();
                        
                    map.flyTo([userLocation.lat, userLocation.lng], 13);
                    
                    // Cập nhật thời tiết cho vị trí người dùng
                    updateWeatherForLocation([userLocation.lat, userLocation.lng]);
                },
                function(error) {
                    let message = "Không thể lấy vị trí: ";
                    switch(error.code) {
                        case error.PERMISSION_DENIED:
                            message += "Bạn đã từ chối quyền truy cập vị trí";
                            break;
                        case error.POSITION_UNAVAILABLE:
                            message += "Thông tin vị trí không khả dụng";
                            break;
                        case error.TIMEOUT:
                            message += "Hết thời gian chờ lấy vị trí";
                            break;
                        default:
                            message += "Lỗi không xác định";
                    }
                    locationInfo.innerHTML = `<p style="color: #f44336;">${message}</p>`;
                },
                {
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 0
                }
            );
        }

        // TÌM ĐIỂM DU LỊCH GẦN ĐÂY CÓ THỨ TỰ
        function showNearbyPlaces() {
            if (!userLocation) {
                getUserLocation();
                return;
            }
            
            // Tính khoảng cách và sắp xếp
            const nearbySpots = touristSpots.map(spot => {
                const distance = calculateDistance(
                    userLocation.lat, userLocation.lng,
                    spot.coordinates[0], spot.coordinates[1]
                );
                return { ...spot, distance };
            }).sort((a, b) => a.distance - b.distance);
            
            // Phân loại: <50km, 50-200km, >200km
            const veryNear = nearbySpots.filter(s => s.distance < 50);
            const near = nearbySpots.filter(s => s.distance >= 50 && s.distance <= 200);
            const far = nearbySpots.filter(s => s.distance > 200);
            
            const detailsDiv = document.getElementById('place-details');
            detailsDiv.innerHTML = `
                <h3><i class="fas fa-map-marker-alt"></i> Điểm du lịch gần vị trí của bạn</h3>
                
                ${veryNear.length > 0 ? `
                    <div style="margin: 30px 0;">
                        <h4 style="color: #4CAF50; border-bottom: 2px solid #4CAF50; padding-bottom: 5px;">
                            <i class="fas fa-walking"></i> Rất gần (< 50km)
                        </h4>
                        <div class="nearby-places">
                            ${veryNear.slice(0, 6).map(spot => `
                                <div class="nearby-place-card" onclick="showPlaceDetails(${spot.id})">
                                    <h4>${spot.name}</h4>
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin: 10px 0;">
                                        <span>${spot.province}</span>
                                        <span class="distance-badge">${spot.distance.toFixed(1)} km</span>
                                    </div>
                                    <p style="font-size: 14px; color: #666;">${spot.description.substring(0, 100)}...</p>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                ` : ''}
                
                ${near.length > 0 ? `
                    <div style="margin: 30px 0;">
                        <h4 style="color: #2196F3; border-bottom: 2px solid #2196F3; padding-bottom: 5px;">
                            <i class="fas fa-car"></i> Có thể đi trong ngày (50-200km)
                        </h4>
                        <div class="nearby-places">
                            ${near.slice(0, 6).map(spot => `
                                <div class="nearby-place-card" onclick="showPlaceDetails(${spot.id})">
                                    <h4>${spot.name}</h4>
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin: 10px 0;">
                                        <span>${spot.province}</span>
                                        <span class="distance-badge">${spot.distance.toFixed(1)} km</span>
                                    </div>
                                    <p style="font-size: 14px; color: #666;">${spot.description.substring(0, 100)}...</p>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                ` : ''}
                
                ${far.length > 0 ? `
                    <div style="margin: 30px 0;">
                        <h4 style="color: #FF9800; border-bottom: 2px solid #FF9800; padding-bottom: 5px;">
                            <i class="fas fa-plane"></i> Xa (> 200km) - Cần lập kế hoạch
                        </h4>
                        <div class="nearby-places">
                            ${far.slice(0, 4).map(spot => `
                                <div class="nearby-place-card" onclick="showPlaceDetails(${spot.id})">
                                    <h4>${spot.name}</h4>
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin: 10px 0;">
                                        <span>${spot.province}</span>
                                        <span class="distance-badge">${spot.distance.toFixed(1)} km</span>
                                    </div>
                                    <p style="font-size: 14px; color: #666;">${spot.description.substring(0, 100)}...</p>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                ` : ''}
                
                <div style="text-align: center; margin-top: 30px;">
                    <p>Tổng số điểm được đề xuất: ${veryNear.length + near.length + far.length} điểm</p>
                </div>
            `;
        }

        // CẬP NHẬT THỜI TIẾT
        function updateWeatherForLocation(coords) {
            const weatherContent = document.getElementById('weather-content');
            weatherContent.innerHTML = '<p><i class="fas fa-spinner fa-spin"></i> Đang cập nhật thời tiết...</p>';
            
            // Lấy dữ liệu thời tiết thực tế (giả lập)
            setTimeout(() => {
                const weather = getWeatherData(coords);
                weatherContent.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap;">
                        <div>
                            <h4 style="margin: 0;">${weather.location}</h4>
                            <p style="opacity: 0.9; margin: 5px 0;">${weather.date}</p>
                        </div>
                        <div style="font-size: 2rem;">${weather.icon}</div>
                    </div>
                    
                    <div class="weather-info">
                        <div class="weather-item">
                            <p style="margin: 0; font-size: 12px;">Nhiệt độ</p>
                            <p style="margin: 0; font-size: 1.5rem; font-weight: bold;">${weather.temp}°C</p>
                        </div>
                        
                        <div class="weather-item">
                            <p style="margin: 0; font-size: 12px;">Độ ẩm</p>
                            <p style="margin: 0; font-size: 1.5rem; font-weight: bold;">${weather.humidity}%</p>
                        </div>
                        
                        <div class="weather-item">
                            <p style="margin: 0; font-size: 12px;">Tình trạng</p>
                            <p style="margin: 0; font-size: 1rem; font-weight: bold;">${weather.condition}</p>
                        </div>
                        
                        <div class="weather-item">
                            <p style="margin: 0; font-size: 12px;">Gió</p>
                            <p style="margin: 0; font-size: 1rem; font-weight: bold;">${weather.wind}</p>
                        </div>
                    </div>
                    
                    <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.2);">
                        <p style="margin: 0; font-size: 14px;"><strong>Lời khuyên:</strong> ${weather.advice}</p>
                    </div>
                `;
            }, 1000);
        }

        // TẠO LỘ TRÌNH THÔNG MINH
        function generateSmartItinerary() {
            const days = parseInt(document.getElementById('days-count').value);
            const province = document.getElementById('start-province').value;
            const interest = document.getElementById('main-interest').value;
            let budget = document.getElementById('budget').value;
            
            if (budget === 'custom') {
                budget = document.getElementById('custom-budget').value;
                if (!budget || budget < 1000000) {
                    alert('Vui lòng nhập ngân sách hợp lệ (tối thiểu 1,000,000 VNĐ)');
                    return;
                }
            }
            budget = parseInt(budget);
            
            // Tạo lộ trình chi tiết
            const itinerary = createDetailedItinerary(days, province, interest, budget);
            
            const resultsDiv = document.getElementById('itinerary-results');
            resultsDiv.innerHTML = `
                <div style="background: rgba(255,255,255,0.95); padding: 30px; border-radius: 15px; margin-top: 20px; color: #333;">
                    <h3 style="color: #1a237e; text-align: center; margin-bottom: 20px;">
                        <i class="fas fa-calendar-alt"></i> Lộ trình ${days} ngày ${days-1} đêm
                    </h3>
                    
                    <div class="budget-section">
                        <h4 style="color: #1a237e; margin-bottom: 15px;">
                            <i class="fas fa-money-bill-wave"></i> Phân bổ ngân sách: ${formatCurrency(budget)}
                        </h4>
                        <div class="budget-breakdown">
                            <div class="budget-item">
                                <p style="margin: 0; font-size: 12px;">Chỗ ở</p>
                                <p style="margin: 0; font-size: 1.2rem; font-weight: bold; color: #4CAF50;">
                                    ${formatCurrency(itinerary.budgetBreakdown.accommodation)}
                                </p>
                            </div>
                            <div class="budget-item">
                                <p style="margin: 0; font-size: 12px;">Ăn uống</p>
                                <p style="margin: 0; font-size: 1.2rem; font-weight: bold; color: #FF9800;">
                                    ${formatCurrency(itinerary.budgetBreakdown.food)}
                                </p>
                            </div>
                            <div class="budget-item">
                                <p style="margin: 0; font-size: 12px;">Di chuyển</p>
                                <p style="margin: 0; font-size: 1.2rem; font-weight: bold; color: #2196F3;">
                                    ${formatCurrency(itinerary.budgetBreakdown.transport)}
                                </p>
                            </div>
                            <div class="budget-item">
                                <p style="margin: 0; font-size: 12px;">Vé tham quan</p>
                                <p style="margin: 0; font-size: 1.2rem; font-weight: bold; color: #9C27B0;">
                                    ${formatCurrency(itinerary.budgetBreakdown.entrance)}
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    ${itinerary.days.map((day, index) => `
                        <div class="itinerary-day">
                            <div class="day-header">
                                <h4 style="margin: 0;">Ngày ${index + 1}</h4>
                                <span style="background: white; color: #1a237e; padding: 5px 10px; border-radius: 20px; font-size: 12px;">
                                    ${day.date}
                                </span>
                            </div>
                            
                            <div style="margin-bottom: 20px;">
                                <h5 style="color: #1a237e; margin-bottom: 10px;">
                                    <i class="fas fa-sun"></i> Buổi sáng
                                </h5>
                                ${day.morning.map(item => `
                                    <div class="recommendation-item">
                                        <strong>${item.time}:</strong> ${item.activity}
                                        ${item.location ? `<br><small><i class="fas fa-map-marker-alt"></i> ${item.location}</small>` : ''}
                                        ${item.contact ? `<br><small><i class="fas fa-phone"></i> ${item.contact}</small>` : ''}
                                    </div>
                                `).join('')}
                            </div>
                            
                            <div style="margin-bottom: 20px;">
                                <h5 style="color: #1a237e; margin-bottom: 10px;">
                                    <i class="fas fa-utensils"></i> Ăn trưa
                                </h5>
                                ${day.lunch.map(item => `
                                    <div class="recommendation-item">
                                        <strong>${item.name}</strong><br>
                                        <small><i class="fas fa-map-marker-alt"></i> ${item.address}</small><br>
                                        <small><i class="fas fa-phone"></i> ${item.phone}</small><br>
                                        <small><i class="fas fa-money-bill"></i> ${item.price}</small>
                                    </div>
                                `).join('')}
                            </div>
                            
                            <div style="margin-bottom: 20px;">
                                <h5 style="color: #1a237e; margin-bottom: 10px;">
                                    <i class="fas fa-cloud-sun"></i> Buổi chiều
                                </h5>
                                ${day.afternoon.map(item => `
                                    <div class="recommendation-item">
                                        <strong>${item.time}:</strong> ${item.activity}
                                        ${item.location ? `<br><small><i class="fas fa-map-marker-alt"></i> ${item.location}</small>` : ''}
                                        ${item.contact ? `<br><small><i class="fas fa-phone"></i> ${item.contact}</small>` : ''}
                                    </div>
                                `).join('')}
                            </div>
                            
                            ${day.accommodation ? `
                                <div>
                                    <h5 style="color: #1a237e; margin-bottom: 10px;">
                                        <i class="fas fa-hotel"></i> Chỗ nghỉ
                                    </h5>
                                    <div class="recommendation-item">
                                        <strong>${day.accommodation.name}</strong><br>
                                        <small><i class="fas fa-map-marker-alt"></i> ${day.accommodation.address}</small><br>
                                        <small><i class="fas fa-phone"></i> ${day.accommodation.phone}</small><br>
                                        <small><i class="fas fa-money-bill"></i> ${day.accommodation.price}</small>
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                    `).join('')}
                    
                    <div style="text-align: center; margin-top: 30px;">
                        <button onclick="saveItinerary()" style="padding: 12px 30px; background: #4CAF50; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; margin-right: 10px;">
                            <i class="fas fa-save"></i> Lưu lộ trình
                        </button>
                        <button onclick="printItinerary()" style="padding: 12px 30px; background: #2196F3; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 16px;">
                            <i class="fas fa-print"></i> In lộ trình
                        </button>
                    </div>
                </div>
            `;
        }

        // TẠO LỘ TRÌNH CHI TIẾT
        function createDetailedItinerary(days, province, interest, budget) {
            // Chọn địa điểm dựa trên sở thích
            const spots = touristSpots.filter(spot => 
                spot.province === province || getProvinceNeighbors(province).includes(spot.province)
            ).slice(0, days * 2);
            
            // Tính toán ngân sách
            const budgetPerDay = budget / days;
            const budgetBreakdown = {
                accommodation: Math.floor(budget * 0.4),
                food: Math.floor(budget * 0.3),
                transport: Math.floor(budget * 0.2),
                entrance: Math.floor(budget * 0.1)
            };
            
            // Tạo lịch trình từng ngày
            const itineraryDays = [];
            const startDate = new Date();
            
            for (let i = 0; i < days; i++) {
                const currentDate = new Date(startDate);
                currentDate.setDate(startDate.getDate() + i);
                
                const daySpots = spots.slice(i * 2, (i + 1) * 2);
                
                itineraryDays.push({
                    date: currentDate.toLocaleDateString('vi-VN'),
                    morning: [
                        {
                            time: '08:00',
                            activity: `Tham quan ${daySpots[0]?.name || 'điểm du lịch'}`,
                            location: daySpots[0]?.address,
                            contact: daySpots[0]?.contact
                        }
                    ],
                    lunch: [{
                        name: "Nhà hàng địa phương",
                        address: "Số 1, đường chính",
                        phone: "024 1234 5678",
                        price: "150.000 VNĐ/người"
                    }],
                    afternoon: [
                        {
                            time: '14:00',
                            activity: `Tham quan ${daySpots[1]?.name || 'điểm du lịch'}`,
                            location: daySpots[1]?.address,
                            contact: daySpots[1]?.contact
                        }
                    ],
                    accommodation: i < days - 1 ? {
                        name: "Khách sạn địa phương",
                        address: "Số 2, đường chính",
                        phone: "024 8765 4321",
                        price: `${Math.floor(budgetBreakdown.accommodation / (days - 1)).toLocaleString()} VNĐ/đêm`
                    } : null
                });
            }
            
            return {
                days: itineraryDays,
                budgetBreakdown: budgetBreakdown,
                totalBudget: budget
            };
        }

        // HÀM HỖ TRỢ
        function switchTab(tabId, button) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            button.classList.add('active');
        }

        function getTypeName(type) {
            const typeNames = {
                'di_tich': 'Di tích lịch sử',
                'tham_quan': 'Thắng cảnh',
                'bao_tang': 'Bảo tàng',
                'am_thuc': 'Ẩm thực',
                'le_hoi': 'Lễ hội',
                'nghi_duong': 'Nghỉ dưỡng',
                'mua_sam': 'Mua sắm',
                'tam_linh': 'Tâm linh',
                'van_hoa': 'Văn hóa dân tộc'
            };
            return typeNames[type] || 'Điểm tham quan';
        }

        function getFacilityIcon(type) {
            const icons = {
                'hotel': 'fas fa-hotel',
                'restaurant': 'fas fa-utensils',
                'parking': 'fas fa-parking',
                'transport': 'fas fa-car',
                'hospital': 'fas fa-hospital',
                'cafe': 'fas fa-coffee'
            };
            return icons[type] || 'fas fa-info-circle';
        }

        function getFacilityName(type) {
            const names = {
                'hotel': 'Khách sạn',
                'restaurant': 'Nhà hàng',
                'parking': 'Bãi đỗ xe',
                'transport': 'Phương tiện',
                'hospital': 'Bệnh viện',
                'cafe': 'Quán cà phê'
            };
            return names[type] || 'Tiện ích';
        }

        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371;
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = 
                Math.sin(dLat/2) * Math.sin(dLat/2) +
                Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * 
                Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        function getWeatherData(coords) {
            const locations = {
                'Hà Nội': { temp: 25, humidity: 75, wind: 'Đông Nam 10km/h', icon: '☀️' },
                'Huế': { temp: 28, humidity: 85, wind: 'Bắc 15km/h', icon: '⛅' },
                'Đà Nẵng': { temp: 30, humidity: 80, wind: 'Đông 12km/h', icon: '☀️' },
                'TP Hồ Chí Minh': { temp: 32, humidity: 78, wind: 'Tây Nam 8km/h', icon: '🌤️' }
            };
            
            // Xác định vị trí gần nhất
            let nearestLocation = 'Hà Nội';
            let minDistance = Infinity;
            
            for (const [location, data] of Object.entries(locations)) {
                const locationCoords = getProvinceCenter(location);
                const distance = calculateDistance(coords[0], coords[1], locationCoords[0], locationCoords[1]);
                if (distance < minDistance) {
                    minDistance = distance;
                    nearestLocation = location;
                }
            }
            
            const weather = locations[nearestLocation];
            const conditions = ['Nắng đẹp', 'Ít mây', 'Mây rải rác', 'Trời trong'];
            const advices = [
                'Thời tiết thuận lợi cho du lịch',
                'Nên mang theo ô dù phòng mưa',
                'Mặc trang phục thoáng mát',
                'Chuẩn bị nước uống đầy đủ'
            ];
            
            return {
                location: nearestLocation,
                date: new Date().toLocaleDateString('vi-VN'),
                temp: weather.temp + Math.floor(Math.random() * 4) - 2,
                humidity: weather.humidity,
                wind: weather.wind,
                icon: weather.icon,
                condition: conditions[Math.floor(Math.random() * conditions.length)],
                advice: advices[Math.floor(Math.random() * advices.length)]
            };
        }

        function getProvinceCenter(province) {
            const centers = {
                'Hà Nội': [21.0285, 105.8542],
                'Huế': [16.4637, 107.5909],
                'Đà Nẵng': [16.0544, 108.2022],
                'TP Hồ Chí Minh': [10.8231, 106.6297],
                'Lạng Sơn': [21.8537, 106.7619],
                'Sa Pa': [22.3364, 103.8440],
                'Phú Thọ': [21.3222, 105.4020],
                'Quảng Ngãi': [15.1214, 108.8044]
            };
            return centers[province] || [16.0, 108.0];
        }

        function getProvinceNeighbors(province) {
            const neighbors = {
                'Hà Nội': ['Phú Thọ', 'Lạng Sơn'],
                'Huế': ['Đà Nẵng', 'Quảng Ngãi'],
                'Đà Nẵng': ['Huế', 'Quảng Ngãi'],
                'TP Hồ Chí Minh': [],
                'Lạng Sơn': ['Hà Nội'],
                'Sa Pa': ['Lạng Sơn'],
                'Phú Thọ': ['Hà Nội'],
                'Quảng Ngãi': ['Huế', 'Đà Nẵng']
            };
            return neighbors[province] || [];
        }

        function formatCurrency(amount) {
            return new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(amount);
        }

        function filterByProvince(province) {
            currentProvince = province;
            loadPlacesList();
            loadMarkers(touristSpots);
            updatePlaceCount();
            
            const provinceCenter = getProvinceCenter(province);
            if (province !== 'all') {
                map.flyTo(provinceCenter, 9);
                updateWeatherForLocation(provinceCenter);
            } else {
                map.flyTo(vietnamCenter, 6);
            }
        }

        function updatePlaceCount() {
            const count = touristSpots.filter(spot => 
                currentProvince === 'all' || spot.province === currentProvince
            ).length;
            
            const status = document.createElement('div');
            status.innerHTML = `
                <div style="background: #e8f5e9; padding: 10px 15px; border-radius: 8px; margin-top: 15px; text-align: center;">
                    <strong>Đang hiển thị ${count} điểm du lịch</strong>
                    ${currentProvince !== 'all' ? ` tại ${currentProvince}` : ''}
                </div>
            `;
            
            const existingStatus = document.querySelector('#place-count-status');
            if (existingStatus) existingStatus.remove();
            
            status.id = 'place-count-status';
            document.getElementById('places-list').appendChild(status);
        }

        function loadMarkers(spots) {
            markers.forEach(marker => map.removeLayer(marker));
            markers = [];
            
            spots.forEach(spot => {
                if (currentProvince === 'all' || spot.province === currentProvince) {
                    const marker = L.marker(spot.coordinates)
                        .addTo(map)
                        .bindPopup(`
                            <div style="max-width: 250px;">
                                <h4 style="margin: 0; color: #1a237e;">${spot.name}</h4>
                                <p style="margin: 5px 0; color: #666; font-size: 13px;">${spot.province}</p>
                                <p style="margin: 5px 0; font-size: 12px;">${spot.description.substring(0, 80)}...</p>
                                <button onclick="showPlaceDetails(${spot.id})" style="width: 100%; padding: 6px; background: #4CAF50; color: white; border: none; border-radius: 3px; cursor: pointer; font-size: 11px;">
                                    Xem chi tiết
                                </button>
                            </div>
                        `);
                    markers.push(marker);
                }
            });
            
            if (markers.length > 0) {
                const group = new L.featureGroup(markers);
                map.fitBounds(group.getBounds().pad(0.1));
            }
        }

        function saveItinerary() {
            alert('Lộ trình đã được lưu thành công vào tài khoản của bạn!');
        }

        function printItinerary() {
            window.print();
        }

        function showDirectionsToPlace(placeId) {
            const place = touristSpots.find(p => p.id === placeId);
            if (!place) return;
            
            if (!userLocation) {
                alert("Vui lòng lấy vị trí của bạn trước để sử dụng tính năng này");
                getUserLocation();
                return;
            }
            
            showPlaceDetails(placeId);
            switchTab('navigation-tab', document.querySelector('#navigation-tab').previousElementSibling);
            
            const routeInstructions = document.getElementById('route-instructions');
            const distance = calculateDistance(userLocation.lat, userLocation.lng, place.coordinates[0], place.coordinates[1]);
            
            routeInstructions.innerHTML = `
                <div style="background: white; padding: 15px; border-radius: 8px; margin-top: 15px;">
                    <h5 style="color: #1a237e; margin-bottom: 10px;">Hướng dẫn đường đi</h5>
                    <p><strong>Khoảng cách:</strong> ${distance.toFixed(1)} km</p>
                    <p><strong>Thời gian di chuyển ước tính:</strong> ${Math.round(distance / 40 * 60)} phút (bằng ô tô)</p>
                    <p><strong>Phương tiện đề xuất:</strong> Ô tô / Taxi</p>
                    <p><strong>Chi phí ước tính:</strong> ${(distance * 15000).toLocaleString()} VNĐ</p>
                    <div style="margin-top: 15px;">
                        <a href="https://maps.google.com/?q=${place.coordinates[0]},${place.coordinates[1]}" target="_blank" style="padding: 8px 15px; background: #4285F4; color: white; text-decoration: none; border-radius: 5px;">
                            <i class="fab fa-google"></i> Mở Google Maps
                        </a>
                    </div>
                </div>
            `;
        }

        // KHỞI ĐỘNG
        window.onload = function() {
            console.log('VietTravelGuide Phiên bản 4.1 đã sẵn sàng!');
            console.log('Hoàng Sa - Trường Sa là của Việt Nam!');
        };
    </script>
</body>
</html>
